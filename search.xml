<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Bash Tutorial</title>
      <link href="2019/11/14/Bash-Tutorial/"/>
      <url>2019/11/14/Bash-Tutorial/</url>
      
        <content type="html"><![CDATA[<p>对程序员而言，Shell是一种必备技能。目前，Bash是最流行的Shell程序之一，因此学会Bash的使用是很有必要的。</p><h2 id="Step-01"><a href="#Step-01" class="headerlink" title="Step 01"></a>Step 01</h2><h3 id="什么是Bash？"><a href="#什么是Bash？" class="headerlink" title="什么是Bash？"></a>什么是Bash？</h3><p>Bash是“Bourne Again SHell”的简称，从名字来看，它是一个Shell程序，并且和Bourne（也是一种Shell）有着某种继承关系。</p><h3 id="什么是Shell？"><a href="#什么是Shell？" class="headerlink" title="什么是Shell？"></a>什么是Shell？</h3><p>Shell是一种可执行的二进制文件，它接收你输入在终端的命令，并最终将这些命令翻译为系统调用，借助你的操作系统提供的API完成一系列工作。在中文里，Shell的意思是“外壳”：你可以把它想象成套在操作系统上的一层外壳，你所有的操作都在外壳上进行，但实际发挥作用的是外壳里的东西，就像是你通过外壳上的按钮来操作一台电视机一样。</p><h3 id="除了Bash之外？"><a href="#除了Bash之外？" class="headerlink" title="除了Bash之外？"></a>除了Bash之外？</h3><p>除了Bash之外当然还有很多其他的Shell程序，比如我自己使用的就是zsh。此外还有sh（就是刚才说的Bourne），ash，dash，ksh等等</p><p>你可以通过以下这张图片了解他们之间的关系：</p><p><img src="https://s2.ax1x.com/2019/11/14/MNtqNF.png" alt="MNtqNF.png"></p><p>一件奇特的事情是你可以在某一个Shell里运行另一个Shell：不过这种特性是很自然的，因为“将运行其他程序统一为一体”正是Shell的一大特性，这里不过是把另一个Shell当作另一个程序罢了。</p><p>这个特色让我们得以轻松比较不同的Shell。比如在zsh，tcsh等中，<code>$dirstack</code>变量会存储最近访问过的路径列表，但这个变量在Bash中不存在：</p><p><img src="https://s2.ax1x.com/2019/11/14/MNG5X6.md.png" alt="MNG5X6.md.png"></p><p>（我在tcsh和zsh中<code>$dirstack</code>的值不同是因为我在两个shell里访问过的路径不同）</p><p>尽管如此，它们在很多时候是相通的。</p><h2 id="Step-02"><a href="#Step-02" class="headerlink" title="Step 02"></a>Step 02</h2><h3 id="Globbing：通配符"><a href="#Globbing：通配符" class="headerlink" title="Globbing：通配符"></a>Globbing：通配符</h3><p>通配符的英文是wildcards，又叫做globbing patterns，它用来处理一组路径，可以被看做早期的正则表达式。之所以叫glob是因为Unix早期有一个<code>/etc/glob</code>文件来保存通配符模板。它现在被内置在Bash中，Python中也有一个glob模块。</p><p>一个简单的例子如下所示，和正则式有相通之处，这里不详细讲解：</p><p><img src="https://s2.ax1x.com/2019/11/15/Maixmt.md.png" alt="Maixmt.md.png"></p><p><strong>但是你会发现，如果你输入的是<code>ls &#39;*&#39;</code>和<code>echo &#39;*&#39;</code>，这里的<code>*</code>并没有发生任何匹配，而是直接被当作这个字符来处理了。</strong><br>当然正则式和glob的区别还是存在的并且不少，而且Bash本身也对glob做了一些拓展。这里不再细究。</p><h3 id="Variables：变量"><a href="#Variables：变量" class="headerlink" title="Variables：变量"></a>Variables：变量</h3><pre class=" language-bash"><code class="language-bash">MYSTRING<span class="token operator">=</span>astring<span class="token keyword">echo</span> <span class="token variable">$MYSTRING</span></code></pre><p>非常容易理解，值得注意的是取值的时候需要加上<code>$</code>，并且是不要乱加空格。如果变量值内部有空格，就需要引号，这里单引号双引号都可以：</p><pre class=" language-bash"><code class="language-bash">MYSTRING<span class="token operator">=</span><span class="token string">"a sentence"</span></code></pre><p>但单双引号的一大区别是，当你在引号里加入变量名的时候：</p><pre class=" language-bash"><code class="language-bash">MYSENTENCE<span class="token operator">=</span><span class="token string">"This is <span class="token variable">$MYSTRING</span>"</span><span class="token keyword">echo</span> <span class="token variable">$MYSENTENCE</span>  <span class="token comment" spellcheck="true"># OUTPUT: This is astring</span>MYSENTENCE<span class="token operator">=</span><span class="token string">'This is <span class="token variable">$MYSTRING</span>'</span><span class="token keyword">echo</span> <span class="token variable">$MYSENTENCE</span>  <span class="token comment" spellcheck="true"># OUTPUT: This is $MYSTRING</span></code></pre><p>前者会取变量的值，而后者不会。</p><p>事实上Bash对待变量和单双引号这个事情的效果还挺有趣的，而且和我通常使用的zsh有所不同：</p><p><img src="https://s2.ax1x.com/2019/11/15/MaEEXd.md.png" alt="MaEEXd.md.png"></p><p>可以看到，无论<code>MYGLOB</code>被赋值<code>*</code>还是<code>&quot;*&quot;</code>，存在<code>MYGLOB</code>里的都是一个单独的字符；并且在Bash中变量的值还可以进一步被当作通配符被解析，而zsh则不会。</p><p>Shell本身自带一些变量，比如<code>PPID</code>，它储存着当前Bash的父进程ID，这种变量是只读的。我们自己也可以设置只读变量：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">readonly</span> MYVAR<span class="token operator">=</span>varMYVAR<span class="token operator">=</span>antohervar  <span class="token comment" spellcheck="true"># error</span></code></pre><p>还有一个问题。当你设置了一个变量，又打开了另一个进程，在新的进程里你的变量就不存在了。但如果你使用<code>export</code> 命令，这个变量就会出现在你当前shell中运行的所有进程的环境中了：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">export</span> MYSTRING<span class="token operator">=</span>astring</code></pre><p>变量还可以是array或associate array的形式。这里不详细介绍。</p><h3 id="Functions-函数"><a href="#Functions-函数" class="headerlink" title="Functions: 函数"></a>Functions: 函数</h3><p>像一个编程语言一样，Shell还可以编写函数：</p><pre class=" language-bash"><code class="language-bash"><span class="token keyword">function</span> myfunc <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$1</span>    <span class="token keyword">echo</span> <span class="token variable">$2</span><span class="token punctuation">}</span></code></pre><p>这个声明和普通的编程语言没什么区别，主要的不同就是它并不指出参数，并且它也并不在意你到底给它几个参数，因为多余的它会忽略，缺少的它会认为是空：</p><pre class=" language-shell"><code class="language-shell">myfunc hello world haha  # output: hello worldmyfunc hello world       # output: hello worldmyfunc hello             # output: hello(and an empty line)</code></pre><p>Shell函数中的变量也有其作用域。外部变量在函数中都可见，而想要函数内部的变量不被外部可见，可以在声明前加上<code>local</code>。</p><h2 id="Step-03"><a href="#Step-03" class="headerlink" title="Step 03"></a>Step 03</h2><h3 id="Commands-命令"><a href="#Commands-命令" class="headerlink" title="Commands: 命令"></a>Commands: 命令</h3><p>Bash中的命令主要是四种：</p><ul><li>内置（builtins）</li><li>函数（functions）</li><li>程序（programs）</li><li>别名（Aliases）</li></ul><p>内置命令是指直接在Bash里定义好的命令，最常见的是<code>cd</code>，<code>builtin</code>自己也是一个builtin。当你输入<code>builtin cd /dir</code> 的时候它会和普通的<code>cd</code>一样运行；而如果是一个非builtin的命令，则会被提示没有这个命令。</p><p>一个它可能会发挥作用的场景是：假如你定义了一个函数也叫<code>cd</code>，那么它会覆盖原来builtin的<code>cd</code>，这时候输入<code>builtin cd /dir</code> 还是会唤起builtin的版本。</p><p>说到函数，要查看当前环境下的所有函数可以使用：</p><pre class=" language-bash"><code class="language-bash"><span class="token keyword">declare</span> -f  <span class="token comment" spellcheck="true"># show all the functions in the environment</span><span class="token keyword">declare</span> -F  <span class="token comment" spellcheck="true"># only show their names</span></code></pre><p>对于已经定义的函数，可以通过<code>unset -f</code>来解除。</p><p>程序，在这里指可执行的文件。包括<code>grep</code>，<code>sed</code>，<code>vi</code> 等都是常见的程序。要判断一个命令到底是builtin还是program，可以通过刚才说的，在命令前加上builtin，也可以使用<code>which &lt;command&gt;</code>查看命令是否保存在文件系统中来确定。</p><p><code>which</code> 自身是一个builtin。当你输入<code>which which</code> 时，可以看到这个结果。</p><p>别名很容易理解，就是一个字符串，你输入shell之后它会自动把你翻译给这个别名所指代的另一个字符串，这个字符串可能是一个命令。</p><p>用法是：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">alias</span> a<span class="token operator">=</span>b  <span class="token comment" spellcheck="true"># make alias</span><span class="token function">unalias</span> a  <span class="token comment" spellcheck="true"># delete this alias</span><span class="token function">alias</span>      <span class="token comment" spellcheck="true"># show alias available</span></code></pre><p>在我的zsh中，<code>ls</code>是<code>ls -G</code>的别名。<code>ls -G</code>中的<code>ls</code>是一个程序，这里被这个别名给覆盖了。</p><h3 id="Pipes-and-Redirects：管道和重定向"><a href="#Pipes-and-Redirects：管道和重定向" class="headerlink" title="Pipes and Redirects：管道和重定向"></a>Pipes and Redirects：管道和重定向</h3><p>重定向符号是<code>&gt;</code>：</p><pre><code>echo &quot;content of file1&quot; &gt; file1</code></pre><p>它把前一个指令的输出发送到后面的文件中；如果文件不存在它会创建一个。默认的输出是标准输出流，如果要输出标准错误流，则需要在<code>&gt;</code>前加上文件描述符（0是标准输入流，1是标准输出流，2是标准错误流），默认是1，标准输出流：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">command</span> 2<span class="token operator">></span> /dev/null</code></pre><p>顺带一提，<code>/dev/null</code>是一个特殊的文件，传给它的所有东西都会被直接丢弃。</p><p>我们知道标准输出流和标准错误流是分别独立存在的。有时当我们写程序，并且程序有输出、又出现报错信息的时候，我们会发现它们是交替出现的，这正是这一特性的体现。但我们可以将标准错误流重定向到标准输出流指向的地方：</p><pre class=" language-bash"><code class="language-bash">command_does_not_exist 2<span class="token operator">></span><span class="token operator">&amp;</span>1</code></pre><p>通常来说它们两个都是指向终端，所以没有什么区别，但是它们中有人被重定向到文件，情况就有所不同了：</p><pre class=" language-she"><code class="language-she">command_does_not_exist 2>&1 > outfilecommand_does_not_exist > outfile 2>&1</code></pre><p>这两个命令看似没什么区别，但实际上第一行会把错误信息输出终端，而第二个输出错误，而是把错误信息存进了<code>outfile</code>中。区别就在于，第一行首先把标准错误流的输出指向了标准输出流指向的地方——终端，之后它再把标准输出流重定向到了文件。而第二行首先把<code>command_does_not_exist</code> 的标准输出流重定向到了<code>outfile</code>，之后再把标准错误流指向标准输出流指向的地方，而这时，是文件。</p><p>管道则是一个非常形象的名字。它将前一个命令的标准输出于是弄给下一个命令作为输入，好像通过管道连接一样。管道运算符是<code>|</code>：</p><pre class=" language-shell"><code class="language-shell">cat file1 | grep -c file</code></pre><p>这个命令会找出文件<code>file1</code> 中含有“file”的行数。</p><p>但管道是只接收标准输出流的。假如上面这条命令中，<code>file1</code>这个文件并不存在， 则会输出以下结果：</p><p><img src="https://s2.ax1x.com/2019/11/23/MbeuLR.md.png" alt="MbeuLR.md.png"></p><p>可见标准错误流并不能通过管道。但如果你把上面的 <code>|</code> 换成 <code>|&amp;</code>结果就完全不同了：<code>|&amp;</code> 可以同时传送标准输入和标准错误，因为这行错误信息中有一个“file”，因此输出结果会是1。</p><p>管道和重定向有相似之处，管道传送的对象是另一个命令，而重定向的对象则是文件。</p><h2 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h2><h3 id="Test-and-if-statement：测试和条件"><a href="#Test-and-if-statement：测试和条件" class="headerlink" title="Test and if statement：测试和条件"></a>Test and if statement：测试和条件</h3><p>test允许我们实现条件表达式。我们在一对方括号中放入被测试的条件，或者之前在前方放<code>test</code>:</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span> 1 <span class="token operator">=</span> 0 <span class="token punctuation">]</span><span class="token function">test</span> 1 <span class="token operator">=</span> 0</code></pre><p>可以用<code>echo $?</code>来获得上一条指令的结果。与其他编程语言不同，在bash中，假值会返回一个非零值，而真值会返回0。这点需要格外注意。</p><p>不过bash也提供了和很多编程语言相同的逻辑运算符。如：</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">(</span> <span class="token punctuation">[</span> 1 <span class="token operator">=</span> 1 <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token string">'0'</span> <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token string">'2'</span> <span class="token operator">=</span> <span class="token string">'2'</span> <span class="token punctuation">]</span><span class="token punctuation">[</span>  1 <span class="token operator">=</span> 1 -o  <span class="token operator">!</span> <span class="token string">'0'</span> <span class="token operator">=</span> <span class="token string">'0'</span>  -a  <span class="token string">'2'</span> <span class="token operator">=</span> <span class="token string">'2'</span> <span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># -o: or, -a: and, but you cannot use () to group within them.</span></code></pre><p><code>[[</code> 和 <code>[</code>很类似，实际上在大多数情况下他们表现得别无二致，区别在于前者对不存在的变量名的处理方式。如下所示：</p><pre class=" language-bash"><code class="language-bash">unset DOESNOTEXIST<span class="token punctuation">[</span> <span class="token variable">${DOESNOTEXIST}</span> <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># treat it as [ = '' ], so bash will complain</span><span class="token keyword">echo</span> <span class="token variable">$?</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">${DOESNOTEXIST}</span> <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># treat it as [[ '' = '' ]]</span><span class="token keyword">echo</span> <span class="token variable">$?</span><span class="token punctuation">[</span> x<span class="token variable">${DOESNOTEXIST}</span> <span class="token operator">=</span> x <span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># treat it as [ x = x ]</span><span class="token keyword">echo</span> <span class="token variable">$?</span></code></pre><p>下面介绍一些常见的操作符，包含一元和二元操作符。</p><p>常用的一元运算符如下：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">touch</span> tests_file   <span class="token comment" spellcheck="true"># Create tests file</span><span class="token function">mkdir</span> tests_dir<span class="token punctuation">[</span> -a tests_file <span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># -a returns true if file exists</span><span class="token keyword">echo</span> <span class="token variable">$?</span><span class="token punctuation">[</span> -d tests_file <span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># -d returns false if the directory does not exist</span><span class="token keyword">echo</span> <span class="token variable">$?</span>            <span class="token comment" spellcheck="true"># A normal file is not a directory</span><span class="token punctuation">[</span> -a tests_dir <span class="token punctuation">]</span>   <span class="token comment" spellcheck="true"># A directory is a type of file, so returns true</span><span class="token keyword">echo</span> <span class="token variable">$?</span><span class="token punctuation">[</span> -d tests_dir <span class="token punctuation">]</span>   <span class="token comment" spellcheck="true"># -d returns true if directory exists</span><span class="token keyword">echo</span> <span class="token variable">$?</span><span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">$PWD</span>"</span> <span class="token punctuation">]</span>      <span class="token comment" spellcheck="true"># -z is a unary operator that takes one argument</span><span class="token keyword">echo</span> <span class="token variable">$?</span>            <span class="token comment" spellcheck="true"># Returns false, as PWD has content</span></code></pre><p>常见的二元运算符主要是比较操作符。但需要注意bash中<code>&lt;</code> <code>&gt;</code> <code>=</code>是定义在字符串上的操作符，在整数上应该使用<code>-lt</code> <code>-gt</code> <code>-eq</code>。下例展示了这几个操作符的用法，顺便也介绍了<code>if</code> statement的写法：</p><pre class=" language-bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> 10 -lt 2 <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">then</span>  <span class="token keyword">echo</span> <span class="token string">'does not compute'</span><span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> 10 -gt 2 <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">then</span>  <span class="token keyword">echo</span> <span class="token string">'computes'</span><span class="token keyword">else</span>  <span class="token keyword">echo</span> <span class="token string">'neither greater than, or less than, so must be equal'</span><span class="token keyword">fi</span></code></pre><h3 id="Loops：循环"><a href="#Loops：循环" class="headerlink" title="Loops：循环"></a>Loops：循环</h3><p>因为循环语句在各种编程语言中非常常见，此处仅以例子说明。</p><p>for循环：</p><pre class=" language-bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">))</span></span><span class="token keyword">do</span>  <span class="token keyword">echo</span> <span class="token variable">$i</span>  <span class="token keyword">echo</span> <span class="token variable">$i</span> <span class="token operator">></span> <span class="token function">file</span><span class="token variable">${i}</span>.txt<span class="token keyword">done</span></code></pre><pre class=" language-bash"><code class="language-bash"><span class="token keyword">for</span> f <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> *txt<span class="token variable">)</span></span><span class="token keyword">do</span>    <span class="token keyword">echo</span> <span class="token string">"File <span class="token variable">$f</span> contains: <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> $f<span class="token variable">)</span></span>"</span><span class="token keyword">done</span></code></pre><p>while循环：</p><pre class=" language-bash"><code class="language-bash">n<span class="token operator">=</span>0<span class="token keyword">while</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> -a newfile <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">do</span>    <span class="token variable"><span class="token punctuation">((</span>n<span class="token operator">++</span><span class="token punctuation">))</span></span>    <span class="token keyword">echo</span> <span class="token string">"In iteration <span class="token variable">$n</span>"</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> file$<span class="token punctuation">{</span>n<span class="token punctuation">}</span>.txt<span class="token variable">)</span></span> <span class="token operator">==</span> <span class="token string">"15"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">then</span>            <span class="token function">touch</span> newfile    <span class="token keyword">fi</span><span class="token keyword">done</span></code></pre><p>到这里，我认为简单的Bash tutorial就暂时结束了。虽然没有涉及很多具体的命令，但我们建立了一个Bash的big picture。当然这里缺少了最关键的部分：shell脚本。不过我希望能有空再写一篇博客谈谈这个。</p>]]></content>
      
      
      <categories>
          
          <category> tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>全部文章索引</title>
      <link href="2019/10/06/%E5%85%A8%E9%83%A8%E6%96%87%E7%AB%A0%E7%B4%A2%E5%BC%95/"/>
      <url>2019/10/06/%E5%85%A8%E9%83%A8%E6%96%87%E7%AB%A0%E7%B4%A2%E5%BC%95/</url>
      
        <content type="html"><![CDATA[<p>尽管目前我的博客规模仍然很小，但我有自信有一天它会需要一个索引。</p><a id="more"></a><p>博客主题本身已经提供了按时间、按tag/Categories的分类方式，但它们还不够符合我对分类的期许，因此我采用纯手工的方式增加了这样一个索引。</p><h2 id="My-Life"><a href="#My-Life" class="headerlink" title="My Life"></a>My Life</h2><ul><li><p><a href="http://huangweiran.club/about/">About me</a></p></li><li><p><a href="http://huangweiran.club/2018/08/13/%E8%B0%88%E8%B0%88%E8%BF%91%E5%86%B5/">谈谈近况</a></p></li><li><p><a href="https://huangweiran.club/2018/12/12/%E7%AE%80%E7%9F%AD%E7%9A%84%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/">简短的年终总结</a></p></li></ul><h2 id="Machine-Learning"><a href="#Machine-Learning" class="headerlink" title="Machine Learning"></a>Machine Learning</h2><blockquote><p>机器学习领域的知识和实践</p></blockquote><ul><li><a href="https://www.zybuluo.com/EtoDemerzel/note/928832" target="_blank" rel="noopener">我的作业部落</a>：吴恩达《Machine Learning》编程作业笔记。彼时初涉领域，可能有所错漏。</li><li><a href="http://huangweiran.club/2018/01/27/PLA%E5%92%8Cpocket%E7%AE%97%E6%B3%95%EF%BC%9A%E7%AE%80%E5%8D%95Python%E5%AE%9E%E7%8E%B0/">PLA和pocket算法：简单Python实现</a>：台大《机器学习基石》课程第一次作业中的几个题。此课程我应该不会再上了。</li><li><a href="https://huangweiran.club/2019/06/07/Machine-Learning-Topics/">Machine Learning Topics</a>：对机器学习知识的系统总结，目前刚刚开始更新。</li><li><a href="http://huangweiran.club/2018/08/30/CS-224N-Assignment-1/">CS 224N Assignment #1</a>：准备上2019年的新版了。待更新。</li><li><a href="https://huangweiran.club/2019/10/04/Tricks-of-training-neural-nets/">Tricks of training neural nets</a>：训练神经网络的一些技巧。</li></ul><h2 id="Programming-Languages-amp-Algorithms"><a href="#Programming-Languages-amp-Algorithms" class="headerlink" title="Programming Languages &amp; Algorithms"></a>Programming Languages &amp; Algorithms</h2><blockquote><p>这应当是程序员的看家本领，在我这里似乎未得到足够重视。日后需要注意。</p></blockquote><h3 id="Python-matplotlib简易作图"><a href="#Python-matplotlib简易作图" class="headerlink" title="Python matplotlib简易作图"></a>Python matplotlib简易作图</h3><blockquote><p>对python3科学计算作图的学习</p></blockquote><ul><li><p><a href="http://huangweiran.club/2018/01/13/python-plotting-1/">Python Plotting-1</a>：学习<strong>Scientific Computing with Python3</strong>第六章的笔记第一部分</p></li><li><p><a href="http://huangweiran.club/2018/01/14/python-plotting-tutorial-2/">Python Plotting-2</a>：学习<strong>Scientific Computing with Python3</strong>第六章的笔记第二部分</p></li><li><p><a href="http://huangweiran.club/2018/01/16/plotting-exercises/">Plotting exercise</a>：本人对<strong>Scientific Computing with Python3</strong>第六章的课后习题的实现</p></li></ul><h3 id="CPSC-223"><a href="#CPSC-223" class="headerlink" title="CPSC 223"></a>CPSC 223</h3><blockquote><p>Yale Univsersity开设的一门数据结构基础课，内容涵盖面非常广。</p></blockquote><p><a href="https://github.com/EtoDemerzel0427/Misc-Notes/tree/master/CPSC Notes" target="_blank" rel="noopener">My CPSC Notes</a></p><h2 id="Tech-Posts"><a href="#Tech-Posts" class="headerlink" title="Tech Posts"></a>Tech Posts</h2><blockquote><p>包括一些软件的下载安装配置等。主要供我自己记录，方便日后查找。</p><p>不过之后这样的东西我应该会倾向于放在TiddlyWiki上。</p></blockquote><p><a href="http://huangweiran.club/2018/01/04/%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B%E8%BF%99%E4%B8%AA%E5%8D%9A%E5%AE%A2%E7%9A%84/">我是如何建立这个博客的</a>：使用Github Pages+Hexo建立一个独立博客</p><p><a href="http://huangweiran.club/2018/05/09/%E6%95%99%E7%A8%8B%EF%BC%9A%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%9C%8D%E5%8A%A1%E5%99%A8/">教程：如何配置深度学习服务器</a>：标题言过其实了，这篇博客记录的是<strong>在一台已经配置好的深度学习服务器上</strong>配置自己的环境；当然在PC上也没差。</p><p><a href="http://huangweiran.club/2018/05/14/%E7%BF%BB%E8%AF%91%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8Jupyter-notebook%E4%B8%AD%E5%AE%89%E8%A3%85Python%E5%8C%85%EF%BC%9F/">翻译：如何在Jupyter notebook中安装Python包？</a>不仅是一个教程，更包含了一个软件的设计思想；翻译的时候我的知识仍然有限，之后有空可能会更正一下。</p><p><a href="http://huangweiran.club/2018/09/02/%E6%97%B6%E9%9A%94%E4%B9%9D%E6%9C%88%EF%BC%8C%E6%9B%B4%E6%94%B9%E5%8D%9A%E5%AE%A2%E5%A4%96%E8%A7%82%E9%85%8D%E7%BD%AE/">时隔九月，更改博客外观配置</a>：对博客一些新设置的记录，自娱自乐。</p><h2 id="Book-Reviews"><a href="#Book-Reviews" class="headerlink" title="Book Reviews"></a>Book Reviews</h2><blockquote><p>记录我读过的书以及我对它们的感想。以文学类为主。</p></blockquote><p><a href="http://huangweiran.club/2018/01/10/%E3%80%8A%E5%8C%97%E9%B8%A2%E3%80%8B%EF%BC%9A%E4%B8%80%E6%AC%A1%E9%87%8E%E5%BF%83%E8%B6%85%E8%B6%8A%E4%BA%86%E8%83%BD%E5%8A%9B%E7%9A%84%E5%B0%9D%E8%AF%95/">《北鸢》：一次野心超越了能力的尝试</a>：读葛亮 《北鸢》</p><p><a href="http://huangweiran.club/2018/02/24/%E5%8D%97%E6%9C%9D%E9%87%91%E7%B2%89%E5%A4%AA%E5%B9%B3%E6%98%A5%EF%BC%8C%E4%B8%87%E9%87%8C%E5%B1%B1%E6%B2%B3%E5%A4%84%E5%A4%84%E9%9D%92/">南朝金粉太平春，万里山河处处青</a>：读张恨水《金粉世家》</p><h2 id="Mathematics"><a href="#Mathematics" class="headerlink" title="Mathematics"></a>Mathematics</h2><blockquote><p>我对数学知识的一些记录。</p></blockquote><p><a href="http://huangweiran.club/2018/01/29/Introduction%20to%20Markov%20chain/">Introduction to Markov chain</a>：关于马尔可夫链的一些证明与应用（未完待续）</p><h2 id="GRE同义词分类"><a href="#GRE同义词分类" class="headerlink" title="GRE同义词分类"></a>GRE同义词分类</h2><blockquote><p>本人使用Google Sheets对GRE词汇的一个粗略分类。</p></blockquote><p><a href="https://docs.google.com/spreadsheets/d/1jPARXPYQy4qXxdZXRm5sWZdp2R_3IOMSOZPMdD_Vrpg/edit#gid=0" target="_blank" rel="noopener">同义词分类</a></p>]]></content>
      
      
      <categories>
          
          <category> all </category>
          
      </categories>
      
      
        <tags>
            
            <tag> links </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tricks of training neural nets</title>
      <link href="2019/10/04/Tricks-of-training-neural-nets/"/>
      <url>2019/10/04/Tricks-of-training-neural-nets/</url>
      
        <content type="html"><![CDATA[<p>How to train neural networks has been a huge challenge to researchers since the very first day of deep learning. <a id="more"></a>Unlike most classic machine learning algorithms, neural networks, especially deep ones, require more data and more parameters to tune, which make them more versatile, powerful and scalable to express the distribution of  real-world data, but also create huge difficulty for training.</p><p>Neural networks, or artificial neural networks(ANNs), are said to be inspired by the biological neurons. It was first introduced in 1943 (surprisingly early, uh?), but progress was slow.  The training technique remained challenging until the invention of back propagation in 1986. In short, it is still gradient descent as in many classic machine learning algorithms, but back propagation combines it with chain rule. Back propagation is an algorithm that is still widely used today, and it is with no doubt one of the biggest breakthroughs in the history of deep learning. With this algorithm, for the first time people began to believe that it is feasible to train a neural network. However, due to the complex hypothesis space, training a neural net still requires much experiences and some fancy tricks, and this is why I am writing this blog post today.</p><p>Most part of this article comes from the wonderful book, <em>Hands on Machine Learning with Scikit-learn and Tensorflow, 2nd edition</em>, many thanks to the authors.</p><h2 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h2><h3 id="Tools-for-optimization"><a href="#Tools-for-optimization" class="headerlink" title="Tools for optimization"></a>Tools for optimization</h3><p>Grid search and randomized search have been universal solutions to fine-tuning the hyperparamters for most machine learning algorithms, and luckily, they can be applied to deep learning too. If you are using Keras or tf.Keras, you are super lucky because you can wrap up your Keras models with <code>keras.wrappers.scikit_learn</code>, so that you can use <code>GridSearchCV</code> and <code>RandomizedSearchCV</code> in scikit-learn. </p><p>You can also use some Python libraries to optimize hyperparameters, for example, Hyperopt, hyperas, Scikit-Optimize. Also, companies like Google are offering hyperparameter optimization services now, such as hyperparameter tuning services provided by Google Cloud ML Engine. Moreover, nowadays, AutoML has been a heated topic, and there have been such kind of services available: maybe the handmade training era will end soon?</p><p>It is possible, and very promising. But we have to admit there is still a long way to go, and that is why you still need to learn about training tricks today.</p><h3 id="Tips-for-tuning-hyperparamters"><a href="#Tips-for-tuning-hyperparamters" class="headerlink" title="Tips for tuning hyperparamters"></a>Tips for tuning hyperparamters</h3><p>We all know deeper networks can model more complex functions, but they are harder to train. So when we are designing our models, it can be tough to decide <strong>the number of hidden layers</strong>. For this, the best (and maybe easiest) practice could be gradually ramp up the numbers until starting to overfitting.</p><p>Another hyperparameter you have to consider is <strong>the number of neurons per layer</strong>. People found that using the same number of neurons in all hidden layers performs good enough. It is good because in this way we only have one hyperparameter to tune instead of one per layer. Just like for the number of layers, we can try increasing the number of neurons gradually until the network starts overfitting. But experience tells us it is hard to implement. A simpler approach is to pick a model with more layers and neurons than we actually need, and then use <strong>early stopping</strong> and other regularization techniques such as <strong>dropout</strong> to prevent our nets from overfitting.</p><p>Other hyperparameters includes the <strong>learning rate, batch size</strong> and so on. As for the <strong>learning rate</strong>, in general, the optimal learning rate is about half of the maximum learning rate. So we can start with a large learning rate that will make our training algorithm diverge, and then divide the value by 3 and try again, and repeat until the training algorithm stops diverging. The optimal <strong>batch size</strong> is usually lower than 32. We know larger batch size can lead to more precise estimate of the gradients, but since we normally will not use the vanilla gradient descent, the precision of gradients are not that important than for other machine learning algorithms. On the other hand, however, we know, having a larger batch means higher degree of parallelism and therefore, faster training. So normally the batch size will not exceed 32, but will also not be too small. Note that if you use batchNorm, the size should generally larger than 20. Further, we don’t really need to tweak the number of training iterations, because <strong>early stopping</strong> is preferred.</p><h2 id="Advanced-Topics"><a href="#Advanced-Topics" class="headerlink" title="Advanced Topics"></a>Advanced Topics</h2><h3 id="Activation-functions"><a href="#Activation-functions" class="headerlink" title="Activation functions"></a>Activation functions</h3><p><strong>Gradient vanishing</strong> is a long-existing problem when training deep neural nets. It refers to the phenomenon that the gradients get smaller and smaller as back propagation progresses down to the lower layers. When gradient vanishing happens, the weights of lower layers remains hardly changed because their gradients are neglectable.</p><p>In 2010, a paper written by Xavier Glorot and Yoshua Bengio(one of the Turing Award receiver in 2018) dived deep in this problem, and found a few suspects. One of these suspects is the sigmoid activation function and the normal distribution initialization scheme. They found that under this setting, the variance of the outputs is much greater than the inputs and will keeps increasing until the sigmoid function saturates, i.e. gets close to the value 0 or 1. When it saturates, the gradients are close to zero so there is virtually no gradient to propagate back through the network, then gradient vanishing happens.</p><p>Glorot and Bengio argue that to solve this problem, we need <strong>the variance of the outputs of  outputs of each layer to be equal to the variance of its input, we also need the gradients to have equal variance before and after flowing through a layer in the reverse direction</strong>. They further proposed a novel initialization method, called Xavier initialization or Glorot initialization. The pseudo-code is as below:</p><pre class=" language-pseudocode"><code class="language-pseudocode">for-each input-hidden weight  variance = 2.0 / (fan-in +fan-out)  stddev = sqrt(variance)  weight = gaussian(mean=0.0, stddev)end-for</code></pre>As you can see, it is just a normal distribution with mean 0 and variance $\sigma^2 = \dfrac{2}{\text{fan}_{in} + \text{fan}_{out}}$There is also a uniform distribution version: the range of this uniform distribution is from $-\sqrt{\dfrac{6}{(\text{fan}_{in} + \text{fan}_{out})}}$  to $\sqrt{\dfrac{6}{(\text{fan}_{in} + \text{fan}_{out})}}$.Glorot initialization proves good for activation functions like linear(i.e. no activation), tanh, sigmoid and softmax. There are also some variants, whose difference is only the scale of the variance and whether they use $\text{fan}_{in}$ or $\text{fan}_{avg} = \dfrac{\text{fan}_{in} + \text{fan}_{out}}{2}$. For example, He initialization is suitable for ReLU and its variants like ELU, and its variance is $\dfrac{2}{\text{fan}_{in}}$. LeCun initialization differs from Glorot only in that it uses $\text{fan}_{in}$ instead of $\text{fan}_{avg}$, and it is for SELU.All these methods have uniform version, you can get the range $r$ by the equation: $r =\sqrt{3\sigma^2}$. <p>Keras uses Glorot initialization with a uniform distribution by default.</p><p>Because of Glorot and Bengio, people started to realize that ReLU is a better activation function than sigmoid in deep learning, for the positive values will not saturate and it is quite fast to compute. But ReLU also has its own drawbacks.  The problem is called <em>dying ReLUs</em>: during training, some neurons stop output anything but 0, so they are effectively dead. To solve this, people came up with some variants of ReLU, for example, the leaky ReLU = $\max(\alpha z,z)$ and the randomized leaky ReLU(RReLU). The parametric leaky ReLU treats $\alpha$ as a learnable parameter. Experiments show it strongly outperforms ReLU on large image datasets but tends to overfit on smaller datasets.</p><p>In 2015, a new activation function called <em>exponential linear unit</em>(ELU) was proposed. It is reported to outperform all ReLU variants both in training time and the results of the test set. The only difference between ELU and leaky ReLU is that its negative part is $\alpha(\exp(z) - 1)$ instead of $\alpha z$. Notice that the exponential function makes it slower at test time. SELU is just a scaled version of ELU.</p><p>From practice, we say in general SELU &gt; ELU &gt; leaky ReLU (and its variants) &gt; ReLU &gt; tanh &gt; sigmoid.</p><h3 id="Optimizers"><a href="#Optimizers" class="headerlink" title="Optimizers"></a>Optimizers</h3><p>Since we are talking about <em>tricks</em> here, the algorithm details of each optimizer will not be emphasized. For more details, refer to the book I mentioned above, it has a wonderful introduction to these optimizers.</p><ul><li>Tl;dr, use Adam. But if you found your dataset may just be allergic to adaptive gradients, try plain NAG.</li><li>When using momentum, the momentum value of 0.9 usually works well.</li><li>Nesterov Accelerated Gradient(NAG) is a small variant of momentum, and <strong>is always faster than vanilla Momentum optimization</strong>.</li><li>Adagrad often stops too early when training neural networks.</li><li>RMSProp fixes the problem of Adagrad by accumulating only the gradients from the most recent iterations, the decay rate is typically set to 0.9 and it almost works well for all cases so you don’t have to tune it. Except on very simple problems, it almost always beats Adagrad.</li><li>Adam combines the idea of momentum and RMSProp.  The momentum decay hyperparameter is typically set to 0.9, while the scaling decay hyperparameter is often initialized to 0.999. <strong>Since Adam is an adaptive learning rate algorithm, it requires less tuning of the learning rate</strong>.</li></ul><h3 id="Batch-normalization"><a href="#Batch-normalization" class="headerlink" title="Batch normalization"></a>Batch normalization</h3><p>In a 2015 paper, Sergey Ioffe and Christian Szegedy proposed a technique called <em>Batch Normalization (BN)</em> to address the vanishing/exploding gradients problems.</p><p>The technique consists of adding an operation in the model just before or after the activation function of each hidden layer, simply zero-centering and normalizing each input, then scaling and shifting the result using two new parameter vectors per layer: one for scaling, the other for shifting. In other words, this operation <strong>lets the model<br>learn the optimal scale and mean of each of the layer’s inputs</strong>. </p><p>This method is thoroughly discussed all over the internet, and the steps are quite clear and simple, so I will not talk about the algorithm details here.  </p><p>The authors claimed that this technique considerably improved <strong>all the DNNs</strong> they experimented with. The vanishing gradients problem was strongly reduced and the networks become less sensitive to the weight initialization. They were able to use large learning rates to speed the training process.</p><h3 id="Gradient-clipping"><a href="#Gradient-clipping" class="headerlink" title="Gradient clipping"></a>Gradient clipping</h3><p>Though it achieved very good performance, BatchNorm is tricky to use in RNNs. One method to deal with <strong>gradient exploding</strong> is gradient clipping. </p><p>In Keras, implementing gradient clipping can be achieved by just setting the <code>clipvalue</code> or <code>clipnorm</code> argument when creating an optimizer:</p><pre class=" language-python"><code class="language-python">optimizer <span class="token operator">=</span> keras<span class="token punctuation">.</span>optimizer<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>clipvalue<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>lose<span class="token operator">=</span><span class="token string">"mse"</span><span class="token punctuation">,</span> optimizer<span class="token operator">=</span>optimzer<span class="token punctuation">)</span></code></pre><p>With the above code,  every component of the gradient vector will be clipped to a value between -1.0 and 1.0. In practice it works quite good, but you may argue that by doing this, the direction of the gradient vector will be changed drastically under this setting. For example, if the gradient vector is [0.9, 100], after clipping you will get [0.9, 1.0]. To avoid this, you may try the argument <code>clipnorm</code>, <strong>this will clip the whole gradient if its L2 norm is greater than the threshold</strong>. Like we said, simply performing clipping by value is good enough in most cases. In practice you may try both and see the results on the validation set to decide.</p><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><p>The book actually covers much more than what I mentioned above, for example, reusing pretrained layers, dropout and MC dropout. You should visit chapter 10 and chapter 11 if you need more guidelines.</p><p>I will also actively add other topics into this article whenever I found some tricks useful.</p>]]></content>
      
      
      <categories>
          
          <category> ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Deep Learning </tag>
            
            <tag> tutorial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Machine Learning Topics</title>
      <link href="2019/06/07/Machine-Learning-Topics/"/>
      <url>2019/06/07/Machine-Learning-Topics/</url>
      
        <content type="html"><![CDATA[<p>接触机器学习快两年的工夫，时常会深感自己理论基础的薄弱。但在实验室一年，更多的时候是在接触更前沿的技术，而无暇去补足基础知识的缺失和零散，导致现在知识难成体系。这对我个人的发展是一个不可忽视的问题。</p><a id="more"></a><p>最近越来越觉得，学习一个学科，了解一个领域，最重要的是要有<strong>大局观（Big picture）</strong>。在选择某个子领域去精进之前，你必须对整个领域有一个大致的把握。如今各个领域的交叉性日益显著，只守着自己的一亩三分地，很容易把自己的思维限制住。这可能也是为什么有人会说学深度学习的人也不能忽视传统机器学习，做NLP的人也得关注CV。</p><p>因此我想在这个夏天把我的知识体系化。目前我开始复习一些知识，整理一些笔记，希望能在美国这几个月的清闲时间里完成这项工作。</p><p>目前已完成的有：</p><ul><li>2019/07/24：<a href="https://github.com/EtoDemerzel0427/Misc-Notes/blob/master/Machine%20Learning%20Notes/Decision%20Trees.pdf" target="_blank" rel="noopener">Decision Trees</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ML </tag>
            
            <tag> Scikit-learn </tag>
            
            <tag> Tensorflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我是如何建立这个博客的</title>
      <link href="2019/06/06/%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B%E8%BF%99%E4%B8%AA%E5%8D%9A%E5%AE%A2%E7%9A%84/"/>
      <url>2019/06/06/%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E5%BB%BA%E7%AB%8B%E8%BF%99%E4%B8%AA%E5%8D%9A%E5%AE%A2%E7%9A%84/</url>
      
        <content type="html"><![CDATA[<p>也许每个程序员都该拥有自己的博客。</p><a id="more"></a><p><strong>Update on 2018/8/12</strong>: replaced the failed link.</p><p>我的个人博客 <a href="http://www.huangweiran.club" target="_blank" rel="noopener">My trantor</a> 于 <strong>2018年1月2日</strong> 搭建成功。</p><p>我采用的是<strong>GitHub Pages + hexo</strong> 这一常见的方式。整个过程除了购买域名<a href="http://www.huangweiran.club" target="_blank" rel="noopener">www.huangweiran.club</a> （购自腾讯云，花费人民币2元，<strong>Update</strong>: 续费花了60块……），没有任何花销。</p><p>搭建过程中，主要的参考资料包括：</p><ol><li><p><a href="http://www.lovebxm.com/2018/06/24/hexo-github-blog/" target="_blank" rel="noopener">可能是最详细的 Hexo + GitHub Pages 搭建博客的教程</a>：这篇文章介绍得非常详细，几乎涵盖了建立博客的方方面面。</p><p><strong>Update on 2019/06/06</strong>: 作者的域名已经过期，网站无法访问。但是这篇博客仍然保存在作者的Github上，可以在<a href="https://github.com/bxm0927/bxm0927.github.io/blob/80f813a9896b8eb97bc12d5d175e10e12d832bc3/2018/06/24/hexo-github-blog/index.html" target="_blank" rel="noopener">这里</a>下载html，然后通过浏览器打开阅读。这篇的确是写的非常详细，不能访问有点可惜了。</p></li><li><p><a href="https://material.viosey.com/" target="_blank" rel="noopener">material主题官方网站</a>：我使用的主题是<strong>material</strong>，在这个网站上你可以下载该主题，并阅读官方文档以执行相关配置。当然你完全可以选择其他主题，甚至自己写一个主题（不过我对前端一无所知）。</p></li><li><p><a href="https://hexo.io/" target="_blank" rel="noopener">hexo官网</a>：阅读官方文档，选择你喜欢的主题。</p></li></ol><p>通过<strong>GitHub Pages + hexo</strong> 建立博客，你也许还需要：</p><ol><li>了解基本的 <strong>Git/GitHub</strong> 操作（不用很深入，如果你只是想写博客的话）。</li><li>了解<strong>Markdown</strong> 语法。<strong>Markdown</strong>是一款非常简单易学的标记语言，点击<a href="https://www.jianshu.com/p/q81RER" target="_blank" rel="noopener">这里</a>你可以很快学会它。</li></ol><p>关于我在自定义博客的其他配置，请参考更新的博文<a href="https://huangweiran.club/2018/09/02/%E6%97%B6%E9%9A%94%E4%B9%9D%E6%9C%88%EF%BC%8C%E6%9B%B4%E6%94%B9%E5%8D%9A%E5%AE%A2%E5%A4%96%E8%A7%82%E9%85%8D%E7%BD%AE/">时隔九月，更改博客外观配置</a>。</p>]]></content>
      
      
      <categories>
          
          <category> tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tutorial </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简短的年终总结</title>
      <link href="2018/12/12/%E7%AE%80%E7%9F%AD%E7%9A%84%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
      <url>2018/12/12/%E7%AE%80%E7%9F%AD%E7%9A%84%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>本来今年不太想写年终总结了，但不太忍心断了这两年来的传统，所以就写个简单点的吧。<a id="more"></a></p><p>我在之前已经写过一篇<a href="https://huangweiran.club/2018/08/13/%E8%B0%88%E8%B0%88%E8%BF%91%E5%86%B5/">类似总结的文章</a>了，很多东西不消重复；而且往年的年终总结我总是废话连篇，煽情过多，把这些砍掉应该字数也能得到压缩。因此，“简短”应该不是很难办到的事情。</p><h2 id="2018"><a href="#2018" class="headerlink" title="2018"></a>2018</h2><p>在我自己的印象里，2018是过得非常快的一年，我好像什么也没做；但仔细一回顾，又好像发生了非常多的事情，让这一年显得很长（“原来我考GRE是今年不是去年啊？”）。</p><p>实际上，2018年我做了的事情包括：</p><ol><li>分别参加了一次GRE（3月17日）和TOEFL（10月20日）考试，分别取得了152+170+4和103（S23）的平庸成绩。比起身边其他的一些同学这分数算不得多优秀；但如果要求低的话，我已经可以拿这样的语言成绩去申请了。在英语方面我从来都还算有自信，在准备两场考试的时候虽然说也浪费了很多宝贵时间，但也勉强算得上执行了计划、没有手忙脚乱，相信下次考会更好。</li><li>加入了中科院自动化所吴书老师的实验室做一名菜得抠脚的实习生。在三月份我写邮件给吴老师的时候，我只是一个刚刚接触机器学习不久的学生（所有的基础就是完成了Coursera上吴恩达的ML课程），但很感谢吴老师能提供我这个机会。尽管现在我的科研进展仍然是没有任何成果，但我能感到在这里收获了不少东西；最大的遗憾应该是我自己不够努力，在这么长的时间里没有弄出什么东西。</li><li>了却了上一年的一个巨大遗憾。这个在上面那篇文章里已经说过了，不再细谈。</li><li>在其他的<strong>某个</strong>方面，至少算是做了一次尝试。也许过程很愚蠢，也没有得到什么结果，但至少比什么也不做强。具体就不足为外人道了。</li></ol><p>这一年我对自己不满意的地方：</p><ol><li>GRE备考的时候方法出现了问题。把背单词和做题割裂了以至于后期做题忘了单词，所以Verbal考得很糟糕。</li><li>实验室实习真的很不努力。该补的基础知识没好好补上，平时也经常分神。这个先不说了，我现在就是在实验室里写年终总结……orz。</li><li>没能找到“自己想做的事情”和课业之间的平衡。如大学的前两年一样，目前我仍然在课业里挣扎，试图用最后一个月把几个月没学的东西补上。</li><li>没能好好学数学，没能好好学算法。</li><li>没能好好读书。上半年颇看了几本书，下半年Kindle的作用就只剩压泡面了，万幸我吃泡面的频率还挺高的，极大提高了Kindle的利用率。</li></ol><h2 id="2019"><a href="#2019" class="headerlink" title="2019"></a>2019</h2><p>2016年的夏天，我把我的微信签名改成了“蛰伏期四年”，希望我能用大学的时间好好沉潜，争取四年后改头换面重新做人。前几年我走了一些很弯很弯的弯路，幸运的是还能抢救；2019年是非常关键的一年，这一年的下半年就是申请季。可以说我所谓“蛰伏”的结果，就看2019这一年如何度过了。</p><p>所以我希望我2019年可以做到：</p><ol><li>好好实习，争取在自动化所完成一到两个工作；暑假在NUS的话……还得看情况了，目前不敢胡乱许愿。</li><li>把GRE和TOEFL都再考一次，尽量达到自己的要求。</li><li>大三下是大学里最后一个学习的学期……尽量……学好一点吧？</li><li>上LeetCode好好刷题，数学先随缘了，人得现实点。</li></ol><p>是的，我没有像往年一样设定什么读书计划。2019年我要过得非常功利，有什么享受人生的事情，我们2020见。</p><p>祝包括我在内的各位新的一年一切顺利，都能实现自己的梦想。</p><p><strong>另外有一份单独的祝福送给我一位最好的朋友，2019年一切都会好起来的，因为神会做你的盾牌；还有请不要忘记，无论经历什么，我永远会是你可以指望的那个人。</strong> </p><h2 id="半年后的更新"><a href="#半年后的更新" class="headerlink" title="半年后的更新"></a>半年后的更新</h2><p>现在是2019年6月6日。整整半年我没有更新过博客，也不是忙（事实上这个学期整个人开始犯懒了），只是好像突然失去了这个习惯。</p><p>上一次写这篇年终总结时正在准备期末，如今再打开自己的博客，又是一个学期末了。回头看这半年，之前定的计划实现情况算是一半一半。</p><p>在自动化所的实习算是完结，只完成了一个工作，目前NeurIPS在投，希望有个好结果；而NUS……这段实习没能成行，据说是我预计要参与的那个项目被砍了；我在春节期间联系了PSU的王苏杭老师，只是目前签证仍在check。老实说我还是觉得有些遗憾，毕竟NUS之前是说会给工资的。</p><p>托福和GRE倒是都再考了一次，只是GRE的结果不甚满意。托福终于算是考出来了，107(23)应该怎样也是够的。</p><p>而上面的第三条……当时写的时候我自己就不大信。具体不多说了，我现在还在预习。</p><p>LeetCode刷了几十道吧，还不太够。如果去美国，希望能好好刷刷题，毕竟回来就要找实习了。</p><p>这些情况老实讲也算是预料之中。唯一没预料到的是，我之前说的那次“失败的尝试”最终居然成功了。到明天我和她就在一起100天整了。</p><h2 id="又过了半年的更新"><a href="#又过了半年的更新" class="headerlink" title="又过了半年的更新"></a>又过了半年的更新</h2><p>到了申请季前的紧张关头。</p><p>今天我们的paper在辗转NeurIPS和AAAI后终于还是被拒了，而之前的暑研也不顺利，我几乎是落荒而逃的。想来我的科研终究是这样以零成果告终。</p><p>GRE我又考了一次。没有经过什么准备，324，那就这样吧，和我最初的预期有差距。拿国奖的室友一个暑假准备GT，两个都比我高，找实习也比我顺利。嗯，到毕业前也终于知道自己几斤几两了。</p><p>现在是有在实习，前mentor答应给我写推荐信，看起来也很喜欢我。</p><p>所以凑凑合合，一路擦线，我所预期的事情就这样很勉强地大多完成了。只差最后一个，申请。试试看吧。</p>]]></content>
      
      
      <categories>
          
          <category> all </category>
          
      </categories>
      
      
        <tags>
            
            <tag> life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Plotting exercises</title>
      <link href="2018/11/17/plotting-exercises/"/>
      <url>2018/11/17/plotting-exercises/</url>
      
        <content type="html"><![CDATA[<p>My personal implementation for the exercises for chapter 6 in the book scientific computing with Python3.</p><a id="more"></a> <pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">import</span> <span class="token operator">*</span><span class="token operator">%</span>matplotlib inline</code></pre><h1 id="Before-we-start"><a href="#Before-we-start" class="headerlink" title="Before we start"></a>Before we start</h1><p>This article is the solutions to exercises in the book <strong><em>scientific computing with Python3</em></strong> chapter 6 <strong>Plotting</strong>.</p><p>All the solutions are given by <strong>Waiyin Wong</strong>, to whom the copyright belongs.</p><p>There are 6 exercises in total, but because of the final examinations, this article have to be updated later.</p><p><strong>Update</strong>: I’ve finished all the 6 exercises on Jan 23rd, 2018.</p><h1 id="Plotting-exercises"><a href="#Plotting-exercises" class="headerlink" title="Plotting exercises"></a>Plotting exercises</h1><blockquote><p><strong>Ex. 1</strong>   Write a function that plots <strong>an ellipse</strong> given its center coordinates  $(x,y)$ , the half axis  $a$ and  $b$ rotation angle $\theta$.</p></blockquote><p>Here we assume $\theta$ is the degree of angle that we rotate the standard ellipse, in order to get our one.(let’s say, <strong>counter-clockwise</strong>)</p><p>In other word, there is a <strong>linear mapping</strong> between the coordinates after rotation  $(x’,y’)$ and the original $(x,y)$:</p><p>$$<br>\left[\begin{matrix}x’ \\ y’\end{matrix}\right] = \left[\begin{matrix}cos\theta &amp; -sin\theta \\ sin\theta &amp; cos\theta\end{matrix}\right]\left[\begin{matrix}x \\ y\end{matrix}\right]<br>$$</p><p>or, in another form:</p><p>$$<br>\left[\begin{matrix}x \\ y\end{matrix}\right] = \left[\begin{matrix}cos\theta &amp; sin\theta \\ -sin\theta &amp; cos\theta\end{matrix}\right]\left[\begin{matrix}x’ \\ y’\end{matrix}\right]<br>$$</p><p>where $x,y$ satisfy：<br>$$<br>\frac{x^2}{a^2} + \frac{y^2}{b^2} = 1<br>$$</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">draw_ellipse</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> x0<span class="token punctuation">,</span> y0<span class="token punctuation">,</span> theta<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''    to draw a ellipse given the half axis a,b and the rotation angle theta.    theta is given in radians.    '''</span>    x<span class="token punctuation">,</span>y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span>a<span class="token number">-1</span><span class="token punctuation">,</span> a<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span>a<span class="token number">-1</span><span class="token punctuation">,</span>a<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    contour<span class="token punctuation">(</span>x<span class="token operator">*</span>cos<span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token operator">-</span>y<span class="token operator">*</span>sin<span class="token punctuation">(</span>theta<span class="token punctuation">)</span> <span class="token operator">+</span> x0<span class="token punctuation">,</span> x<span class="token operator">*</span>sin<span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token operator">+</span>y<span class="token operator">*</span>cos<span class="token punctuation">(</span>theta<span class="token punctuation">)</span> <span class="token operator">+</span> y0<span class="token punctuation">,</span> x<span class="token operator">**</span><span class="token number">2</span><span class="token operator">/</span>a<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> y<span class="token operator">**</span><span class="token number">2</span><span class="token operator">/</span>b<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>draw_ellipse<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>pi<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span>title<span class="token punctuation">(</span><span class="token string">'an example ellipse'</span><span class="token punctuation">)</span></code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pzt1xI.png" alt="output_2_1.png-9kB"></p><p>There is another way to draw an ellipse except using the command <code>contour</code>.</p><p>Consider the <strong>parametric equation of an ellipse</strong>(standard form):</p><p>$$<br>\begin{equation}<br>\begin{cases}<br>x = a \cdot cos\alpha\\<br>y = b \cdot sin\alpha<br>\end{cases}<br>\end{equation}<br>$$</p><p>The rotation can be done the same way as above.</p><p>So we can do as below: </p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">draw_ellipse2</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> x0<span class="token punctuation">,</span> y0<span class="token punctuation">,</span> theta<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''    to draw a ellipse given the half axis a,b and the rotation angle theta.    theta is given in radians.    '''</span>    alpha <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>    x <span class="token operator">=</span> a <span class="token operator">*</span> cos<span class="token punctuation">(</span>alpha<span class="token punctuation">)</span>    y <span class="token operator">=</span> b <span class="token operator">*</span> sin<span class="token punctuation">(</span>alpha<span class="token punctuation">)</span>    x1 <span class="token operator">=</span> x<span class="token operator">*</span>cos<span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token operator">-</span>y<span class="token operator">*</span>sin<span class="token punctuation">(</span>theta<span class="token punctuation">)</span>    y1 <span class="token operator">=</span> x<span class="token operator">*</span>sin<span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token operator">+</span>y<span class="token operator">*</span>cos<span class="token punctuation">(</span>theta<span class="token punctuation">)</span>    plot<span class="token punctuation">(</span>x1 <span class="token operator">+</span> x0<span class="token punctuation">,</span> y1 <span class="token operator">+</span> y0<span class="token punctuation">)</span>    axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># set the axis</span>draw_ellipse2<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> pi<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span> draw_ellipse2<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztJqf.png" alt="output_4_0.png-10.8kB"></p><p><br><br></p><blockquote><p><strong>Ex. 2</strong>  Write a short program that takes a 2D array, e.g., the preceding Mandelbrot contour image, and iteratively replace each value by the average of its neighbors. Update a contour plot of the array in a figure window to animate the evolution of the contours. Explain the behavior.</p></blockquote><p>We’ve mentioned how to use the command <code>imshow</code> to draw the Mandelbrot fractal in <a href="http://huangweiran.club/2018/01/13/python-plotting-1/">this article</a>. Now we need only to change a bit our former code by introduce the command <code>contour</code> instead.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">mandelbrot</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span> maxit<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    X<span class="token punctuation">,</span>Y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.4</span><span class="token punctuation">,</span> <span class="token number">1.4</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>    c <span class="token operator">=</span> X <span class="token operator">+</span> Y<span class="token operator">*</span><span class="token number">1j</span>    z <span class="token operator">=</span> c    exceeds <span class="token operator">=</span> zeros<span class="token punctuation">(</span>z<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span>bool<span class="token punctuation">)</span>    <span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span>maxit<span class="token punctuation">)</span><span class="token punctuation">:</span>         z <span class="token operator">=</span> z<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> c         exceeded <span class="token operator">=</span> abs<span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">4</span>         exceeds_now <span class="token operator">=</span> exceeded <span class="token operator">&amp;</span> <span class="token punctuation">(</span>logical_not<span class="token punctuation">(</span>exceeds<span class="token punctuation">)</span><span class="token punctuation">)</span>          exceeds<span class="token punctuation">[</span>exceeds_now<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>          z<span class="token punctuation">[</span>exceeded<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment" spellcheck="true"># limit the values to avoid overflow</span>    <span class="token keyword">return</span> exceedsfigure<span class="token punctuation">(</span>figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#imshow(mandelbrot(400,400),cmap='gray')</span><span class="token comment" spellcheck="true">#contour(mandelbrot(400,400), levels=logspace(-4.7, 3., 10), colors='black', alpha=0.5)</span>contour<span class="token punctuation">(</span>mandelbrot<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span> colors <span class="token operator">=</span> <span class="token string">'black'</span><span class="token punctuation">)</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span></code></pre><pre><code>(0.0, 399.0, 0.0, 399.0)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztUIg.png" alt="output_6_1.png-21.9kB"></p><p>Then let’s see back to the questions.</p><p>you should remember the code below:</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">avg</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">""" simple running average """</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>roll<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> x <span class="token operator">+</span> roll<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token comment" spellcheck="true"># sine function with noise</span>x <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>y <span class="token operator">=</span> sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.4</span><span class="token operator">*</span>rand<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># make successive subplots</span><span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> iteration <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'{:d} average{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>iteration<span class="token punctuation">,</span> <span class="token string">'s'</span> <span class="token keyword">if</span> iteration <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    legend<span class="token punctuation">(</span>loc <span class="token operator">=</span> <span class="token string">'lower left'</span><span class="token punctuation">,</span> frameon <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>    y <span class="token operator">=</span> avg<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#apply running average</span>subplots_adjust<span class="token punctuation">(</span>hspace <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">)</span></code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztBzn.png" alt="output_8_0.png-23.2kB"></p><p>We can adopt the same method in this case:</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">avg_2d</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''    running average on a 2D array    '''</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>roll<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>axis <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> roll<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>axis <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> x <span class="token operator">+</span> roll<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>axis <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> roll<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> axis <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">5</span>x <span class="token operator">=</span> mandelbrot<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span>figure<span class="token punctuation">(</span>figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    subplot<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> iteration <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    contour<span class="token punctuation">(</span>x<span class="token punctuation">,</span> colors <span class="token operator">=</span> <span class="token string">'CadetBlue'</span><span class="token punctuation">)</span>    title<span class="token punctuation">(</span><span class="token string">'{:d} average{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>iteration<span class="token punctuation">,</span> <span class="token string">'s'</span> <span class="token keyword">if</span> iteration <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    x <span class="token operator">=</span> avg_2d<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># apply running average</span>subplots_adjust<span class="token punctuation">(</span>hspace <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">)</span></code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pztss0.png" alt="output_10_0.png-106.7kB"></p><p><br></p><blockquote><p>Ex. 3 Consider an $N \times N$ matrix or image with integer values. The mapping</p><p>$$ I:(x,y) \mapsto (2x+y, x+y)\space mod\space N $$</p><p>is an example of a mapping of a toroidal square grid of points onto itself. This has the interesting property that it distorts the image by shearing and then moving the pieces outside the image back using the modulu function <code>mod</code>. Applied iteratively, this results in randomizing the image in a way that eventually returns the original. Implement the following sequence:</p></blockquote><p>$$<br>I^{(m+1)}(x,y) =I^{(m)}(2x+y\space mod\space N, x+y\space mod\space N)<br>$$</p><blockquote><p>and save out the first $N$ steps to files or plot them in a figure window.<br>As an example image, you can use the classic $512 × 512$ Lena test image from <code>scipy.misc</code>.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>misc <span class="token keyword">import</span> lenaI <span class="token operator">=</span> lena<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>The result should look like this:<br><img src="http://huangweiran.club/2018/01/13/python-plotting-1/" alt="lena"></p></blockquote><p>As the example shows we need to deal with an image. But unfortunately we cannot use the example image lena, because it has been removed from <code>scipy.misc</code> for liscence reason.</p><p>We decide to use the image <code>ascent</code> instead as below.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>misc <span class="token keyword">import</span> ascentI <span class="token operator">=</span> ascent<span class="token punctuation">(</span><span class="token punctuation">)</span>imshow<span class="token punctuation">(</span>I<span class="token punctuation">)</span>I<span class="token punctuation">.</span>shape</code></pre><pre><code>(512, 512)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztgdU.png" alt="output_12_1.png-81.3kB"></p><p>But to be honest, I could not really understand this question.<br>I cannot see the point why the image will return to the original. And I think for a $512\times 512$ image, 512 steps is (if it could) not enough to return. So I simply plot the 6 steps here.</p><p>If somebody could understand the problem, <strong>please contact me</strong>. I would be appreciate.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">distort_img</span><span class="token punctuation">(</span>x_range<span class="token punctuation">,</span> y_range<span class="token punctuation">,</span> I<span class="token punctuation">,</span>plt_loc<span class="token punctuation">)</span><span class="token punctuation">:</span>    subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span> plt_loc<span class="token punctuation">)</span>    imshow<span class="token punctuation">(</span>I<span class="token punctuation">)</span>    temp <span class="token operator">=</span> I    <span class="token keyword">for</span> x <span class="token keyword">in</span> range<span class="token punctuation">(</span>x_range<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> y <span class="token keyword">in</span> range<span class="token punctuation">(</span>y_range<span class="token punctuation">)</span><span class="token punctuation">:</span>            temp<span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> I<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">%</span>x_range<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">%</span>y_range<span class="token punctuation">]</span>    I <span class="token operator">=</span> temp    axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>fig <span class="token operator">=</span> figure<span class="token punctuation">(</span>figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#subplot(1,5,1)</span><span class="token comment" spellcheck="true">#imshow(I)</span>x_range<span class="token punctuation">,</span> y_range <span class="token operator">=</span> I<span class="token punctuation">.</span>shape<span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    distort_img<span class="token punctuation">(</span>x_range<span class="token punctuation">,</span> y_range<span class="token punctuation">,</span> I<span class="token punctuation">,</span> iteration <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztWi4.png" alt="output_14_0.png-240.6kB"></p><p><br></p><blockquote><p><strong>Ex. 4</strong>  Reading and plotting on images. SciPy comes with the <code>imread</code> function (in the <code>scipy.misc</code> module) for <strong>reading images</strong>, (refer to section Reading and Writing Images in  Chapter 12, Input and output). Write a short program that reads an image from file and plots  the image contour at a given gray level value overlaid on the original image.</p></blockquote><p><strong>Tips</strong>: You can get a gray level version of the image by averaging the color<br>channels like this: <code>mean(im,axis=2)</code><br>As below:</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>misc <span class="token keyword">import</span> facefigure<span class="token punctuation">(</span><span class="token punctuation">)</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>m <span class="token operator">=</span> face<span class="token punctuation">(</span><span class="token punctuation">)</span>imshow<span class="token punctuation">(</span>m<span class="token punctuation">)</span>n <span class="token operator">=</span> mean<span class="token punctuation">(</span>m<span class="token punctuation">,</span> axis <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>imshow<span class="token punctuation">(</span>n<span class="token punctuation">)</span></code></pre><pre><code>&lt;matplotlib.image.AxesImage at 0x2609cc19518&gt;</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztfJJ.png" alt="output_16_1.png-97.5kB"></p><p>However, you may find one problem that you cannot use the function <code>imread</code> because you did not install the Python imaging library. If you are a windows user, you cannot download it using the command <code>pip</code>. But we can <code>pip</code> its subset `pillow instead.</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Install a pip package in the current Jupyter kernel</span><span class="token keyword">import</span> sys!<span class="token punctuation">{</span>sys<span class="token punctuation">.</span>executable<span class="token punctuation">}</span> <span class="token operator">-</span>m pip install pillow</code></pre><pre><code>Requirement already satisfied: pillow in c:\users\huang\pycharmprojects\review_python\venv\lib\site-packages</code></pre><p>​    </p><p>Then We start to deal with this problem. I chose a pic of Messi and downloaded locally. After that I use <code>imread</code> and <code>imshow</code> to display it. </p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>misc <span class="token keyword">import</span> imreadim <span class="token operator">=</span> imread<span class="token punctuation">(</span>r<span class="token string">'C:\Users\huang\Desktop\My Pics\messi.jpg'</span><span class="token punctuation">)</span>im_gray <span class="token operator">=</span> mean<span class="token punctuation">(</span>im<span class="token punctuation">,</span> axis <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>figure<span class="token punctuation">(</span>figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>imshow<span class="token punctuation">(</span>im<span class="token punctuation">)</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>imshow<span class="token punctuation">(</span>im_gray<span class="token punctuation">)</span>contour<span class="token punctuation">(</span>im_gray<span class="token punctuation">)</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span></code></pre><pre><code>c:\users\huang\pycharmprojects\review_python\venv\lib\site-packages\ipykernel_launcher.py:3: DeprecationWarning: `imread` is deprecated!`imread` is deprecated in SciPy 1.0.0, and will be removed in 1.2.0.Use ``imageio.imread`` instead.  This is separate from the ipykernel package so we can avoid doing imports until(-0.5, 1279.5, 719.5, -0.5)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztqoD.png" alt="output_19_2.png-474.4kB"></p><p>But as is showed in the warning, we know that the function <code>imread</code> is going to be removed from <code>scipy.misc</code>:</p><blockquote><p>DeprecationWarning: <code>imread</code> is deprecated!<br><code>imread</code> is deprecated in SciPy 1.0.0, and will be removed in 1.2.0.<br>Use <code>imageio.imread</code> instead.<br>  This is separate from the ipykernel package so we can avoid doing imports until</p></blockquote><p>We can use <code>imageio.imread</code> instead.</p><blockquote><p>Ex. 5  Image edges. The zero crossings of the 2D Laplacian are a good indication of image<br>edges. Modify the program in the previous exercise to use the <code>gaussian_laplace</code> or<br><code>laplace</code> function from the <code>scipy.ndimage</code> module to compute the 2D Laplacian and<br>overlay the edges on top of the image.</p></blockquote><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy <span class="token keyword">import</span> ndimage<span class="token punctuation">,</span>misc<span class="token keyword">import</span> PILk <span class="token operator">=</span> im_gray<span class="token comment" spellcheck="true">#gray()</span>result <span class="token operator">=</span> ndimage<span class="token punctuation">.</span>gaussian_laplace<span class="token punctuation">(</span>k<span class="token punctuation">,</span>sigma <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>gray<span class="token punctuation">(</span><span class="token punctuation">)</span>figure<span class="token punctuation">(</span>figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>imshow<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># put the two images together to see the difference</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>imshow<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># using the transparency parameter alpha to overlay an image on another</span>imshow<span class="token punctuation">(</span>result<span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">)</span></code></pre><pre><code>&lt;matplotlib.image.AxesImage at 0x250acc04898&gt;&lt;matplotlib.figure.Figure at 0x250adbe1a58&gt;</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztjWd.png" alt="output_22_2.png-225.8kB"></p><p><br></p><blockquote><p>Ex. 6 Reformulate the Mandelbrot fractal example (see section Images and Contours) by<br>using <code>orgid</code> instead of <code>meshgrid</code>, see also the explanation <code>ogrid</code> in <strong><em>Function of two variables</em></strong><br>in Chapter 5, <strong><em>Advanced Array Concepts</em></strong>. What is the difference between <code>orgid</code>, <code>mgrid</code>, and<br><code>meshgrid</code>?</p></blockquote><p>As the question indicating, we have learned something about the <strong>class</strong>(note: not a function) <code>ogrid</code> in previous chapter.<br>It can be used to generate tuples for broadcasting, as the example shows below:</p><pre class=" language-python"><code class="language-python">x<span class="token punctuation">,</span>y <span class="token operator">=</span> ogrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3j</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3j</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n x + y is'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># return a broadcasting result</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span></code></pre><pre><code>[[ 0. ] [ 0.5] [ 1. ]] [[ 0.   0.5  1. ]] x + y is[[ 0.   0.5  1. ] [ 0.5  1.   1.5] [ 1.   1.5  2. ]]</code></pre><p>And as for <code>meshgrid</code>, we know that such an expression</p><pre class=" language-python"><code class="language-python">X<span class="token punctuation">,</span>Y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span>linspace<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>X,Y will are arrays with (m,n) shapes such that $X[i][j]$ and $Y[i][j]$ contains the coordinates of the grid point $P[i][j]$.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">mandelbrot</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span> maxit<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#X,Y = meshgrid(linspace(-2, 0.8, w), linspace(-1.4, 1.4, h))</span>    Y<span class="token punctuation">,</span>X <span class="token operator">=</span> ogrid<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4</span><span class="token punctuation">:</span><span class="token number">1.4</span><span class="token punctuation">:</span>h<span class="token operator">*</span><span class="token number">1j</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token number">8</span><span class="token punctuation">:</span>w<span class="token operator">*</span><span class="token number">1j</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># since the first one is a column vector while the second a row vector</span>    c <span class="token operator">=</span> X <span class="token operator">+</span> Y<span class="token operator">*</span><span class="token number">1j</span>    z <span class="token operator">=</span> c    exceeds <span class="token operator">=</span> zeros<span class="token punctuation">(</span>z<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span>bool<span class="token punctuation">)</span>    <span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span>maxit<span class="token punctuation">)</span><span class="token punctuation">:</span>         z <span class="token operator">=</span> z<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> c         exceeded <span class="token operator">=</span> abs<span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">4</span>         exceeds_now <span class="token operator">=</span> exceeded <span class="token operator">&amp;</span> <span class="token punctuation">(</span>logical_not<span class="token punctuation">(</span>exceeds<span class="token punctuation">)</span><span class="token punctuation">)</span>          exceeds<span class="token punctuation">[</span>exceeds_now<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>          z<span class="token punctuation">[</span>exceeded<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment" spellcheck="true"># limit the values to avoid overflow</span>    <span class="token keyword">return</span> exceedsimshow<span class="token punctuation">(</span>mandelbrot<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span></code></pre><pre><code>(-0.5, 399.5, 399.5, -0.5)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztjWd.png" alt="output_26_1.png-2.5kB"></p><p>We can easily tell the difference between <code>meshgrid</code> and <code>ogrid</code>.<br><code>meshgrid</code> generates two matrix, while ogrid generates one column vector and one row vector, and use <strong>broadcasting</strong> to generate a matrix. You may find <code>meshgrid</code> a little bit superfluous here. Actually it it just an implementation of <strong>MATLAB’s meshgrid</strong>, probably to cater to users coming from a MATLAB background.</p><p>We notice that the question also mentioned the <code>mgrid</code>. So let’s compare the behavior of <code>mgrid</code> and <code>meshgrid</code>.</p><pre class=" language-python"><code class="language-python">x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> linspace<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># a 3*5 array</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>y1<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># a 3*5 array</span></code></pre><pre><code>[[ 1.  2.  3.  4.  5.] [ 1.  2.  3.  4.  5.] [ 1.  2.  3.  4.  5.]][[ 1.  1.  1.  1.  1.] [ 2.  2.  2.  2.  2.] [ 3.  3.  3.  3.  3.]]</code></pre><pre class=" language-python"><code class="language-python">x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> mgrid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">5j</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">3j</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># a 5*3 array</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>y2<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># a 5*3 array</span></code></pre><pre><code>[[ 1.  1.  1.] [ 2.  2.  2.] [ 3.  3.  3.] [ 4.  4.  4.] [ 5.  5.  5.]][[ 1.  2.  3.] [ 1.  2.  3.] [ 1.  2.  3.] [ 1.  2.  3.] [ 1.  2.  3.]]</code></pre><p>It returns just the transpose of the <code>meshgrid</code>.</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
            <tag> learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python plotting tutorial - 2</title>
      <link href="2018/11/17/python-plotting-tutorial-2/"/>
      <url>2018/11/17/python-plotting-tutorial-2/</url>
      
        <content type="html"><![CDATA[<p>The second part of Python plotting tutorial.</p><a id="more"></a><h2 id="Notice-and-copyright-statement"><a href="#Notice-and-copyright-statement" class="headerlink" title="Notice and copyright statement"></a>Notice and copyright statement</h2><p>Before reading this article, <strong>PLEASE READ THE TUTORIAL - 1 FIRST</strong>.</p><p>This article is generated by my <strong>Jupyter notebook</strong>,  using which I am practicing the code from the book <strong><em>Scientific computing with Python3</em></strong> published by <strong>Packt</strong>.</p><p>All the code below are from this book, and the copyright belongs to the author.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">import</span> <span class="token operator">*</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token operator">%</span>matplotlib inline</code></pre><h2 id="matplotlib-objects"><a href="#matplotlib-objects" class="headerlink" title="matplotlib objects"></a>matplotlib objects</h2><p>Sometimes we want to modify our figure later, so we will need <strong>matplotlib objects</strong>.</p><h3 id="the-axes-objects"><a href="#the-axes-objects" class="headerlink" title="the axes objects"></a>the axes objects</h3><pre class=" language-python"><code class="language-python">fig <span class="token operator">=</span> figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>ax <span class="token operator">=</span> subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>x <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># We set up a function that modulates the amplitude of the sin function</span>amod_sin <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token operator">*</span>sin<span class="token punctuation">(</span><span class="token number">25</span><span class="token operator">*</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># and plot both...</span>ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>label <span class="token operator">=</span> <span class="token string">'sin'</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> amod_sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'modsin'</span><span class="token punctuation">)</span></code></pre><pre><code>[&lt;matplotlib.lines.Line2D at 0x156d81da438&gt;]</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pz7Nv9.png" alt="output_3_1.png-13.5kB"></p><p>These two <code>plot</code> commands actually fill the list <code>ax.lines</code> with two  <code>line2D</code> objects.</p><pre class=" language-python"><code class="language-python">help<span class="token punctuation">(</span>subplot<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># from here we know that subplot(111) equals to subplot(1,1,1)</span></code></pre><pre><code>Help on function subplot in module matplotlib.pyplot:subplot(*args, **kwargs)    Return a subplot axes at the given grid position.    Call signature::       subplot(nrows, ncols, index, **kwargs)    In the current figure, create and return an `~.Axes`, at position *index*    of a (virtual) grid of *nrows* by *ncols* axes.  Indexes go from 1 to    ``nrows * ncols``, incrementing in row-major order.    If *nrows*, *ncols* and *index* are all less than 10, they can also be    given as a single, concatenated, three-digit number.    For example, ``subplot(2, 3, 3)`` and ``subplot(233)`` both create an    `~.Axes` at the top right corner of the current figure, occupying half of    the figure height and a third of the figure width.    .. note::       Creating a subplot will delete any pre-existing subplot that overlaps       with it beyond sharing a boundary::          import matplotlib.pyplot as plt          # plot a line, implicitly creating a subplot(111)          plt.plot([1,2,3])          # now create a subplot which represents the top plot of a grid          # with 2 rows and 1 column. Since this subplot will overlap the          # first, the plot (and its axes) previously created, will be removed          plt.subplot(211)          plt.plot(range(12))          plt.subplot(212, facecolor=&#39;y&#39;) # creates 2nd subplot with yellow background       If you do not want this behavior, use the       :meth:`~matplotlib.figure.Figure.add_subplot` method or the       :func:`~matplotlib.pyplot.axes` function instead.    Keyword arguments:      *facecolor*:        The background color of the subplot, which can be any valid        color specifier.  See :mod:`matplotlib.colors` for more        information.      *polar*:        A boolean flag indicating whether the subplot plot should be        a polar projection.  Defaults to *False*.      *projection*:        A string giving the name of a custom projection to be used        for the subplot. This projection must have been previously        registered. See :mod:`matplotlib.projections`.    .. seealso::        :func:`~matplotlib.pyplot.axes`            For additional information on :func:`axes` and            :func:`subplot` keyword arguments.        :file:`gallery/pie_and_polar_charts/polar_scatter.py`            For an example    **Example:**    .. plot:: gallery/subplots_axes_and_figures/subplot.py</code></pre><p>​    </p><p>We can use labels to identify the objects:</p><p>(Here the index <code>il</code> refers to the sin-curve)</p><pre class=" language-python"><code class="language-python"><span class="token keyword">for</span> il<span class="token punctuation">,</span> line <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>ax<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> line<span class="token punctuation">.</span>get_label<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'sin'</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h2 id="Modifying-line-properties"><a href="#Modifying-line-properties" class="headerlink" title="Modifying line properties"></a>Modifying line properties</h2><p>The line object is an element of the list <code>ax.lines</code>. All the properties are collected in an dictionary:</p><pre class=" language-python"><code class="language-python">    dict_keys<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'marker'</span><span class="token punctuation">,</span> <span class="token string">'markeredgewidth'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'clip_box'</span><span class="token punctuation">,</span>    <span class="token string">'solid_capstyle'</span><span class="token punctuation">,</span> <span class="token string">'clip_on'</span><span class="token punctuation">,</span> <span class="token string">'rasterized'</span><span class="token punctuation">,</span> <span class="token string">'dash_capstyle'</span><span class="token punctuation">,</span> <span class="token string">'path'</span><span class="token punctuation">,</span>    <span class="token string">'ydata'</span><span class="token punctuation">,</span> <span class="token string">'markeredgecolor'</span><span class="token punctuation">,</span> <span class="token string">'xdata'</span><span class="token punctuation">,</span> <span class="token string">'label'</span><span class="token punctuation">,</span> <span class="token string">'alpha'</span><span class="token punctuation">,</span> <span class="token string">'linestyle'</span><span class="token punctuation">,</span>    <span class="token string">'antialiased'</span><span class="token punctuation">,</span> <span class="token string">'snap'</span><span class="token punctuation">,</span> <span class="token string">'transform'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">,</span>    <span class="token string">'transformed_clip_path_and_affine'</span><span class="token punctuation">,</span> <span class="token string">'clip_path'</span><span class="token punctuation">,</span> <span class="token string">'path_effects'</span><span class="token punctuation">,</span>    <span class="token string">'animated'</span><span class="token punctuation">,</span> <span class="token string">'contains'</span><span class="token punctuation">,</span> <span class="token string">'fillstyle'</span><span class="token punctuation">,</span> <span class="token string">'sketch_params'</span><span class="token punctuation">,</span> <span class="token string">'xydata'</span><span class="token punctuation">,</span>    <span class="token string">'drawstyle'</span><span class="token punctuation">,</span> <span class="token string">'markersize'</span><span class="token punctuation">,</span> <span class="token string">'linewidth'</span><span class="token punctuation">,</span> <span class="token string">'figure'</span><span class="token punctuation">,</span> <span class="token string">'markerfacecolor'</span><span class="token punctuation">,</span>    <span class="token string">'pickradius'</span><span class="token punctuation">,</span> <span class="token string">'agg_filter'</span><span class="token punctuation">,</span> <span class="token string">'dash_joinstyle'</span><span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token string">'solid_joinstyle'</span><span class="token punctuation">,</span>    <span class="token string">'picker'</span><span class="token punctuation">,</span> <span class="token string">'markevery'</span><span class="token punctuation">,</span> <span class="token string">'axes'</span><span class="token punctuation">,</span> <span class="token string">'children'</span><span class="token punctuation">,</span> <span class="token string">'gid'</span><span class="token punctuation">,</span> <span class="token string">'zorder'</span><span class="token punctuation">,</span> <span class="token string">'visible'</span><span class="token punctuation">,</span>    <span class="token string">'markerfacecoloralt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>we can obtain it by using the following command:</p><pre class=" language-python"><code class="language-python">ax<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>il<span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><pre><code>{&#39;agg_filter&#39;: None, &#39;alpha&#39;: None, &#39;animated&#39;: False, &#39;antialiased&#39;: True, &#39;children&#39;: [], &#39;clip_box&#39;: TransformedBbox(Bbox([[0.0, 0.0], [1.0, 1.0]]), CompositeGenericTransform(CompositeGenericTransform(BboxTransformTo(Bbox([[0.0, 0.0], [1.0, 1.0]])), Affine2D(array([[ 1.,  0.,  0.],        [ 0.,  1.,  0.],        [ 0.,  0.,  1.]]))), BboxTransformTo(TransformedBbox(Bbox([[0.125, 0.125], [0.9, 0.88]]), BboxTransformTo(TransformedBbox(Bbox([[0.0, 0.0], [6.0, 4.0]]), Affine2D(array([[ 72.,   0.,   0.],        [  0.,  72.,   0.],        [  0.,   0.,   1.]])))))))), &#39;clip_on&#39;: True, &#39;clip_path&#39;: None, &#39;color&#39;: &#39;#1f77b4&#39;, &#39;contains&#39;: None, &#39;dash_capstyle&#39;: &#39;butt&#39;, &#39;dash_joinstyle&#39;: &#39;round&#39;, &#39;data&#39;: (array([ 0.        ,  0.06346652,  0.12693304,  0.19039955,  0.25386607,          0.31733259,  0.38079911,  0.44426563,  0.50773215,  0.57119866,          0.63466518,  0.6981317 ,  0.76159822,  0.82506474,  0.88853126,          0.95199777,  1.01546429,  1.07893081,  1.14239733,  1.20586385,          1.26933037,  1.33279688,  1.3962634 ,  1.45972992,  1.52319644,          1.58666296,  1.65012947,  1.71359599,  1.77706251,  1.84052903,          1.90399555,  1.96746207,  2.03092858,  2.0943951 ,  2.15786162,          2.22132814,  2.28479466,  2.34826118,  2.41172769,  2.47519421,          2.53866073,  2.60212725,  2.66559377,  2.72906028,  2.7925268 ,          2.85599332,  2.91945984,  2.98292636,  3.04639288,  3.10985939,          3.17332591,  3.23679243,  3.30025895,  3.36372547,  3.42719199,          3.4906585 ,  3.55412502,  3.61759154,  3.68105806,  3.74452458,          3.8079911 ,  3.87145761,  3.93492413,  3.99839065,  4.06185717,          4.12532369,  4.1887902 ,  4.25225672,  4.31572324,  4.37918976,          4.44265628,  4.5061228 ,  4.56958931,  4.63305583,  4.69652235,          4.75998887,  4.82345539,  4.88692191,  4.95038842,  5.01385494,          5.07732146,  5.14078798,  5.2042545 ,  5.26772102,  5.33118753,          5.39465405,  5.45812057,  5.52158709,  5.58505361,  5.64852012,          5.71198664,  5.77545316,  5.83891968,  5.9023862 ,  5.96585272,          6.02931923,  6.09278575,  6.15625227,  6.21971879,  6.28318531]),  array([  0.00000000e+00,   6.34239197e-02,   1.26592454e-01,           1.89251244e-01,   2.51147987e-01,   3.12033446e-01,           3.71662456e-01,   4.29794912e-01,   4.86196736e-01,           5.40640817e-01,   5.92907929e-01,   6.42787610e-01,           6.90079011e-01,   7.34591709e-01,   7.76146464e-01,           8.14575952e-01,   8.49725430e-01,   8.81453363e-01,           9.09631995e-01,   9.34147860e-01,   9.54902241e-01,           9.71811568e-01,   9.84807753e-01,   9.93838464e-01,           9.98867339e-01,   9.99874128e-01,   9.96854776e-01,           9.89821442e-01,   9.78802446e-01,   9.63842159e-01,           9.45000819e-01,   9.22354294e-01,   8.95993774e-01,           8.66025404e-01,   8.32569855e-01,   7.95761841e-01,           7.55749574e-01,   7.12694171e-01,   6.66769001e-01,           6.18158986e-01,   5.67059864e-01,   5.13677392e-01,           4.58226522e-01,   4.00930535e-01,   3.42020143e-01,           2.81732557e-01,   2.20310533e-01,   1.58001396e-01,           9.50560433e-02,   3.17279335e-02,  -3.17279335e-02,          -9.50560433e-02,  -1.58001396e-01,  -2.20310533e-01,          -2.81732557e-01,  -3.42020143e-01,  -4.00930535e-01,          -4.58226522e-01,  -5.13677392e-01,  -5.67059864e-01,          -6.18158986e-01,  -6.66769001e-01,  -7.12694171e-01,          -7.55749574e-01,  -7.95761841e-01,  -8.32569855e-01,          -8.66025404e-01,  -8.95993774e-01,  -9.22354294e-01,          -9.45000819e-01,  -9.63842159e-01,  -9.78802446e-01,          -9.89821442e-01,  -9.96854776e-01,  -9.99874128e-01,          -9.98867339e-01,  -9.93838464e-01,  -9.84807753e-01,          -9.71811568e-01,  -9.54902241e-01,  -9.34147860e-01,          -9.09631995e-01,  -8.81453363e-01,  -8.49725430e-01,          -8.14575952e-01,  -7.76146464e-01,  -7.34591709e-01,          -6.90079011e-01,  -6.42787610e-01,  -5.92907929e-01,          -5.40640817e-01,  -4.86196736e-01,  -4.29794912e-01,          -3.71662456e-01,  -3.12033446e-01,  -2.51147987e-01,          -1.89251244e-01,  -1.26592454e-01,  -6.34239197e-02,          -2.44929360e-16])), &#39;drawstyle&#39;: &#39;default&#39;, &#39;figure&#39;: &lt;matplotlib.figure.Figure at 0x156d6177a90&gt;, &#39;fillstyle&#39;: &#39;full&#39;, &#39;gid&#39;: None, &#39;label&#39;: &#39;sin&#39;, &#39;linestyle&#39;: &#39;-&#39;, &#39;linewidth&#39;: 1.5, &#39;marker&#39;: &#39;None&#39;, &#39;markeredgecolor&#39;: &#39;#1f77b4&#39;, &#39;markeredgewidth&#39;: 1.0, &#39;markerfacecolor&#39;: &#39;#1f77b4&#39;, &#39;markerfacecoloralt&#39;: &#39;none&#39;, &#39;markersize&#39;: 6.0, &#39;markevery&#39;: None, &#39;path&#39;: Path(array([[  0.00000000e+00,   0.00000000e+00],        [  6.34665183e-02,   6.34239197e-02],        [  1.26933037e-01,   1.26592454e-01],        [  1.90399555e-01,   1.89251244e-01],        [  2.53866073e-01,   2.51147987e-01],        [  3.17332591e-01,   3.12033446e-01],        [  3.80799110e-01,   3.71662456e-01],        [  4.44265628e-01,   4.29794912e-01],        [  5.07732146e-01,   4.86196736e-01],        [  5.71198664e-01,   5.40640817e-01],        [  6.34665183e-01,   5.92907929e-01],        [  6.98131701e-01,   6.42787610e-01],        [  7.61598219e-01,   6.90079011e-01],        [  8.25064737e-01,   7.34591709e-01],        [  8.88531256e-01,   7.76146464e-01],        [  9.51997774e-01,   8.14575952e-01],        [  1.01546429e+00,   8.49725430e-01],        [  1.07893081e+00,   8.81453363e-01],        [  1.14239733e+00,   9.09631995e-01],        [  1.20586385e+00,   9.34147860e-01],        [  1.26933037e+00,   9.54902241e-01],        [  1.33279688e+00,   9.71811568e-01],        [  1.39626340e+00,   9.84807753e-01],        [  1.45972992e+00,   9.93838464e-01],        [  1.52319644e+00,   9.98867339e-01],        [  1.58666296e+00,   9.99874128e-01],        [  1.65012947e+00,   9.96854776e-01],        [  1.71359599e+00,   9.89821442e-01],        [  1.77706251e+00,   9.78802446e-01],        [  1.84052903e+00,   9.63842159e-01],        [  1.90399555e+00,   9.45000819e-01],        [  1.96746207e+00,   9.22354294e-01],        [  2.03092858e+00,   8.95993774e-01],        [  2.09439510e+00,   8.66025404e-01],        [  2.15786162e+00,   8.32569855e-01],        [  2.22132814e+00,   7.95761841e-01],        [  2.28479466e+00,   7.55749574e-01],        [  2.34826118e+00,   7.12694171e-01],        [  2.41172769e+00,   6.66769001e-01],        [  2.47519421e+00,   6.18158986e-01],        [  2.53866073e+00,   5.67059864e-01],        [  2.60212725e+00,   5.13677392e-01],        [  2.66559377e+00,   4.58226522e-01],        [  2.72906028e+00,   4.00930535e-01],        [  2.79252680e+00,   3.42020143e-01],        [  2.85599332e+00,   2.81732557e-01],        [  2.91945984e+00,   2.20310533e-01],        [  2.98292636e+00,   1.58001396e-01],        [  3.04639288e+00,   9.50560433e-02],        [  3.10985939e+00,   3.17279335e-02],        [  3.17332591e+00,  -3.17279335e-02],        [  3.23679243e+00,  -9.50560433e-02],        [  3.30025895e+00,  -1.58001396e-01],        [  3.36372547e+00,  -2.20310533e-01],        [  3.42719199e+00,  -2.81732557e-01],        [  3.49065850e+00,  -3.42020143e-01],        [  3.55412502e+00,  -4.00930535e-01],        [  3.61759154e+00,  -4.58226522e-01],        [  3.68105806e+00,  -5.13677392e-01],        [  3.74452458e+00,  -5.67059864e-01],        [  3.80799110e+00,  -6.18158986e-01],        [  3.87145761e+00,  -6.66769001e-01],        [  3.93492413e+00,  -7.12694171e-01],        [  3.99839065e+00,  -7.55749574e-01],        [  4.06185717e+00,  -7.95761841e-01],        [  4.12532369e+00,  -8.32569855e-01],        [  4.18879020e+00,  -8.66025404e-01],        [  4.25225672e+00,  -8.95993774e-01],        [  4.31572324e+00,  -9.22354294e-01],        [  4.37918976e+00,  -9.45000819e-01],        [  4.44265628e+00,  -9.63842159e-01],        [  4.50612280e+00,  -9.78802446e-01],        [  4.56958931e+00,  -9.89821442e-01],        [  4.63305583e+00,  -9.96854776e-01],        [  4.69652235e+00,  -9.99874128e-01],        [  4.75998887e+00,  -9.98867339e-01],        [  4.82345539e+00,  -9.93838464e-01],        [  4.88692191e+00,  -9.84807753e-01],        [  4.95038842e+00,  -9.71811568e-01],        [  5.01385494e+00,  -9.54902241e-01],        [  5.07732146e+00,  -9.34147860e-01],        [  5.14078798e+00,  -9.09631995e-01],        [  5.20425450e+00,  -8.81453363e-01],        [  5.26772102e+00,  -8.49725430e-01],        [  5.33118753e+00,  -8.14575952e-01],        [  5.39465405e+00,  -7.76146464e-01],        [  5.45812057e+00,  -7.34591709e-01],        [  5.52158709e+00,  -6.90079011e-01],        [  5.58505361e+00,  -6.42787610e-01],        [  5.64852012e+00,  -5.92907929e-01],        [  5.71198664e+00,  -5.40640817e-01],        [  5.77545316e+00,  -4.86196736e-01],        [  5.83891968e+00,  -4.29794912e-01],        [  5.90238620e+00,  -3.71662456e-01],        [  5.96585272e+00,  -3.12033446e-01],        [  6.02931923e+00,  -2.51147987e-01],        [  6.09278575e+00,  -1.89251244e-01],        [  6.15625227e+00,  -1.26592454e-01],        [  6.21971879e+00,  -6.34239197e-02],        [  6.28318531e+00,  -2.44929360e-16]]), None), &#39;path_effects&#39;: [], &#39;picker&#39;: None, &#39;pickradius&#39;: 5, &#39;rasterized&#39;: None, &#39;sketch_params&#39;: None, &#39;snap&#39;: None, &#39;solid_capstyle&#39;: &#39;projecting&#39;, &#39;solid_joinstyle&#39;: &#39;round&#39;, &#39;transform&#39;: CompositeGenericTransform(TransformWrapper(BlendedAffine2D(IdentityTransform(),IdentityTransform())), CompositeGenericTransform(BboxTransformFrom(TransformedBbox(Bbox([[-0.3141592653589793, -1.201036728154288], [6.5973445725385655, 1.1956164529218232]]), TransformWrapper(BlendedAffine2D(IdentityTransform(),IdentityTransform())))), BboxTransformTo(TransformedBbox(Bbox([[0.125, 0.125], [0.9, 0.88]]), BboxTransformTo(TransformedBbox(Bbox([[0.0, 0.0], [6.0, 4.0]]), Affine2D(array([[ 72.,   0.,   0.],        [  0.,  72.,   0.],        [  0.,   0.,   1.]])))))))), &#39;transformed_clip_path_and_affine&#39;: (None, None), &#39;url&#39;: None, &#39;visible&#39;: True, &#39;xdata&#39;: array([ 0.        ,  0.06346652,  0.12693304,  0.19039955,  0.25386607,         0.31733259,  0.38079911,  0.44426563,  0.50773215,  0.57119866,         0.63466518,  0.6981317 ,  0.76159822,  0.82506474,  0.88853126,         0.95199777,  1.01546429,  1.07893081,  1.14239733,  1.20586385,         1.26933037,  1.33279688,  1.3962634 ,  1.45972992,  1.52319644,         1.58666296,  1.65012947,  1.71359599,  1.77706251,  1.84052903,         1.90399555,  1.96746207,  2.03092858,  2.0943951 ,  2.15786162,         2.22132814,  2.28479466,  2.34826118,  2.41172769,  2.47519421,         2.53866073,  2.60212725,  2.66559377,  2.72906028,  2.7925268 ,         2.85599332,  2.91945984,  2.98292636,  3.04639288,  3.10985939,         3.17332591,  3.23679243,  3.30025895,  3.36372547,  3.42719199,         3.4906585 ,  3.55412502,  3.61759154,  3.68105806,  3.74452458,         3.8079911 ,  3.87145761,  3.93492413,  3.99839065,  4.06185717,         4.12532369,  4.1887902 ,  4.25225672,  4.31572324,  4.37918976,         4.44265628,  4.5061228 ,  4.56958931,  4.63305583,  4.69652235,         4.75998887,  4.82345539,  4.88692191,  4.95038842,  5.01385494,         5.07732146,  5.14078798,  5.2042545 ,  5.26772102,  5.33118753,         5.39465405,  5.45812057,  5.52158709,  5.58505361,  5.64852012,         5.71198664,  5.77545316,  5.83891968,  5.9023862 ,  5.96585272,         6.02931923,  6.09278575,  6.15625227,  6.21971879,  6.28318531]), &#39;xydata&#39;: array([[  0.00000000e+00,   0.00000000e+00],        [  6.34665183e-02,   6.34239197e-02],        [  1.26933037e-01,   1.26592454e-01],        [  1.90399555e-01,   1.89251244e-01],        [  2.53866073e-01,   2.51147987e-01],        [  3.17332591e-01,   3.12033446e-01],        [  3.80799110e-01,   3.71662456e-01],        [  4.44265628e-01,   4.29794912e-01],        [  5.07732146e-01,   4.86196736e-01],        [  5.71198664e-01,   5.40640817e-01],        [  6.34665183e-01,   5.92907929e-01],        [  6.98131701e-01,   6.42787610e-01],        [  7.61598219e-01,   6.90079011e-01],        [  8.25064737e-01,   7.34591709e-01],        [  8.88531256e-01,   7.76146464e-01],        [  9.51997774e-01,   8.14575952e-01],        [  1.01546429e+00,   8.49725430e-01],        [  1.07893081e+00,   8.81453363e-01],        [  1.14239733e+00,   9.09631995e-01],        [  1.20586385e+00,   9.34147860e-01],        [  1.26933037e+00,   9.54902241e-01],        [  1.33279688e+00,   9.71811568e-01],        [  1.39626340e+00,   9.84807753e-01],        [  1.45972992e+00,   9.93838464e-01],        [  1.52319644e+00,   9.98867339e-01],        [  1.58666296e+00,   9.99874128e-01],        [  1.65012947e+00,   9.96854776e-01],        [  1.71359599e+00,   9.89821442e-01],        [  1.77706251e+00,   9.78802446e-01],        [  1.84052903e+00,   9.63842159e-01],        [  1.90399555e+00,   9.45000819e-01],        [  1.96746207e+00,   9.22354294e-01],        [  2.03092858e+00,   8.95993774e-01],        [  2.09439510e+00,   8.66025404e-01],        [  2.15786162e+00,   8.32569855e-01],        [  2.22132814e+00,   7.95761841e-01],        [  2.28479466e+00,   7.55749574e-01],        [  2.34826118e+00,   7.12694171e-01],        [  2.41172769e+00,   6.66769001e-01],        [  2.47519421e+00,   6.18158986e-01],        [  2.53866073e+00,   5.67059864e-01],        [  2.60212725e+00,   5.13677392e-01],        [  2.66559377e+00,   4.58226522e-01],        [  2.72906028e+00,   4.00930535e-01],        [  2.79252680e+00,   3.42020143e-01],        [  2.85599332e+00,   2.81732557e-01],        [  2.91945984e+00,   2.20310533e-01],        [  2.98292636e+00,   1.58001396e-01],        [  3.04639288e+00,   9.50560433e-02],        [  3.10985939e+00,   3.17279335e-02],        [  3.17332591e+00,  -3.17279335e-02],        [  3.23679243e+00,  -9.50560433e-02],        [  3.30025895e+00,  -1.58001396e-01],        [  3.36372547e+00,  -2.20310533e-01],        [  3.42719199e+00,  -2.81732557e-01],        [  3.49065850e+00,  -3.42020143e-01],        [  3.55412502e+00,  -4.00930535e-01],        [  3.61759154e+00,  -4.58226522e-01],        [  3.68105806e+00,  -5.13677392e-01],        [  3.74452458e+00,  -5.67059864e-01],        [  3.80799110e+00,  -6.18158986e-01],        [  3.87145761e+00,  -6.66769001e-01],        [  3.93492413e+00,  -7.12694171e-01],        [  3.99839065e+00,  -7.55749574e-01],        [  4.06185717e+00,  -7.95761841e-01],        [  4.12532369e+00,  -8.32569855e-01],        [  4.18879020e+00,  -8.66025404e-01],        [  4.25225672e+00,  -8.95993774e-01],        [  4.31572324e+00,  -9.22354294e-01],        [  4.37918976e+00,  -9.45000819e-01],        [  4.44265628e+00,  -9.63842159e-01],        [  4.50612280e+00,  -9.78802446e-01],        [  4.56958931e+00,  -9.89821442e-01],        [  4.63305583e+00,  -9.96854776e-01],        [  4.69652235e+00,  -9.99874128e-01],        [  4.75998887e+00,  -9.98867339e-01],        [  4.82345539e+00,  -9.93838464e-01],        [  4.88692191e+00,  -9.84807753e-01],        [  4.95038842e+00,  -9.71811568e-01],        [  5.01385494e+00,  -9.54902241e-01],        [  5.07732146e+00,  -9.34147860e-01],        [  5.14078798e+00,  -9.09631995e-01],        [  5.20425450e+00,  -8.81453363e-01],        [  5.26772102e+00,  -8.49725430e-01],        [  5.33118753e+00,  -8.14575952e-01],        [  5.39465405e+00,  -7.76146464e-01],        [  5.45812057e+00,  -7.34591709e-01],        [  5.52158709e+00,  -6.90079011e-01],        [  5.58505361e+00,  -6.42787610e-01],        [  5.64852012e+00,  -5.92907929e-01],        [  5.71198664e+00,  -5.40640817e-01],        [  5.77545316e+00,  -4.86196736e-01],        [  5.83891968e+00,  -4.29794912e-01],        [  5.90238620e+00,  -3.71662456e-01],        [  5.96585272e+00,  -3.12033446e-01],        [  6.02931923e+00,  -2.51147987e-01],        [  6.09278575e+00,  -1.89251244e-01],        [  6.15625227e+00,  -1.26592454e-01],        [  6.21971879e+00,  -6.34239197e-02],        [  6.28318531e+00,  -2.44929360e-16]]), &#39;ydata&#39;: array([  0.00000000e+00,   6.34239197e-02,   1.26592454e-01,          1.89251244e-01,   2.51147987e-01,   3.12033446e-01,          3.71662456e-01,   4.29794912e-01,   4.86196736e-01,          5.40640817e-01,   5.92907929e-01,   6.42787610e-01,          6.90079011e-01,   7.34591709e-01,   7.76146464e-01,          8.14575952e-01,   8.49725430e-01,   8.81453363e-01,          9.09631995e-01,   9.34147860e-01,   9.54902241e-01,          9.71811568e-01,   9.84807753e-01,   9.93838464e-01,          9.98867339e-01,   9.99874128e-01,   9.96854776e-01,          9.89821442e-01,   9.78802446e-01,   9.63842159e-01,          9.45000819e-01,   9.22354294e-01,   8.95993774e-01,          8.66025404e-01,   8.32569855e-01,   7.95761841e-01,          7.55749574e-01,   7.12694171e-01,   6.66769001e-01,          6.18158986e-01,   5.67059864e-01,   5.13677392e-01,          4.58226522e-01,   4.00930535e-01,   3.42020143e-01,          2.81732557e-01,   2.20310533e-01,   1.58001396e-01,          9.50560433e-02,   3.17279335e-02,  -3.17279335e-02,         -9.50560433e-02,  -1.58001396e-01,  -2.20310533e-01,         -2.81732557e-01,  -3.42020143e-01,  -4.00930535e-01,         -4.58226522e-01,  -5.13677392e-01,  -5.67059864e-01,         -6.18158986e-01,  -6.66769001e-01,  -7.12694171e-01,         -7.55749574e-01,  -7.95761841e-01,  -8.32569855e-01,         -8.66025404e-01,  -8.95993774e-01,  -9.22354294e-01,         -9.45000819e-01,  -9.63842159e-01,  -9.78802446e-01,         -9.89821442e-01,  -9.96854776e-01,  -9.99874128e-01,         -9.98867339e-01,  -9.93838464e-01,  -9.84807753e-01,         -9.71811568e-01,  -9.54902241e-01,  -9.34147860e-01,         -9.09631995e-01,  -8.81453363e-01,  -8.49725430e-01,         -8.14575952e-01,  -7.76146464e-01,  -7.34591709e-01,         -6.90079011e-01,  -6.42787610e-01,  -5.92907929e-01,         -5.40640817e-01,  -4.86196736e-01,  -4.29794912e-01,         -3.71662456e-01,  -3.12033446e-01,  -2.51147987e-01,         -1.89251244e-01,  -1.26592454e-01,  -6.34239197e-02,         -2.44929360e-16]), &#39;zorder&#39;: 2}</code></pre><p>We can modify such properties.</p><p>For example we can change the linestyle of the sin-curve:</p><p>(As you can see now, the linestyle and the linewidth now is ‘-‘ and 1.5)</p><pre class=" language-python"><code class="language-python">ax<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>il<span class="token punctuation">]</span><span class="token punctuation">.</span>set_linestyle<span class="token punctuation">(</span><span class="token string">'-.'</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>il<span class="token punctuation">]</span><span class="token punctuation">.</span>set_linewidth<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre><p>We can even modify the data, as shown:</p><pre class=" language-python"><code class="language-python">ydata<span class="token operator">=</span>ax<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>il<span class="token punctuation">]</span><span class="token punctuation">.</span>get_ydata<span class="token punctuation">(</span><span class="token punctuation">)</span>ydata<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">0.5</span>ax<span class="token punctuation">.</span>lines<span class="token punctuation">[</span>il<span class="token punctuation">]</span><span class="token punctuation">.</span>set_ydata<span class="token punctuation">(</span>ydata<span class="token punctuation">)</span></code></pre><p>Now we plot the curves again.</p><p>(simply showing the same figure is enough)</p><p>As you can see in the following figure, the linestyle of the sin-curve has changed and its last data point is now corrupted.</p><pre class=" language-python"><code class="language-python">fig</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pz7auR.png" alt="output_15_0.png-13.7kB"></p><h2 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h2><p>we can use the <code>annotate</code> method to make annotations.</p><p>Its properties can be given in a dictionary:</p><pre class=" language-python"><code class="language-python">annot1<span class="token operator">=</span>ax<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span><span class="token string">'amplitude modulated\n curve'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2.1</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3.2</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arrowprops<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'width'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'color'</span><span class="token punctuation">:</span><span class="token string">'k'</span><span class="token punctuation">,</span><span class="token string">'connectionstyle'</span><span class="token punctuation">:</span><span class="token string">'arc3,rad=+0.5'</span><span class="token punctuation">,</span> <span class="token string">'shrink'</span><span class="token punctuation">:</span><span class="token number">0.05</span><span class="token punctuation">}</span><span class="token punctuation">,</span> verticalalignment<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">,</span> horizontalalignment<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> bbox<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'facecolor'</span><span class="token punctuation">:</span><span class="token string">'gray'</span><span class="token punctuation">,</span> <span class="token string">'alpha'</span><span class="token punctuation">:</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token string">'pad'</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span>annot2<span class="token operator">=</span>ax<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span><span class="token string">'corrupted data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">6.3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6.1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arrowprops<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'width'</span><span class="token punctuation">:</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token string">'color'</span><span class="token punctuation">:</span><span class="token string">'k'</span><span class="token punctuation">,</span><span class="token string">'shrink'</span><span class="token punctuation">:</span><span class="token number">0.1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> horizontalalignment<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span></code></pre><p>In this example, the arrow points to the point (2.1,1.0), and the left bottom of the text is (3.2,0.5).</p><pre class=" language-python"><code class="language-python">fig</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pz7dD1.png" alt="output_19_0.png-20kB"></p><p>Sometimes you need to remove such annotations, so you will need to do this:</p><pre class=" language-python"><code class="language-python">annot1<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">)</span>fig</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pz7BE6.png" alt="output_21_0.png-15.6kB"></p><h2 id="filling-areas-between-curves"><a href="#filling-areas-between-curves" class="headerlink" title="filling areas between curves"></a>filling areas between curves</h2><p>Filling is done by the axis method:</p><pre class=" language-python"><code class="language-python">ax<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span></code></pre><p>As for our example, we use:</p><pre class=" language-python"><code class="language-python">axf <span class="token operator">=</span> ax<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>x<span class="token punctuation">,</span> sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> amod_sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>fig</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pz7cgH.png" alt="output_23_0.png-16kB"></p><pre class=" language-python"><code class="language-python">axf<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># if you wanna try partial filling, do not forget to remove the complete filling first</span>fig</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pz7RKA.png" alt="output_24_0.png-15.6kB"></p><p>Use <code>where</code> to add addtional conditions.</p><pre class=" language-python"><code class="language-python">axf <span class="token operator">=</span> ax<span class="token punctuation">.</span>fill_between<span class="token punctuation">(</span>x<span class="token punctuation">,</span> sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> amod_sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> where <span class="token operator">=</span> sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> amod_sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> facecolor <span class="token operator">=</span> <span class="token string">'gray'</span><span class="token punctuation">)</span>fig</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pz7fbt.png" alt="output_26_0.png-15.8kB"></p><p>Only the lower part is filled here.</p><h2 id="ticks-and-ticklabels"><a href="#ticks-and-ticklabels" class="headerlink" title="ticks and ticklabels"></a>ticks and ticklabels</h2><p>here since it is a sin-curve, we need not labels from 0-7, what we need is something about $\pi$.</p><p>Thus we need to remove labels from the x-axis and y-axis and introducing problem relating tick labels.</p><pre class=" language-python"><code class="language-python">ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> pi<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span>pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'$0$'</span><span class="token punctuation">,</span> <span class="token string">'$\pi/2$'</span><span class="token punctuation">,</span><span class="token string">'$\pi$'</span><span class="token punctuation">,</span> <span class="token string">'$3\pi/2$'</span><span class="token punctuation">,</span> <span class="token string">'$2\pi$'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fontsize <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'$-1$'</span><span class="token punctuation">,</span><span class="token string">'$0$'</span><span class="token punctuation">,</span><span class="token string">'$1$'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>fig</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pz7H2Q.png" alt="output_28_0.png-15.8kB"></p><h2 id="making-3D-plots"><a href="#making-3D-plots" class="headerlink" title="making 3D plots"></a>making 3D plots</h2><p>There are some useful <code>matplotlib</code> tool kits and modules that can be used for a variety of</p><p>special purposes. Here we introduce the <code>mplot3d</code> toolkit to produce 3D-plots.</p><p>Adding the keyword <code>projection=&#39;3d&#39;</code> to the axes object as shown in the following example:</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> axes3dfig <span class="token operator">=</span> figure<span class="token punctuation">(</span><span class="token punctuation">)</span>ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection <span class="token operator">=</span> <span class="token string">'3d'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># plot points in 3D</span>class1 <span class="token operator">=</span> <span class="token number">0.6</span> <span class="token operator">*</span> random<span class="token punctuation">.</span>standard_normal<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>class1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> class1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>class1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">)</span>class2 <span class="token operator">=</span> <span class="token number">1.2</span> <span class="token operator">*</span> random<span class="token punctuation">.</span>standard_normal<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>class2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>class2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>class2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">)</span>class3 <span class="token operator">=</span> <span class="token number">0.3</span> <span class="token operator">*</span> random<span class="token punctuation">.</span>standard_normal<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>class3<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>class3<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>class3<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">)</span></code></pre><pre><code>[&lt;mpl_toolkits.mplot3d.art3d.Line3D at 0x156d83a7ef0&gt;]</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzHC24.png" alt="output_30_1.png-26.9kB"></p><p>plotting <strong>surface</strong>: (alpha is the parameter to set the transparency)</p><pre class=" language-python"><code class="language-python">X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z <span class="token operator">=</span> axes3d<span class="token punctuation">.</span>get_test_data<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>fig <span class="token operator">=</span> figure<span class="token punctuation">(</span><span class="token punctuation">)</span>ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># surface plot with transparency 0.5</span>ax<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span></code></pre><pre><code>&lt;mpl_toolkits.mplot3d.art3d.Poly3DCollection at 0x156d83b4898&gt;</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzHZa6.png" alt="output_32_1.png-50.5kB"></p><pre class=" language-python"><code class="language-python">help<span class="token punctuation">(</span>axes3d<span class="token punctuation">.</span>get_test_data<span class="token punctuation">)</span></code></pre><pre><code>Help on function get_test_data in module mpl_toolkits.mplot3d.axes3d:get_test_data(delta=0.05)    Return a tuple X, Y, Z with a test data set.</code></pre><p>​    </p><p>You can also plot contours in any of the coordinate projections as in the next example.</p><pre class=" language-python"><code class="language-python">fig <span class="token operator">=</span> figure<span class="token punctuation">(</span><span class="token punctuation">)</span>ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>gca<span class="token punctuation">(</span>projection <span class="token operator">=</span> <span class="token string">'3d'</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>plot_wireframe<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>rstride <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>cstride <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># plot contour projection on each axis plane</span>ax<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">,</span> zdir<span class="token operator">=</span><span class="token string">'z'</span><span class="token punctuation">,</span>offset <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">,</span> zdir<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">,</span>offset <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">,</span> zdir<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span>offset <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># set axis limits</span>ax<span class="token punctuation">.</span>set_xlim3d<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>set_ylim3d<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>set_zlim3d<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># set labels</span>ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'X axis'</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Y axis'</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'Z axis'</span><span class="token punctuation">)</span></code></pre><pre><code>Text(0.5,0,&#39;Z axis&#39;)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzHGZt.png" alt="output_35_1.png-64.4kB"></p><p>since we use <strong>Jupyter notebook</strong>‘s magic command to show figures inline, we cannot rotate and do any other adjustment here. </p><p>You can go to the <code>mplot3d</code> documentation website for more information.</p><h2 id="making-movies-from-plots"><a href="#making-movies-from-plots" class="headerlink" title="making movies from plots"></a>making movies from plots</h2><p>use the <code>visvis</code> module to save your evolving data as a movie.</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Install a pip package in the current Jupyter kernel</span><span class="token keyword">import</span> sys!<span class="token punctuation">{</span>sys<span class="token punctuation">.</span>executable<span class="token punctuation">}</span> <span class="token operator">-</span>m pip install visvis</code></pre><pre><code>Collecting visvis  Using cached visvis-1.10.0.tar.gzRequirement already satisfied: numpy in c:\users\huang\pycharmprojects\review_python\venv\lib\site-packages (from visvis)Collecting pyOpenGl (from visvis)  Using cached PyOpenGL-3.1.0.tar.gzBuilding wheels for collected packages: visvis, pyOpenGl  Running setup.py bdist_wheel for visvis: started  Running setup.py bdist_wheel for visvis: finished with status &#39;done&#39;  Stored in directory: C:\Users\huang\AppData\Local\pip\Cache\wheels\de\cc\f6\883f1e175e8da4436208c35194ce35555e76b32e82afef4e5c  Running setup.py bdist_wheel for pyOpenGl: started  Running setup.py bdist_wheel for pyOpenGl: finished with status &#39;done&#39;  Stored in directory: C:\Users\huang\AppData\Local\pip\Cache\wheels\1c\17\50\f69d63e0a8169fb890f5a167817a73391be85d30e86fd29504Successfully built visvis pyOpenGlInstalling collected packages: pyOpenGl, visvisSuccessfully installed pyOpenGl-3.1.0 visvis-1.10.0</code></pre><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> visvis<span class="token punctuation">.</span>vvmovie <span class="token keyword">as</span> vv<span class="token comment" spellcheck="true"># create initial function values</span>x <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">511</span><span class="token punctuation">)</span>X<span class="token punctuation">,</span>Y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>x<span class="token punctuation">,</span>x<span class="token punctuation">)</span>f <span class="token operator">=</span> sqrt<span class="token punctuation">(</span>X<span class="token operator">*</span>X<span class="token operator">+</span>Y<span class="token operator">*</span>Y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">40</span> <span class="token comment" spellcheck="true">#radius 40</span><span class="token comment" spellcheck="true"># evolve and store in a list</span>imlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    imlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">255</span><span class="token punctuation">)</span>    f <span class="token operator">-=</span> <span class="token number">1</span> <span class="token comment" spellcheck="true"># move outwards one pixel</span>vv<span class="token punctuation">.</span>images2swf<span class="token punctuation">.</span>writeSwf<span class="token punctuation">(</span><span class="token string">'circle_evolution.swf'</span><span class="token punctuation">,</span>imlist<span class="token punctuation">)</span></code></pre><p>the pic can also be saved as gif or avi and it can even be shown in the figure window with more packages installed.(e.g. <code>pyOpenGL</code> and <code>PIL</code>, the python imaging library) </p><p>If you want to know more about it, go to the documentation webpage of <code>visvis</code> for more information.</p><p>Another option is to use savefig to create images, one for each frame.</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create initial function values</span>x <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">511</span><span class="token punctuation">)</span>X<span class="token punctuation">,</span>Y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>x<span class="token punctuation">,</span>x<span class="token punctuation">)</span>f <span class="token operator">=</span> sqrt<span class="token punctuation">(</span>X<span class="token operator">*</span>X<span class="token operator">+</span>Y<span class="token operator">*</span>Y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">40</span> <span class="token comment" spellcheck="true">#radius 40</span><span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    imshow<span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">255</span><span class="token punctuation">)</span>    gray<span class="token punctuation">(</span><span class="token punctuation">)</span>    axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>    savefig<span class="token punctuation">(</span><span class="token string">'circle_evolution_{:d}.png'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>iteration<span class="token punctuation">)</span><span class="token punctuation">)</span>    f <span class="token operator">-=</span> <span class="token number">1</span></code></pre><p>You’d better not run the code above unless you want 200 pngs stored in your computer.</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
            <tag> learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python plotting tutorial - 1</title>
      <link href="2018/11/17/python-plotting-1/"/>
      <url>2018/11/17/python-plotting-1/</url>
      
        <content type="html"><![CDATA[<p>Use matplotlib in Python to create wonderful graphs!</p><a id="more"></a><h2 id="Copyright-statement"><a href="#Copyright-statement" class="headerlink" title="Copyright statement"></a>Copyright statement</h2><p>The following is the note I took when I was learning scientific computing with Python.</p><p>The book I use is <strong><em>Scientific computing with Python3</em></strong> published by <strong>Packt</strong> and the contents in this article are mostly from this book.  The copyright belongs to the author.</p><p>I used <strong>Jupyter notebook</strong> to generate this markdown file. </p><h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>Plotting in Python is done in the <code>pyplot</code> part in matplotlib module.<br>Here we import the module in this way:</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span>  matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">import</span> <span class="token operator">*</span></code></pre><p>Since we are using Jupyter notebook, we start with the magic command <strong>“%matplotlib”</strong></p><pre class=" language-python"><code class="language-python"><span class="token operator">%</span>matplotlib inline <span class="token comment" spellcheck="true"># in order to show plot in jupyter notebook</span></code></pre><h2 id="Basic-plotting"><a href="#Basic-plotting" class="headerlink" title="Basic plotting"></a>Basic plotting</h2><p>function: <code>plot</code>.<br><code>plot(x,y)</code>: a plot of y as a function of x (inputs are <strong>arrays/lists</strong> of equal length)</p><p>You can also use <code>plot(y)</code> as it is in fact short for <code>plot(range(len(y)), y)</code></p><h3 id="example-1"><a href="#example-1" class="headerlink" title="example 1"></a>example 1</h3><p>The following is a plot drawing with this function. We plot the function $sin(x)$ for $x \in [-2\pi, 2\pi]$ using 200 sample points and set markers every fourth points.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment" spellcheck="true"># plot sin(x) for some interval</span>x <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># plot markers for every 4th point</span>samples <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>plot<span class="token punctuation">(</span>samples<span class="token punctuation">,</span> sin<span class="token punctuation">(</span>samples<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"r*"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># mark with red star-shape markers"</span>title<span class="token punctuation">(</span><span class="token string">"Function $sin(x)$ with some points marked"</span><span class="token punctuation">)</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzHXSe.png" alt="output_3_0.png-18.7kB"></p><p>To call a new clean window of plot, use function <code>figure()</code>.  To switch from figures, using numbers, for example, <code>figure(2)</code>. Without a number, python will create a new window.</p><h3 id="example-2"><a href="#example-2" class="headerlink" title="example 2"></a>example 2</h3><p>To add lebels, we use the function <code>legend</code>.<br>example:</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ---polyfit example---</span>x <span class="token operator">=</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>p2 <span class="token operator">=</span> polyfit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>p4 <span class="token operator">=</span> polyfit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># plot the polynomials and points</span>xx <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>plot<span class="token punctuation">(</span>xx<span class="token punctuation">,</span> polyval<span class="token punctuation">(</span>p2<span class="token punctuation">,</span> xx<span class="token punctuation">)</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'fitting polynomials of degree 2'</span><span class="token punctuation">)</span>plot<span class="token punctuation">(</span>xx<span class="token punctuation">,</span> polyval<span class="token punctuation">(</span>p4<span class="token punctuation">,</span> xx<span class="token punctuation">)</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'fitting polynomials of degree 4'</span><span class="token punctuation">)</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># set the axis and legend</span>axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>legend<span class="token punctuation">(</span>loc <span class="token operator">=</span> <span class="token string">'upper left'</span><span class="token punctuation">,</span> fontsize <span class="token operator">=</span> <span class="token string">'small'</span><span class="token punctuation">)</span></code></pre><pre><code>&lt;matplotlib.legend.Legend at 0x19d0f9a75c0&gt;</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzHxOA.png" alt="output_5_1.png-15.7kB"></p><h3 id="example-3"><a href="#example-3" class="headerlink" title="example 3"></a>example 3</h3><p>do scatter plots and logarithmic plots:</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create random 2D points</span><span class="token keyword">import</span> numpyx1 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> numpy<span class="token punctuation">.</span> random<span class="token punctuation">.</span>standard_normal<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x2 <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token operator">*</span> numpy<span class="token punctuation">.</span>random<span class="token punctuation">.</span>standard_normal<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>plot<span class="token punctuation">(</span>x1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>plot<span class="token punctuation">(</span>x2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'r*'</span><span class="token punctuation">)</span>title<span class="token punctuation">(</span><span class="token string">'2D scatter plot'</span><span class="token punctuation">)</span></code></pre><pre><code>Text(0.5,1,&#39;2D scatter plot&#39;)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzbElQ.png" alt="output_7_1.png-10.2kB"></p><p>the logarithmic plot using <code>loglog</code>:</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># log both x and y axis</span>x <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>loglog<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span>x<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'quadratic polynomial'</span><span class="token punctuation">,</span> linestyle <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">,</span> linewidth <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>loglog<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">*</span>x<span class="token operator">**</span><span class="token number">4</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'4th degree polynomial'</span><span class="token punctuation">,</span> linestyle <span class="token operator">=</span> <span class="token string">'-.'</span><span class="token punctuation">,</span> linewidth <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>loglog<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">*</span>exp<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'exponential function'</span><span class="token punctuation">,</span> linewidth <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>title<span class="token punctuation">(</span><span class="token string">'Logarithmic plots'</span><span class="token punctuation">)</span>legend<span class="token punctuation">(</span>loc <span class="token operator">=</span> <span class="token string">'best'</span><span class="token punctuation">)</span></code></pre><pre><code>&lt;matplotlib.legend.Legend at 0x19d0fb20e80&gt;</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzjuJP.png" alt="output_9_1.png-18.4kB"></p><h2 id="Formatting"><a href="#Formatting" class="headerlink" title="Formatting"></a>Formatting</h2><p>The appearance of figures and plots can be styled and customized to look how you want them to look.<br>Some important variables are </p><ol><li><code>linewidth</code>, which controls the <strong>thickness</strong> of plot lines; </li><li><code>xlabel, ylabel</code>, which set the axis labels;</li><li><code>color</code> for plot colors;</li><li><code>transparent</code> for transparency. </li></ol><p>The following is an example with more keywords:</p><pre class=" language-python"><code class="language-python">k <span class="token operator">=</span> <span class="token number">0.2</span>x <span class="token operator">=</span> <span class="token punctuation">[</span>sin<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>n<span class="token operator">*</span>k<span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">]</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'dashed'</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span>markerfacecolor<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span></code></pre><pre><code>[&lt;matplotlib.lines.Line2D at 0x19d0fc342b0&gt;]</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzjVZd.png" alt="output_11_1.png-15.2kB"></p><p>You can use <code>plot(...,&#39;ro-&#39;)</code>, or the more explicit syntax  <code>plot(..., marker=&#39;o&#39;, color=&#39;r&#39;, linestyle=&#39;-&#39;)</code>.</p><h3 id="hist-function"><a href="#hist-function" class="headerlink" title="hist function"></a>hist function</h3><p>To get histgram instead of normal plot, use the function <code>hist</code>.<br>example:</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># random vector with normal distribution</span>sigma<span class="token punctuation">,</span> mu <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span>x <span class="token operator">=</span> sigma <span class="token operator">*</span> numpy<span class="token punctuation">.</span>random<span class="token punctuation">.</span>standard_normal<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">+</span> muhist<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> normed <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>z <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>plot<span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>pi<span class="token operator">*</span>sigma<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>exp<span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span>z<span class="token operator">-</span>mu<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>sigma<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># title with LaTeX formatting</span>title<span class="token punctuation">(</span><span class="token string">'Histogram with $\mu$ = {}, $\sigma$ = {}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>mu<span class="token punctuation">,</span>sigma<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><pre><code>Text(0.5,1,&#39;Histogram with $\\mu$ = 10, $\\sigma$ = 2&#39;)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzjKRf.png" alt="output_13_1.png-13.6kB"></p><ul><li>sometimes the string formatting will interfere with our LaTeX bracket. When this happens, we use double brackets in LaTeX, for example use <code>x_1</code> instead of <code>x_{1}</code>.</li><li>the text sometimes will also overlap with the escaping sequences. For example <code>\tau</code> will be interpreted as <code>\t</code>. In this case we should use <strong>raw string</strong> such as  <code>r&#39;\tau&#39;</code></li></ul><h3 id="subplot-function"><a href="#subplot-function" class="headerlink" title="subplot function"></a>subplot function</h3><p>To show several plot in the same window:<br><code>subplot(v, h, c)</code></p><p><strong>v</strong>: the number of vertical plots.</p><p><strong>h</strong>: the number of horizontal plots.</p><p><strong>c</strong>: the index indicating which position to plot in (counted row-wise)</p><p>use <code>subplot_adjust</code> to add extra space to adjust the distance between different subplots.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">avg</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token triple-quoted-string string">""" simple running average """</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>roll<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> x <span class="token operator">+</span> roll<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token comment" spellcheck="true"># sine function with noise</span>x <span class="token operator">=</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>pi<span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>y <span class="token operator">=</span> sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.4</span><span class="token operator">*</span>rand<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># make successive subplots</span><span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> iteration <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'{:d} average{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>iteration<span class="token punctuation">,</span> <span class="token string">'s'</span> <span class="token keyword">if</span> iteration <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    legend<span class="token punctuation">(</span>loc <span class="token operator">=</span> <span class="token string">'lower left'</span><span class="token punctuation">,</span> frameon <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>    y <span class="token operator">=</span> avg<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#apply running average</span>subplots_adjust<span class="token punctuation">(</span>hspace <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">)</span></code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzjMz8.png" alt="output_16_0.png-23.2kB"></p><h3 id="savefig-function"><a href="#savefig-function" class="headerlink" title="savefig function"></a>savefig function</h3><p>To save the fig, we use the function <code>savefig</code><br>For example:</p><pre class=" language-python"><code class="language-python">savefig<span class="token punctuation">(</span><span class="token string">'test.pdf'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># save to pdf</span>savefig<span class="token punctuation">(</span><span class="token string">'test.svg'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># save to svg</span>savefig<span class="token punctuation">(</span><span class="token string">'test.pdf'</span><span class="token punctuation">,</span> transparent <span class="token operator">=</span> true<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># make the background transparent</span>savefig<span class="token punctuation">(</span><span class="token string">'test.pdf'</span><span class="token punctuation">,</span> bbox_inches <span class="token operator">=</span> <span class="token string">'tight'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># reduce the surrounding space by setting the bounding box tight</span></code></pre><h2 id="Meshgrid-and-contour"><a href="#Meshgrid-and-contour" class="headerlink" title="Meshgrid and contour"></a>Meshgrid and contour</h2><p>To generate a grid on the rectangle $[a,b] \times [c,d]$, we use the <code>meshgrid</code> command:</p><pre class=" language-python"><code class="language-python">n <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true"># number of discretization points along the x-axis</span>m <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment" spellcheck="true"># number of discretization points along the x-axis</span>X<span class="token punctuation">,</span>Y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> linspace<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>A rectangle discretized by <code>meshgrid</code> can be used to visualize the behavior of an iteration.<br>But first we use it to plot <strong>level curves</strong> of a function. This is done by the command <code>contour</code>.</p><p>We choose Rosenbrock’s <strong>banana function</strong> as an example:<br>$ f(x,y) = (1-x)^2 + 100(y-x^2)^2$</p><pre class=" language-python"><code class="language-python">rosenbrockfunction <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token operator">*</span><span class="token punctuation">(</span>y<span class="token operator">-</span>x<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>X<span class="token punctuation">,</span>Y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Z <span class="token operator">=</span> rosenbrockfunction<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span>contour<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> Z<span class="token punctuation">,</span> logspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> base <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap <span class="token operator">=</span> <span class="token string">'gray'</span><span class="token punctuation">)</span>title<span class="token punctuation">(</span><span class="token string">'Rosenbrock Function: $f(x,y) = (1-x)^2+100(y-x^2)^2$'</span><span class="token punctuation">)</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span></code></pre><pre><code>Text(0,0.5,&#39;y&#39;)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzjYon.png" alt="output_19_1.png-81.1kB"></p><p>the command <code>contourf</code> has the same use of <code>contour</code> but fills the plot with different colors according to different levels. Here we simply change the <code>contour</code> to <code>contourf</code> in the above code to see the output: </p><pre class=" language-python"><code class="language-python">rosenbrockfunction <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token operator">*</span><span class="token punctuation">(</span>y<span class="token operator">-</span>x<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>X<span class="token punctuation">,</span>Y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Z <span class="token operator">=</span> rosenbrockfunction<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span>contourf<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> Z<span class="token punctuation">,</span> logspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> base <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap <span class="token operator">=</span> <span class="token string">'gray'</span><span class="token punctuation">)</span>title<span class="token punctuation">(</span><span class="token string">'Rosenbrock Function: $f(x,y) = (1-x)^2+100(y-x^2)^2$'</span><span class="token punctuation">)</span>xlabel<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>ylabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span></code></pre><pre><code>Text(0,0.5,&#39;y&#39;)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PzjUJ0.png" alt="output_21_1.png-9.8kB"></p><p>And we continue with the above example of Rosenbrock Function.<br>We use <strong>Powell’s method</strong> to find the minimum of Rosenbrock Function.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> scipy<span class="token punctuation">.</span>optimize <span class="token keyword">as</span> sorosenbrockfunction <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">100</span><span class="token operator">*</span><span class="token punctuation">(</span>y<span class="token operator">-</span>x<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>X<span class="token punctuation">,</span>Y<span class="token operator">=</span>meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Z<span class="token operator">=</span>rosenbrockfunction<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span>cs<span class="token operator">=</span>contour<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">,</span>logspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3.5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span>base<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>rosen<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> rosenbrockfunction<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>solution<span class="token punctuation">,</span> iterates <span class="token operator">=</span> so<span class="token punctuation">.</span>fmin_powell<span class="token punctuation">(</span>rosen<span class="token punctuation">,</span>x0<span class="token operator">=</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>retall<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>x<span class="token punctuation">,</span>y<span class="token operator">=</span>zip<span class="token punctuation">(</span><span class="token operator">*</span>iterates<span class="token punctuation">)</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">'ko'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># plot black bullets</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">'k:'</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># plot black dotted lines</span>title<span class="token punctuation">(</span><span class="token string">"Steps of Powell's method to compute a minimum"</span><span class="token punctuation">)</span>clabel<span class="token punctuation">(</span>cs<span class="token punctuation">)</span></code></pre><pre><code>Optimization terminated successfully.         Current function value: 0.000000         Iterations: 16         Function evaluations: 462&lt;a list of 11 text.Text objects&gt;</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pzj0QU.png" alt="output_23_2.png-41.6kB"></p><p>The iterative method <code>fmin_powell</code> applies Powell’s method to find a minimum.</p><p>It is started by a given start value of $x_0$ and reports all iterates when the option <code>retall=True</code> is<br>given.</p><p>After sixteen iterations, the solution $x=0, y=0$ was found. The iterations are depicted<br>as bullets in the above contour plot.</p><p>PS: </p><ol><li>to know about the function <code>zip</code>, you can check <a href="https://docs.python.org/3/library/functions.html#zip" target="_blank" rel="noopener">here</a>.</li><li><code>contour</code> also creates a contour set object that we assigned to the variable <code>cs</code>, which is then used by the command <code>clabel</code> to annotate the levels of the corresponding function values.</li></ol><h2 id="images-and-contours"><a href="#images-and-contours" class="headerlink" title="images and contours"></a>images and contours</h2><p>The following function will create a matrix of color values for the Mandelbrot fractal.<br>(click <a href="https://en.wikipedia.org/wiki/Mandelbrot_set" target="_blank" rel="noopener">here</a> to know about it)</p><p>Consider a fixed point iteration, that depends on a complex parameter $c$:</p><p>$ z_{n+1} = z_n^2 + c, with \space c \in \mathbb{C}$</p><p>Whether the sequence is bounded depends on the parameter $c$.</p><p>Here we consider the sequence to be bounded if the value in below the bound within <code>maxit</code> times iteration.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">mandelbrot</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span> maxit<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    X<span class="token punctuation">,</span>Y <span class="token operator">=</span> meshgrid<span class="token punctuation">(</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.4</span><span class="token punctuation">,</span> <span class="token number">1.4</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>    c <span class="token operator">=</span> X <span class="token operator">+</span> Y<span class="token operator">*</span><span class="token number">1j</span>    z <span class="token operator">=</span> c    exceeds <span class="token operator">=</span> zeros<span class="token punctuation">(</span>z<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span>bool<span class="token punctuation">)</span>    <span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span>maxit<span class="token punctuation">)</span><span class="token punctuation">:</span>         z <span class="token operator">=</span> z<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> c         exceeded <span class="token operator">=</span> abs<span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">4</span>         exceeds_now <span class="token operator">=</span> exceeded <span class="token operator">&amp;</span> <span class="token punctuation">(</span>logical_not<span class="token punctuation">(</span>exceeds<span class="token punctuation">)</span><span class="token punctuation">)</span>          exceeds<span class="token punctuation">[</span>exceeds_now<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>          z<span class="token punctuation">[</span>exceeded<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment" spellcheck="true"># limit the values to avoid overflow</span>    <span class="token keyword">return</span> exceedsimshow<span class="token punctuation">(</span>mandelbrot<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span></code></pre><pre><code>(-0.5, 399.5, 399.5, -0.5)</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/Pzjv6S.png" alt="output_26_1.png-2.5kB"></p><p>The command <code>imshow</code> displays the matrix as an image. The selected color map shows the regions where the sequence appeared unbounded in white and others in black. </p><p>Here we used <code>axis(&#39;off&#39;)</code> to turn off the axis as this might be not so useful for images.</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
            <tag> learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《北鸢》：一次野心超越了能力的尝试</title>
      <link href="2018/11/17/%E3%80%8A%E5%8C%97%E9%B8%A2%E3%80%8B%EF%BC%9A%E4%B8%80%E6%AC%A1%E9%87%8E%E5%BF%83%E8%B6%85%E8%B6%8A%E4%BA%86%E8%83%BD%E5%8A%9B%E7%9A%84%E5%B0%9D%E8%AF%95/"/>
      <url>2018/11/17/%E3%80%8A%E5%8C%97%E9%B8%A2%E3%80%8B%EF%BC%9A%E4%B8%80%E6%AC%A1%E9%87%8E%E5%BF%83%E8%B6%85%E8%B6%8A%E4%BA%86%E8%83%BD%E5%8A%9B%E7%9A%84%E5%B0%9D%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>这是一本你看了会觉得“它本可以写的更好”的小说，或者至少我这么觉得。</p><a id="more"></a><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>这是一篇读书笔记，希望在2018年我能坚持这个习惯。内容只含个人感受，因本人鉴赏水平有限，不具有参考价值，具体评判需由读者自己定夺。</p><p><strong>Update</strong>： 我觉得我有必要给这篇所谓“书评”增加一点内容，更新于2018年1月24日。</p><h2 id="小说简介"><a href="#小说简介" class="headerlink" title="小说简介"></a>小说简介</h2><p>以下简介摘自豆瓣。</p><p><img src="https://s1.ax1x.com/2018/09/03/PzMMPP.jpg" alt="s29051355.jpg-9.7kB"><br>内容简介：</p><blockquote><p>《北鸢》起笔于民国商贾世家子弟卢文笙的成长，收束于上世纪中叶。将波诡云谲的民国动荡史寄予两个家族的命运沉浮，书写中国最为丰盛起伏的断代。人生一线，恰似风筝。命运漂浮无着，人亦应有自己的主心骨。政客、军阀、寓公、文人、商人、伶人，书中上百位经典民国人物，进退于沧桑。群落交织，浑然磅礴。文笙在大时代的风云中辗转历练，且行且进，最终尘埃落定。每个人都有自己的来处，了解来处，才知道自己的去向。在故事的日常精微与家族兴颓里，藏着我们过去以及未来的影子。</p></blockquote><p>作者简介：</p><blockquote><p>葛亮，原籍南京，现居香港，任教于高校。香港大学中文系博士。作品出版于两岸三地，著有小说《北鸢》《朱雀》《七声》《谜鸦》《浣熊》《戏年》，文化随笔《绘色》，学术论著《此心安处亦吾乡》等。部分作品译为英、法、俄、日、韩等国文字。<br>曾获首届香港书奖、香港艺术发展奖、台湾联合文学小说奖首奖、台湾梁实秋文学奖等奖项。作品被收入“当代小说家书系”“二十一世纪中国文学大系”，入选2008、2009、2015年“中国小说排行榜”和“2015年度诚品中文选书”。长篇小说《朱雀》获选“《亚洲周刊》全球华文十大小说”。2016年以新作《北鸢》再获此荣誉。</p></blockquote><h2 id="读书笔记"><a href="#读书笔记" class="headerlink" title="读书笔记"></a>读书笔记</h2><p>我个人非常喜欢以个人命运展现家族兴衰的小说，因此当我看到《北鸢》这本书的简介时，我毫无悬念地被它所吸引了。但看完之后，我并不觉得自己读完了一部好作品。因为，如我的标题所言，我认为这是一次<strong>野心大于能力的尝试</strong>。</p><h3 id="一-历史"><a href="#一-历史" class="headerlink" title="一. 历史"></a>一. 历史</h3><p>从简介上看，作者是在有意识地将所谓民国动荡史加入小说内容的，事实也的确如此。</p><p>如果安排得当，小说的确会有一种历史的真实感和厚重感。在文章的这方面的力度控制得还算稳定，只略略提到李可染是吴清舫的弟子，这样虚实交叉的内容使人会心一笑。但从昭和携文笙远赴天津开始，作者对史实和小说的掌控开始有些失控了。</p><p>小说很大胆地将褚玉璞（书中化名为石玉璞）写成昭德的丈夫，这本是一桩很有趣的事情。褚玉璞这个人物在历史上本身就很有传奇色彩，他出身绿林，在革命浪潮中却成为一代军阀，但最终却惨遭活埋。这个角色如果作者深入刻画，相信能有不错的效果。但小说中对他的处理，给人的感觉是：<strong>作者完全把他当作一个历史人物，而非一个小说角色在处理</strong>。因此这个人物在小说中异常单薄的，他性情暴戾无常，但也仅此而已了。不过另外值得一提的是，褚玉璞枪杀五姨太也是历史上真实发生的故事。小说中对五姨太晓琴的角色刻画倒显得不错。你能感受到一个出身贫寒被迫嫁给军阀的年轻女孩的可爱和对真正爱情的向往。</p><p> 而当情节进入抗日战争的部分之后，作者掌控力的单薄已经显露无遗。我们这一代人接触了非常多关于这一时期的文学作品和影视作品，因此你非常容易发现葛亮的这部作品里，关于抗日战争的部分是非常<strong>不接地气</strong>的，以至于写出了一些传奇色彩，像极了网络上那些不入流的民国小说。在避难阶段，作者将教堂环境描写地宛如世外桃源，就已经给人强烈的割裂感了；更不必说那几个中文流利、在救治伤员之余还教中国孩子学英文的外国神职人员了。至于那位慰安妇小蝶舍身杀敌的剧情，我只能说，狗血得有些像我们经常见到的抗日神剧。</p><h3 id="二-人物"><a href="#二-人物" class="headerlink" title="二. 人物"></a>二. 人物</h3><p>再说到人物刻画方面。前面我已经提到石玉璞这个角色，但小说的问题远远不止这一个人物。在我看来，《北鸢》中大部分人物的性格都是单薄的，有时甚至是单一的，很多人物性格给人很相似的感觉——这一点尤其体现在配角上。而一些重要的配角，如凌佐、尹小姐、言秋凰等，我们可以看出作者的确下了些功夫，使得这些人物有些自己的特色，在一定程度上令人印象深刻。但这些角色总给人一种符号化的印象，在短篇小说中也许会很有特色，但在这样的长篇中，就略显俗套——长篇小说的角色应该更丰满些。</p><p>孟昭如这个角色我想单独说说。书的前半部分里，她是一个开明、知书达礼、心地善良的角色，能当众收养弃儿（这在封建文化里当然是很难得的），能接纳继女，遇人亲和，对待身边的仆从都照料周到。但最后，却莫名其妙成为了一个反对儿子参军事业、通过幽禁儿子来阻止其自由恋爱的迂腐角色。我以为，这是一个人物刻画上的矛盾。</p><p>而两位主角的刻画就更令人失望了。看官们或许会记得，小说开篇卢文笙抓阄未选一物的情节，吴清舫当时称赞说这是说明这孩子“不为世事所动”。看到这里的时候，每个读者想必都会认为这处情节应该是为卢文笙一生定下基调。但读罢全文，你很难将此与卢文笙这个角色联系起来；事实上，你（也许只是我）甚至很难对他的性格有所把握。他这一生上过学，逃过难，参过军，但参军被家人押回后，竟也就安心留在家中恋爱，而后又随人前往上海经商。作为小说的主角，他身上没有经历过什么性格上的转变，性格也没有明显的特色。而冯文桢，在小说的前半部分，基本是一个看客的身份出场的。她的存在意义仿佛是给读者提供一个观察冯家的视角，发生的情节大部分也与她没有关系，因此很难说在这部分内容里她能有什么所谓性格。在这部分，她因为革命丧亲，因此对革命一类的事情相当反感，而后半部分，抗战胜利后，她去到杭州大学，反而成为一个积极参与民主活动的女大学生；其中是何变故，也让人摸不着头脑。作者称这两个主角是<strong>“一静一动”</strong>，但恕我直言，这很难与他实际描写出来的角色契合。</p><p>顺便一提，《北鸢》这部小说中唯一令我觉得刻画得不错的人物是冯仁珏和冯明焕，前者有血有肉，后者虽然着笔不多，但特点鲜明。</p><h3 id="三-情节"><a href="#三-情节" class="headerlink" title="三. 情节"></a>三. 情节</h3><p>小说中出现的两个家庭，卢家和冯家，在大部分时间里是割裂的关系，像两个并行的故事一样。作者力图通过文笙和仁桢串起两个家族的关系，反倒显得有些莫名其妙。这两人从年少时的互相吸引，到长大后的恋爱，都让人觉得有些牵强。小说中甚至找不到一处关于他们两人爱情发展的关键情节。对比《金粉世家》，作者在此处的着力显得太不够了。可以说，无论是简单的二人恋爱，还是恋爱背后的家族关系，作者都没能写好。</p><p>另外一点，这两个家族都是在小说开篇就已经处在没落的状态，没有经历由繁盛到衰败的阶段，导致作者一直在渲染这种<strong>凉薄凄清</strong>的氛围，乃至用力过猛；因此简介中的“将波诡云谲的民国动荡史寄予两个家族的命运沉浮”这顶高帽子并不能戴给《北鸢》。</p><p>在细节上的处理，我也对它有些不满意。比如：凌佐托付给文笙安葬的继父的“命根子”，最后如何处理的？文中没有交代。六太太荣芝曾刺探过文笙的来历，为此甚至逼走过一个女仆，最后查出什么没有？文中也没有再提。后者令我颇为遗憾，因为这本是能生发出不错的剧情的一个伏笔：如果查出来了六太太会在家中激起怎样的戏剧冲突？文笙知道真相后，会如何自处？但这个本该成为伏笔的内容最后却成为了一个“废笔”，也导致“文笙被收养”的这个剧情，在情节上毫无作用。</p><h3 id="四-总述"><a href="#四-总述" class="headerlink" title="四. 总述"></a>四. 总述</h3><p>据说作者为写此书，花了七年的时间进行相关考据；但他似乎没有抓住小说真正重要的内容。他没能把握好“民国”这个时代背景（或者说他对这个时代背景过于痴迷，以至于一直在刻意渲染所谓的“民国氛围“），也没能写好“家族”这个庞大的主题。</p><p>如果要我给这本书打分的话，以五星为满分，我会给它两星半。</p><p>谨此为记。</p>]]></content>
      
      
      <categories>
          
          <category> Literature </category>
          
      </categories>
      
      
        <tags>
            
            <tag> book review </tag>
            
            <tag> novels </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PLA和pocket算法：简单Python实现</title>
      <link href="2018/09/03/PLA%E5%92%8Cpocket%E7%AE%97%E6%B3%95%EF%BC%9A%E7%AE%80%E5%8D%95Python%E5%AE%9E%E7%8E%B0/"/>
      <url>2018/09/03/PLA%E5%92%8Cpocket%E7%AE%97%E6%B3%95%EF%BC%9A%E7%AE%80%E5%8D%95Python%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="PLA-的-Python实现——机器学习基石作业"><a href="#PLA-的-Python实现——机器学习基石作业" class="headerlink" title="PLA 的 Python实现——机器学习基石作业"></a>PLA 的 Python实现——机器学习基石作业</h1><p>机器学习基石（上）第四周的选择题作业里有几个关于PLA的习题需要编程解决（15题-20题），因此在这里我用python3简单实现了PLA算法和pocket算法。</p><p>本文使用Jupyter notebook导出markdown文件生成。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> scipy <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">import</span> <span class="token operator">*</span></code></pre><p>数据集是题目中提供的。</p><pre class=" language-python"><code class="language-python">data <span class="token operator">=</span> loadtxt<span class="token punctuation">(</span>r<span class="token string">'C:\Users\huang\Desktop\Chapter.1\vs code\pla.txt'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># load data from txt file</span></code></pre><pre class=" language-python"><code class="language-python">data<span class="token punctuation">.</span>shape <span class="token comment" spellcheck="true"># the dataset size is 400, with x 4 dimensions and y 1 dimension</span></code></pre><pre><code>(400, 5)</code></pre><h2 id="可视化处理"><a href="#可视化处理" class="headerlink" title="可视化处理"></a>可视化处理</h2><p>尽管这里并不要求我们这么做，但是得到一个数据集后，很自然的想法就是对它进行<strong>可视化</strong>。</p><p>这里 $x$ 的维数较高，不方便直接进行可视化。但之前我有上过<strong>吴恩达的《Machine Learning》</strong>课程，里面介绍了一种叫<strong>PCA(主成分分析）</strong>的方法，可以用于数据降维，从而实现可视化。这里我们就小小地学以致用一下。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># firstly, normalize the data</span>x <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># take the input out</span>x_norm <span class="token operator">=</span> x<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># make sure the base is None</span>x_mean <span class="token operator">=</span> x_norm<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>x_std <span class="token operator">=</span> x_norm<span class="token punctuation">.</span>std<span class="token punctuation">(</span>axis <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>x_norm <span class="token operator">=</span> <span class="token punctuation">(</span>x_norm <span class="token operator">-</span> x_mean<span class="token punctuation">)</span><span class="token operator">/</span>x_std<span class="token comment" spellcheck="true"># calculate the covariance matrix</span>x_cov <span class="token operator">=</span> x_norm<span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>x_norm<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">400</span><span class="token comment" spellcheck="true"># do SVD</span>U<span class="token punctuation">,</span> S<span class="token punctuation">,</span> V <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>svd<span class="token punctuation">(</span>x_cov<span class="token punctuation">)</span>UReduce <span class="token operator">=</span> U<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># take the first two dimensions</span>z <span class="token operator">=</span> x_norm<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>UReduce<span class="token punctuation">)</span>z1 <span class="token operator">=</span> z<span class="token punctuation">[</span>where<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>z2 <span class="token operator">=</span> z<span class="token punctuation">[</span>where<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>fig <span class="token operator">=</span> figure<span class="token punctuation">(</span><span class="token punctuation">)</span>ax <span class="token operator">=</span> subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>z1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> z1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">,</span>label <span class="token operator">=</span> <span class="token string">'$y = 1$'</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>z2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> z2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'r*'</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">'$y = -1$'</span><span class="token punctuation">)</span>title<span class="token punctuation">(</span><span class="token string">'Visualization of Dataset'</span><span class="token punctuation">)</span>ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc <span class="token operator">=</span> <span class="token string">'upper left'</span><span class="token punctuation">,</span> fontsize <span class="token operator">=</span> <span class="token string">'small'</span><span class="token punctuation">)</span></code></pre><pre><code>&lt;matplotlib.legend.Legend at 0x20ec4995748&gt;</code></pre><p><img src="https://s1.ax1x.com/2018/09/03/PztZqK.png" alt="output_6_1.png-17.2kB"></p><p>可以看出 $y$ 为$-1,1$ 的两组点分布区域还是比较分明的。虽然在这个2D图上似乎没有办法找到一条直线把他们完美地分开，但不要忘记这是我们经过降维处理的图像。总之，既然是题目里给的数据集，那肯定是线性可分的了（笑）。</p><h2 id="naive-PLA-algorithm"><a href="#naive-PLA-algorithm" class="headerlink" title="naive PLA algorithm"></a>naive PLA algorithm</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">PLA</span><span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''    The function PLA is used to implement the PLA algorithm.    Parameter mat is the matrix of the dataset.    We start from w0 = 0 here.(Asuming sign(0) = -1)    '''</span>    m<span class="token punctuation">,</span>n <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape    w <span class="token operator">=</span> zeros<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># start from 0</span>    all_correct <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment" spellcheck="true"># as a mark to tell if the PLA ends</span>    update_cnt <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment" spellcheck="true"># counting the number of updating iterations</span>    bias <span class="token operator">=</span> ones<span class="token punctuation">(</span>m<span class="token punctuation">)</span>    x_vec <span class="token operator">=</span> c_<span class="token punctuation">[</span>bias<span class="token punctuation">,</span>mat<span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># add the bias terms</span>    <span class="token keyword">while</span> <span class="token operator">not</span> all_correct<span class="token punctuation">:</span>        all_correct <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment" spellcheck="true"># after the for-loop if still True, the while-loop will end</span>        <span class="token keyword">for</span> dat <span class="token keyword">in</span> x_vec<span class="token punctuation">:</span>            temp <span class="token operator">=</span> w @ dat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> temp <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true"># for we consider sign(0) = -1 here</span>                temp <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>            <span class="token keyword">if</span> sign<span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">!=</span> sign<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                w <span class="token operator">+=</span> dat<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> dat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># update the weight</span>                all_correct <span class="token operator">=</span> <span class="token boolean">False</span>                update_cnt <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">return</span> w<span class="token punctuation">,</span> update_cntw<span class="token punctuation">,</span> iteration <span class="token operator">=</span> PLA<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span>iteration<span class="token punctuation">)</span></code></pre><pre><code>[-3.         3.0841436 -1.583081   2.391305   4.5287635]  45</code></pre><p>这样是能够完成简单的<strong>PLA</strong>算法没有错，但是两重循环的写法并不符合我们<strong>vectorization</strong>的思想：我们知道，使用<strong>numpy</strong>和<strong>MATLAB</strong>的时候，向量化能产生更简洁、更快速的代码。因此我决定对对上述代码进行一些修改。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">new_PLA</span><span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''     rewrite the naive PLA algorithm using vectorazation.    '''</span>    m<span class="token punctuation">,</span>n <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape    w <span class="token operator">=</span> zeros<span class="token punctuation">(</span>n<span class="token punctuation">)</span>    bias <span class="token operator">=</span> ones<span class="token punctuation">(</span>m<span class="token punctuation">)</span>    x_vec <span class="token operator">=</span> c_<span class="token punctuation">[</span>bias<span class="token punctuation">,</span> mat<span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># add the bias terms</span>    update_cnt <span class="token operator">=</span> <span class="token number">0</span>    prepos <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment" spellcheck="true"># the previous position</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        out <span class="token operator">=</span> sign<span class="token punctuation">(</span>x_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> @ w<span class="token punctuation">)</span>        out<span class="token punctuation">[</span>out <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment" spellcheck="true"># sign(0) = -1 here</span>        false_ind <span class="token operator">=</span> where<span class="token punctuation">(</span>out <span class="token operator">!=</span> sign<span class="token punctuation">(</span>x_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># indices where PLA is false</span>        <span class="token keyword">if</span> <span class="token operator">not</span> false_ind<span class="token punctuation">.</span>any<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">break</span> <span class="token comment" spellcheck="true"># no false points</span>        <span class="token keyword">if</span> <span class="token operator">not</span> false_ind<span class="token punctuation">[</span>false_ind <span class="token operator">></span> prepos<span class="token punctuation">]</span><span class="token punctuation">.</span>any<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            prepos <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>        pos <span class="token operator">=</span> false_ind<span class="token punctuation">[</span>false_ind <span class="token operator">></span> prepos<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        w <span class="token operator">+=</span> x_vec<span class="token punctuation">[</span>pos<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> x_vec<span class="token punctuation">[</span>pos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># updating the weight</span>        prepos <span class="token operator">=</span> pos        update_cnt <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">return</span> w<span class="token punctuation">,</span> update_cntw1<span class="token punctuation">,</span> iteration1 <span class="token operator">=</span> new_PLA<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>w1<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span> iteration1<span class="token punctuation">)</span></code></pre><pre><code>[-3.         3.0841436 -1.583081   2.391305   4.5287635]  45</code></pre><p>两种方法得到了一样的结果，说明应该大体是正确的。不过值得注意的是，这道题中的选项都是范围。</p><p>我也在网络上看到别的朋友得到了不一样的结果，有的是 $37$ 次，有的是 $39$ 次。</p><p>看了一个朋友的代码后，我发现我们的不同之处在于：我每次更新权重 $w$ 后，下一次的检验是从当前位置的下一个开始的；而他的做法是继续检验当前位置。这是可以理解的做法——因为根据我们的更新公式，我们每次更新只是在缩小 $w$ 和 $x$ 的夹角，但并不能保证当前位置一次就调整完毕了，因此每次更新完继续回到这个点检验是很有道理的。把代码改成这种写法是非常容易的，我这里就不啰嗦了。</p><p>不同的方式导致了结果的不同，但大致上都在题中所给的 $31-50$ 次这个范围中。(虽然根据我的检验，好像每次从最开始开始检验需要更新 $60$ 次……）</p><p>下一题规定了我们每次检验的方式：随机得到一个顺序，每次检验按照这个顺序进行。</p><pre class=" language-python"><code class="language-python">total <span class="token operator">=</span> <span class="token number">0</span>m<span class="token punctuation">,</span>n <span class="token operator">=</span> data<span class="token punctuation">.</span>shape<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    rand_per <span class="token operator">=</span> random<span class="token punctuation">.</span>permutation<span class="token punctuation">(</span>m<span class="token punctuation">)</span>    data_rand <span class="token operator">=</span> data<span class="token punctuation">[</span>rand_per<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    w<span class="token punctuation">,</span> iterations <span class="token operator">=</span> new_PLA<span class="token punctuation">(</span>data_rand<span class="token punctuation">)</span>    total <span class="token operator">+=</span> iterationstotal<span class="token operator">/</span><span class="token number">2000</span></code></pre><pre><code>40.1695</code></pre><pre class=" language-python"><code class="language-python">data1 <span class="token operator">=</span> loadtxt<span class="token punctuation">(</span>r<span class="token string">'C:\Users\huang\Desktop\Chapter.1\vs code\pocket.txt'</span><span class="token punctuation">)</span>test <span class="token operator">=</span> loadtxt<span class="token punctuation">(</span>r<span class="token string">'C:\Users\huang\Desktop\Chapter.1\vs code\test.txt'</span><span class="token punctuation">)</span>test<span class="token punctuation">.</span>shape</code></pre><pre><code>(500, 5)</code></pre><h2 id="pocket-algorithm"><a href="#pocket-algorithm" class="headerlink" title="pocket algorithm"></a>pocket algorithm</h2><p><strong>pocket</strong>算法运用了<strong>贪心</strong>的思想：直到产生了错误更少的结果，才进行更新。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">pocket</span><span class="token punctuation">(</span>mat<span class="token punctuation">,</span> iter_num <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''    pocket algorithm implement.    what is different from PLA is that pocket pick a random point each time    and update if the new point causes less mistakes    '''</span>    m<span class="token punctuation">,</span>n <span class="token operator">=</span> mat<span class="token punctuation">.</span>shape    w <span class="token operator">=</span> zeros<span class="token punctuation">(</span>n<span class="token punctuation">)</span>    bias <span class="token operator">=</span> ones<span class="token punctuation">(</span>m<span class="token punctuation">)</span>    x_vec <span class="token operator">=</span> c_<span class="token punctuation">[</span>bias<span class="token punctuation">,</span>mat<span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># add the bias term</span>    out <span class="token operator">=</span> sign<span class="token punctuation">(</span>x_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> @ w<span class="token punctuation">)</span>    out<span class="token punctuation">[</span>out <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment" spellcheck="true"># for sign(0) = -1 here</span>    pre_error <span class="token operator">=</span> sum<span class="token punctuation">(</span><span class="token punctuation">(</span>out <span class="token operator">-</span> x_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># calculate the error</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>iter_num<span class="token punctuation">)</span><span class="token punctuation">:</span>        false_id <span class="token operator">=</span> where<span class="token punctuation">(</span>out <span class="token operator">!=</span> x_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># the indices of mistakes</span>        <span class="token keyword">if</span> <span class="token operator">not</span> false_id<span class="token punctuation">.</span>any<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        rand_id <span class="token operator">=</span> false_id<span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>len<span class="token punctuation">(</span>false_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># randomly pick one false point</span>        w <span class="token operator">+=</span> x_vec<span class="token punctuation">[</span>rand_id<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> x_vec<span class="token punctuation">[</span>rand_id<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># updating the weight</span>        out <span class="token operator">=</span> sign<span class="token punctuation">(</span>x_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> @ w<span class="token punctuation">)</span>        out<span class="token punctuation">[</span>out <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>        new_error <span class="token operator">=</span> sum<span class="token punctuation">(</span><span class="token punctuation">(</span>out <span class="token operator">-</span> x_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> new_error <span class="token operator">&lt;</span> pre_error<span class="token punctuation">:</span>            w_pocket <span class="token operator">=</span> w<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># w_pocket's base should not be w</span>            pre_error <span class="token operator">=</span> new_error    <span class="token keyword">return</span> w_pockettotal <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a<span class="token punctuation">,</span>b <span class="token operator">=</span> test<span class="token punctuation">.</span>shape    bias <span class="token operator">=</span> ones<span class="token punctuation">(</span>a<span class="token punctuation">)</span>    test_vec <span class="token operator">=</span> c_<span class="token punctuation">[</span>bias<span class="token punctuation">,</span> test<span class="token punctuation">]</span>    rand_per <span class="token operator">=</span> random<span class="token punctuation">.</span>permutation<span class="token punctuation">(</span>m<span class="token punctuation">)</span>    data_rand <span class="token operator">=</span> data1<span class="token punctuation">[</span>rand_per<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    w_pocket <span class="token operator">=</span> pocket<span class="token punctuation">(</span>data_rand<span class="token punctuation">)</span>    out <span class="token operator">=</span> sign<span class="token punctuation">(</span>test_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> @ w_pocket<span class="token punctuation">)</span>    out<span class="token punctuation">[</span>out <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    error <span class="token operator">=</span> sum<span class="token punctuation">(</span><span class="token punctuation">(</span>out <span class="token operator">-</span> test_vec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>    total <span class="token operator">+=</span> error<span class="token operator">/</span>atotal<span class="token operator">/</span><span class="token number">2000</span></code></pre><pre><code>0.13328099999999982</code></pre><p>下一题要求我们的pocket算法不返回 $w_{pocket}$ ，而返回 $w$，再重复上述步骤，计算平均错误率。<br>这只需要把<code>pocket</code>函数的返回值修改一下就好了，算出来的结果大概是 $0.36$ 左右。</p><p>最后一题要求我们在每次循环 $100$次，而非 $50$ 次，再观察结果。<br>这只需要在调用<code>pocket</code>函数时，多加上循环次数这个参数即可（因为默认为 $50$ 次):</p><pre class=" language-python"><code class="language-python">w_pocket <span class="token operator">=</span> pocket<span class="token punctuation">(</span>data_rand<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span></code></pre><p>结果大概是 $0.11$。</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
            <tag> learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to Markov chain</title>
      <link href="2018/09/03/Introduction%20to%20Markov%20chain/"/>
      <url>2018/09/03/Introduction%20to%20Markov%20chain/</url>
      
        <content type="html"><![CDATA[<p><strong>马尔可夫链（Markov chain）</strong>是数学建模和机器学习常用的工具（据说尤其在<strong>NLP</strong>中，我目前尚不了解很多，但之前曾看过一篇<a href="https://codeburst.io/how-i-generated-inspirational-quotes-with-less-than-20-lines-of-code-38273623c905" target="_blank" rel="noopener">用简单的马尔可夫链实现一个<strong>鸡汤生成器</strong>的博文</a>，有兴趣的朋友可以看看）。这篇文章将对它做一个简单的介绍。</p><p>以下内容为本人在参考了一些资料后的原创，因此版权属于本人。<strong>欢迎转载，但请标明原作者和原链接。</strong> </p><p>由于内容比较繁多，我将在未来一段时间内完成这篇文章。</p><p><strong>另注</strong>：根据作者测试，本文在移动端存在一个问题：<strong>公式无法显示完全</strong>。 解决办法是点击公式，使其出现选择框；长按至出现选项；选择<code>Math Settings</code> 里的 <code>Scale All Math...</code> 将scale调为大概50%，即可显示完全。</p><p>如下图所示：</p><p><img src="http://static.zybuluo.com/EtoDemerzel/3130bv3lmtaef0vw98loxjw7/image_1c52vkbaacsv1euj1eqabv61b2rm.png" alt="image_1c52vkbaacsv1euj1eqabv61b2rm.png-67.5kB"></p><h2 id="什么是Markov-chain？"><a href="#什么是Markov-chain？" class="headerlink" title="什么是Markov chain？"></a>什么是Markov chain？</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>维基百科上给出的定义如下：</p><blockquote><p>马尔可夫链（英语：<strong>Markov chain</strong>），又称离散时间马尔可夫链（<strong>discrete-time Markov chain</strong>，缩写为<strong>DTMC</strong>），因俄国数学家安德烈·马尔可夫（俄语：<strong>Андрей Андреевич Марков</strong>）得名，为状态空间中经过从一个状态到另一个状态的转换的随机过程。该过程要求具备<strong>“无记忆”</strong>的性质：下一状态的概率分布<strong>只能由当前状态决定</strong>，在时间序列中它前面的事件均与之无关。这种特定类型的“无记忆性”称作<strong>马尔可夫性质</strong>。马尔科夫链作为实际过程的统计模型具有许多应用。</p></blockquote><p>而用形式化的语言描述则为：<br>当等式两边的条件概率都有意义时，<br>$$P(X_{n+m} = j\space| X_{n} = i, X_{n-1} = i_{n-1},…X_{1} = i_{1} ) = P(X_{n+m} = j\space| X_{n} = i)$$<br>$m = 1$ 时等式成立，则随机变量序列 $X_n$ 是一个<strong>马尔可夫链</strong>, $X_i$ 的可能值构成的<strong>可数集</strong>称为该链的<strong>状态空间（state space）</strong>。</p><h3 id="定义的推论"><a href="#定义的推论" class="headerlink" title="定义的推论"></a>定义的推论</h3><p>使用<strong>数学归纳法</strong>容易证明， 若 $m = 1$时 上式成立，则 $m$ 为任意正整数都成立。<br>要完成这个证明，我们先证明这样一个引理：</p><blockquote><p><strong>引理1</strong> $P(A|B) = \sum P(A|B\cap C_i)\times P(C_i|B)$<br>其中，$\sum P(C_i) = 1$。</p></blockquote><p><strong>证明</strong>：</p><p> $$\sum P(A|B\cap C_i)\times P(C_i|B)=\sum \frac{P(A\cap B\cap C_i)}{P(B\cap C_i)}\times P(C_i|B)= \sum \frac{P(A\cap B\cap C_i)}{P(B)P(C_i|B)}\times P(C_i|B) \\= \sum \frac{P(A\cap B\cap C_i)}{P(B)} = \frac{\sum P(A\cap B \cap C_i)}{P(B)} = \frac{P(A\cap B)}{P(B)}= P(A|B)$$</p><p>由<strong>引理1</strong>，我们有：<br>$$P(X_{n+m+1} = k\space|X_n = i, X_{n-1} = i_{n-1},…X_1 = i_1 )\\=\sum_{k’ \in S}P(X_{n+m+1} = k\space|X_{n+m}=k’,X_n = i, X_{n-1} = i_{n-1},…X_1 = i_1)\\ \times P(X_{n+m}=k’\space|X_n = i, X_{n-1} = i_{n-1},…X_1 = i_1)$$  </p><p>这里我们已经知道 $m = 1$ 时是成立的，那么<br>$$P(X_{n+m+1} = k\space| X_{n+m} = k’, X_{n+m-1} = i_{n+m-1},…X_1 = i_1 )\\=P(X_{n+m+1} = k\space| X_{n+m} = k’)\\=P(X_{n+m+1} = k\space| X_{n+m} = k,X_{n} = i_{n})$$<br>这个等式成立是因为 $X_{n+m+1}$ 只与 $X_{n+m}$ 有关，至于我们为什么要引入 $X_{n} = i$,稍后再说。</p><p>对于乘号右边的 $P(X_{n+m}=k’\space|X_n = i, X_{n-1} = i_{n-1},…X_1 = i_1)$, 根据归纳假设，有：<br>$ P(X_{n+m}=k’\space|X_n = i, X_{n-1} = i_{n-1},…X_1 = i_1) = P(X_{n+m} = k’\space|X_n=i_n)$</p><p>于是，上面的等式可以改写为：<br>$$ P(X_{n+m+1} = k\space| X_{n+m} = k’, X_{n+m-1} = i_{n+m-1},…X_1 = i_1 )\\ =\sum_{k’\in S} P(X_{n+m+1} = k\space| X_{n+m} = k’,X_{n} = i_{n}) \times P(X_{n+m} = k’\space|X_n=i_n) $$</p><p>接下来我们证明第二个引理：</p><blockquote><p><strong>引理2</strong>： $P(A\cap B|C) = P(A|B\cap C) \times P(B|C)$</p></blockquote><p><strong>证明</strong> ：<br>$$P(A|B\cap C) \times P(B|C) = \frac{P(A\cap B\cap C)}{P(B\cap C)}\times \frac{P(B\cap C)}{P(C)} = \frac{P(A\cap B\cap C)}{P(C)} = P(A\cap B|C)$$</p><p>写到这里，刚才我们引入 $X_{n} = i$ 的目的就很显然了。我们可以将刚才的等式再次改写为：<br>$$ P(X_{n+m+1} = k\space| X_{n+m} = k’, X_{n+m-1} = i_{n+m-1},…X_1 = i_1 )\\ =\sum_{k’\in S} P(X_{n+m+1} = k\space| X_{n+m} = k’,X_{n} = i_{n}) \times P(X_{n+m} = k’\space|X_n=i_n) \\ =\sum_{k’\in S} P(X_{n+m+1} = k,X_{n+m} = k’\space|X_{n} = i_{n})\\= P(X_{n+m+1} = k\space|X_n=i_n)$$</p><p>这样，我们证明了，如果$m = 1$等式成立， 当$m$为任意正整数时，该等式都成立。</p><h2 id="概率转移矩阵"><a href="#概率转移矩阵" class="headerlink" title="概率转移矩阵"></a>概率转移矩阵</h2><h3 id="开普曼-柯尔莫哥洛夫公式"><a href="#开普曼-柯尔莫哥洛夫公式" class="headerlink" title="开普曼-柯尔莫哥洛夫公式"></a>开普曼-柯尔莫哥洛夫公式</h3><p>刚刚我们分析的正是马尔可夫链的第一个性质：<strong>马氏性</strong>。<br>接下来我们要讨论另一个性质：<strong>时齐性（time-homogeneity）</strong>。<br>时齐性是指，<strong>系统由状态 $i$ 到状态 $j$ 的转移概率只依赖于其时间间隔的长短，与起始时间无关</strong>。<br>用形式化的语言描述：<br> $$P(X_{n+m} = j\space | X_{n} = i) = P(X_{n+m+k} = j\space | X_{n+k} = i)$$</p><p>既然与起始时间 $n$ 无关， 那我们就可以将概率 $P(X_{n+m} = j\space | X_{n} = i)$ 写作  $P_{ij}(m)$ 。</p><p>需要注意的是，<strong>时齐性是我们的假设</strong>，而非能通过数学推导得出的性质。我们做出这个假设是因为它符合我们现实生活中的场景。</p><p>对于符合时齐性的马尔可夫链，我们可以定义这样一个<strong>概率转移矩阵</strong>$P(m)$：<br>$P(m)$ 是以 $m$ 步转移概率$P_{ij}(m)$为元素的矩阵（即   $(P(m))_{ij} = P_{ij}(m)$，也称为该链的 <strong>$m$ 步转移矩阵</strong>。通常记 $P(1)$ 为 $P$。</p><p>它具有以下几个性质：</p><ul><li><p>  $\forall i,j\in S, 0 < P_{ij}(m) < 1$ . </p></li><li><p>  $\displaystyle{\forall i, \sum_{j\in S} P_{ij}(m) = 1}$   换句话说， $P(m)$ 的每一行都是在 $S$ 上的一个概率分布。</p></li><li><p>$P(0)$ 是一个单位矩阵。</p></li></ul><p>以上几个性质比较显然，这里就不做更多说明。</p><p>这里要重点提到的是<strong>开普曼-柯尔莫哥洛夫公式（The Chapman-Kolmogorov Equations）</strong>：</p>$ \forall m,n, P(m+n)  = P(m)P(n)\\$亦即，$\forall m,n, P_{ij}(m+n) = \displaystyle{\sum_{k\in S}P_{ik}(m)P_{kj}(n)}$ <p> <strong>证明</strong>：由<strong>引理1</strong></p> $$\displaystyle{P_{ij}(m+n) = P(X_{m+n+1} = j \space| X_1 = i)\\ = \sum_{k\in S}P(X_{m+n+1} = j |X_{m+1} = k, X_1 = i)\times P(X_{m+1} = k\space|X_1 = i)\\=\sum_{k\in S}P_{ik}(m)P_{kj}(n)}$$<p>由此，我们能得到以下两个推论：</p><blockquote><p> <strong>推论1</strong>： $ P(n) = P(n-1)P(1) = P(n-2)P(1)^2 = …P(1)^n = P^n$</p><p> <strong>推论2</strong>： 如果我们设初始的概率分布为 $P^{(0)} $（行向量）,  那么经过了 $n$ 个步骤后的概率分布 $P^{(n)} = P^{(0)}P(n) = P^{(0)}P^n$ </p></blockquote><h3 id="极限概率分布"><a href="#极限概率分布" class="headerlink" title="极限概率分布"></a>极限概率分布</h3><p>我们知道，概率分布矩阵的每个元素都属于$[0,1]$， 那么很自然地，我们就会想知道：</p><p>对其求 $n$ 次幂后得到的 $P^n$, 是否有极限呢？</p><p>对于有限的随机序列 $X_n$, $P$ 和 $P^n$ 都是大小有限的方阵。这意味着我们也许可以用单纯的线性代数思想来解决这个问题。</p><h4 id="线性代数的角度"><a href="#线性代数的角度" class="headerlink" title="线性代数的角度"></a>线性代数的角度</h4><p>纯粹从线性代数的角度来看这个问题，我们的 $P$ 具有什么性质呢？</p><blockquote><ol><li>所有元素均为非负数。</li><li>每行元素和为 $1$。</li></ol></blockquote><p>在这样性质的基础上，下面我们证明：</p><blockquote><ol><li>$P$ 的任意一个特征值 $\lambda$ 满足 $ |\lambda| &lt;= 1$。</li><li>$P$ 有特征值 $1$， 且非重根。</li></ol></blockquote><p><strong>证明</strong>：</p><ol><li><p>令 $\lambda$ 对应的特征向量 $x = (x_1, x_2,...x_n)^T$, 设 $x_i = max\{x_1,x_2...,x_n\}$。</p><p> 由于 $Px = \lambda x$,  $(Px)_{i} = \displaystyle{\sum_{j=1}^n a_{ij}x_{j}} = \lambda x_i$</p><p> 两边同时取绝对值，有  $|\lambda| |x_i| =  |\displaystyle{\sum_{j=1}^n a_{ij}x_{j}}|\\\leqslant \displaystyle{\sum_{j=1}^n a_{ij}|x_{j}}| \leqslant \displaystyle{(\sum_{j=1}^n a_{ij})|x_i| = x_i}$ </p><p> 因此 $\lambda \leqslant 1$。</p><p> ​</p></li><li><p>很容易发现 $1$ 是一个特征值，我们只需要取 $x = (1,1,..1)^T$，就可以很容易地发现 $Px = x$。</p><p>因此我们需要证明的是 $1$ 不是重根。</p><p>采用<strong>反证法</strong>。</p><p>我们已经知道 $1$ 是一个特征值，如果他是重根的话，那么 $det(P-\lambda I)$ 中至少有两个 $(1-\lambda)$ 的因子。</p><p>对于 $det(P-\lambda I)$ ， 我们把每一列的数字累加到第 $n$ 列，可使第 $n$ 列全为 $(1-\lambda)$，这里我们可以提出第一个因子。这时行列式最右一列均为 $1$， 一个很自然的想法是，前 $n -1 $ 行减去第 $n$ 行：这样第 $n$ 列就只有一个非零元了。按第 $n$ 列展开，我们得到 $det(P-\lambda I) = (1-\lambda) det(Q-\lambda I’)$。其中$Q$ 为 $n-1$ 阶方阵，且$Q_{ij} = a_{ij} - a_{nj}$；$I’$ 是 $n-1$ 阶单位矩阵。这是很容易验证的。</p><p>这时候 $Q$ 必有特征值 $1$. </p><p>接下来我们考虑 $Q$ 关于 $1$ 的<strong>行特征向量</strong>（注意是<strong>行特征向量</strong>，即 $Q^T$ 的列特征向量）$\beta = (\beta_1,\beta_2,..\beta_{n-1})$。</p><p>我们有 $$(\beta Q)_j = \displaystyle{\sum_{i=1}^{n-1}\beta_i(a_{ij}-a_{nj})=\beta_j}$$ </p><p>接下来讨论 $\beta$ 中元素的正负性。设有 $p$ 个正元素（分别为 $\beta_{s_1},\beta_{s_2},..\beta_{s_p}$）; $q$ 个非正元素（分别为$\beta_{t_1},\beta_{t_2},..\beta_{t_q}$）。另外我们不妨设$\rho = |\beta|\geqslant 0$；因为如果小于 $0$， 我们可以取 $-\beta$ 作为我们讨论的对象。</p><p>这样，对 $\beta$ 中的正元素，我们可以将上面的式子改写为：</p>   $$  \displaystyle{\sum_{i=1}^{n-1}\beta_ia_{it_k}-\rho a_{nt_k}=\beta_{t_k}}\space\space (k = 1,2,...p)$$    累加，得到：   $$  \displaystyle{\sum_{i=1}^{n-1}\beta_i(\sum_{k = 1}^{p}a_{it_k})-\rho( \sum_{k=1}^{p}a_{nt_k})=\sum_{k=1}^p\beta_{t_k}}$$    <p>为了简化式子，不妨令 $d_i = \displaystyle{\sum_{k=1}^{p}a_{it_k} < \sum_{i=1}^{n}a_i = 1}$ ：</p>   $$  \displaystyle{\sum_{i=1}^{n-1}\beta_id_i-\rho d_n=\sum_{k=1}^p\beta_{t_k}}$$    $$  \displaystyle{\sum_{k=1}^{p}\beta_{s_k}d_{s_k} + \sum_{k=1}^{q}\beta_{t_k}d_{t_k}-\rho d_n=\sum_{k=1}^p\beta_{t_k}}$$   $$  \displaystyle{\sum_{k=1}^{q}\beta_{t_k}d_{t_k}-\rho d_n=\sum_{k=1}^p\beta_{t_k} - \sum_{k=1}^{p}\beta_{s_k}d_{s_k} > 0}$$   <p>而等式左边显然是负数，矛盾。这说明 $Q$ 没有特征值 $1$， 也就是说 $P$ 的特征值 $1$ 无重根。</p></li></ol><p>回到我们对极限的讨论。如果这个极限 $L$ 存在，那么它会满足：$$LP = L$$</p><p>也就是说它的每一行都是 $P$ 关于特征值 $1$ 的行特征向量； 我们刚刚证明$1$ 这个特征值无重根，那么这个行特征向量是唯一的。</p><p>—— 是的， $L$ 的每一行都相同，均为 $P$ 关于 $1$ 的行特征向量。</p><h4 id="极限何时存在？"><a href="#极限何时存在？" class="headerlink" title="极限何时存在？"></a>极限何时存在？</h4><p>【 最近事务繁多，更新无限期推迟】</p><p>有任何错误，请在评论区指正或者给我发邮件。（评论使用Disqus系统，可能需要翻墙）</p>]]></content>
      
      
      <categories>
          
          <category> math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
            <tag> learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>南朝金粉太平春，万里山河处处青</title>
      <link href="2018/09/03/%E5%8D%97%E6%9C%9D%E9%87%91%E7%B2%89%E5%A4%AA%E5%B9%B3%E6%98%A5%EF%BC%8C%E4%B8%87%E9%87%8C%E5%B1%B1%E6%B2%B3%E5%A4%84%E5%A4%84%E9%9D%92/"/>
      <url>2018/09/03/%E5%8D%97%E6%9C%9D%E9%87%91%E7%B2%89%E5%A4%AA%E5%B9%B3%E6%98%A5%EF%BC%8C%E4%B8%87%E9%87%8C%E5%B1%B1%E6%B2%B3%E5%A4%84%E5%A4%84%E9%9D%92/</url>
      
        <content type="html"><![CDATA[<p><strong>西郊芳草年年绿，多少游人似去年？</strong></p><p>《金粉世家》的小说正篇以这样一句诗作结。</p><p>这北京西郊的芳草，当年曾亲见金总理家的七少爷在信马游春时，对一个穿着青色衣裙的女学生一见倾心；如今又见证了八小姐梅丽和谢玉树轮蹄相驰，互萌爱意。这本是何其浪漫的两个场景，却因为前一对浪漫主角的凄然结局而显得有些讽刺。</p><p>每一位读完《金粉世家》的读者想必都会思考这样一个问题：<strong>金燕西到底有没有爱过冷清秋？</strong></p><p>在我看来，答案很显然是：<strong>没有</strong>。</p><p>或者更严谨一点，从”爱“这个词的一般定义来看，是没有的；而以金燕西自己的标准来看，是有的，并且根据这样的标准，他爱过的人还包括白秀珠，白莲花，白玉花，小怜，等等，但他的这种爱需要新鲜感来维系。</p><p>冷清秋一直以为，他们爱情的最终失败源于四个字：<strong>齐大非偶</strong>。但门第的差距并不是真正的原因；作者已经悄悄给我们提供了几个反例：无论是柳春江和小怜，还是卫璧安和吴蔼芳，双方的门第差距都不比金冷二者小，甚至更大，但他们都获得了幸福的结局。读者也可以看到，除了三少奶奶王玉芬因为白家对清秋怀恨在心之外，她并没有受到多少来自家庭的阻隔。金家几位姐妹以及金太太都非常喜欢她，而她的为人亲和也赢得了仆人们的尊重。</p><p>但爱情终究是两个人的事情，她在婚姻中遇到的一切不如意其实都是因为她曾经的佳偶金燕西。所以，如果一定要用四个字描述他们悲剧的原因，我想应该是：<strong>遇人不淑</strong>。</p><p>只看了开头的读者也许会误把金燕西当作一个痴情公子，这也是作者刻意要营造的假象。与此同时，他也在细微处让金燕西流露出自己的本性。</p><p>读者会记得，金燕西西直门外对冷清秋一见钟情，随后花了一些力气找到了她家，从而展开了自己的追求攻势。但他们也许会忘了下面这段对话：</p><blockquote><p>金荣笑道：“七爷，你要找的那个人，给你找到了。” </p><p>燕西道：“我要找谁？” </p><p>金荣笑道：“七爷很挂心的一个人。” </p><p>燕西道：“我挂心的是谁？我越发不明白你这话了。” </p><p>金荣道：“七爷就全忘了吗？那天在海淀看到的那个人呢。”</p></blockquote><p>——我们可以看出，他对冷清秋这个人其实并没有那么挂念，如果不是金荣提起，恐怕已经全忘了。</p><p>但就在当天，在还不知道冷清秋的名字的情况下，他第一次萌生了要娶她的念头：</p><blockquote><p>一回房，便想起落花胡同那个女孩子，心想，老大的话，果然不错。若说交女朋友，自然是交际场中新式的女子好。<strong>但是要结为百年的伴侣，主持家事，又是朴实些的好。若是我把那个女孩子娶了回来，我想她的爱情，一定是纯一的，人也是很温和的，决不象交际场中的女子，不但不能干涉她的行动，她还要干涉你的行动啦</strong>。就以姿色论，那种的自然美，比交际场中脂粉堆里跳出来的人，还要好些呢。好，就是这样办。</p></blockquote><p>——读者于是知道，他需要的并不是冷清秋，而是一个旧式的女子：爱情纯一，能主持家事，又不干涉他在外结交女朋友。事实证明他没有看错人，婚后的冷清秋的确是这么做的。</p><p>之后二人的关系，在金燕西的攻势下逐渐升温，并在第一次西山之行达到一个小顶点。</p><p>在西山，金燕西对冷清秋做出了真挚的表白：</p><blockquote><p>燕西道：“我不是说了吗？婚姻自由，他们是不能过问的。只要你不嫌弃我，这事就成立了。慢说他们不能不赞成，就是实行反对，他还能打破我们这婚约吗？你若是拒绝我的要求，就请你明说。不然，为了两家门第的关系，将我们纯洁的爱情发生障碍，那未免因小失大。<strong>而且爱情的结合，只要纯正，就是有压力来干涉，也要冒万死去反抗，</strong>何况现在并没有什么阻碍发生呢？”</p></blockquote><p>金燕西说这些话的时候，一定是相信自己深爱着冷清秋的。他觉得两人的爱情就是真正的新式爱情，没有来自长辈的干涉，没有门当户对的成见。因此冷清秋也信了。尽管她一直有着齐大非偶的担忧，却最终仍然接受了他送的戒指。</p><p>但清秋对于燕西究竟是个怎样的人也非毫无知觉。她深知“月满则缺，水满则倾”，因此表达了希望二人“生疏些”的愿望；在热恋之际，两人赏月的美好时刻，她说出“多情自古空余恨，好梦由来最易醒”这样悲怆的话语，也能看出她对未来的担忧；在第二次西山之行，她甚至和燕西有了这样的对话：</p><blockquote><p>清秋笑道：“你所认识的女朋友，有小姐、有女学生、有戏子，还有交际明星，岂不是交际很广？”</p><p>燕西道：“这是哪里来的谣言？全没有这回事。”</p><p>清秋笑道：“管他有没有，大家心里明白就是了。”</p></blockquote><p>尽管如此，这天晚上，她还是把自己的处女之身献给了金燕西，而这也成了他们悲剧婚姻的起点。</p><p>《金粉世家》这本书，在我看来，有两个转折点。第一个转折点，是金冷二人的婚礼：自此之后，小说中再也没有二人的甜蜜，爱情逐渐滑入悲剧；第二个转折点，就是金铨之死，金家由此分崩离析，树倒猢狲散。</p><p>婚后燕西对清秋态度的转变，这里不详细讲述。我们只消看下面这几个例子。</p><p>在帮助刘宝善出狱后，燕西回家。在听了清秋一番分析后，</p><blockquote><p>燕西觉得夫人如此聪明，说得又如此可怜，不觉心动，望着夫人的脸，只管注意。<strong>男女之间，真是有一种神秘，这一下子，燕西夫妇又回复到了新婚时代了</strong>。</p></blockquote><p>在此之前，二人已不似从前那般甜蜜。这次只因燕西在清秋身上又找到了一些神秘感，才使二人感情有所回温。</p><p>之后，当二人感情彻底破裂，清秋的独立意识觉醒，决心离婚时，燕西和梅丽有了这样一番对话：</p><blockquote><p>梅丽冷笑道：“你说这话，以为夫妻拆开，也像主人辞退一个下人一样呢。” </p><p>燕西道：“那本来没有什么分别。”</p></blockquote><p>而当清秋最终携子“火遁”之后，他则有这样的心理活动：</p><blockquote><p>我又不是不让她离婚，何必有这种行动？</p><p>是了，一定是怕我要回小孩来，所以带着他隐藏起来了。</p><p>其实我不过二十岁的人，哪里会愁到没有孩子？你带了去就只管带了去，我是丝毫也不关痛痒的。</p></blockquote><p>至此，金燕西的真面目彻底地展示在了读者面前。从头到尾，他对冷清秋的感情，不过是一个纨绔子弟对怀春少女的新鲜感，新鲜感一消退，这所谓感情也就不存在了。</p><p>冷清秋最终也是明白这个道理的。她承认，自己是<strong>“受着物质与虚荣的引诱，就把持不定地嫁给了燕西”，“结果是卖了自己的身子，来受人家奚落”</strong>。</p><p>我们这时候把角度放大，其实金家其他几个子弟又何尝不是跟金燕西一样呢？</p><p>老大凤举在外养妾，让人骗走身家；其他几位包括燕西都在外追捧戏子。他们整日花天酒地，不学无术，做家庭里的寄生虫。在“宿主”金铨意外身亡后，这些寄生虫也就现出原形，无处求生了。金燕西本人，则是从一个富贵公子，沦为了一个出演电影的戏子。</p><p>此时我们再看回小说的标题。</p><p><strong>“金粉世家”之“金粉”，何也？我以为，是南朝之金粉也。</strong>彼时宋齐梁陈几朝，偏居江南，国力日衰，国君生活却绮艳奢靡。四朝最后都短命而终。昔人有诗句：“南朝四百八十寺，多少楼台烟雨中。”</p><p>我无意对小说主旨深追，读者看了心中自有定论。</p><p>写到这里，本文也该结束了。作为一篇书评，这篇文章的展开是以金燕西为线索的。由于我的懒惰，这条线索也没能写得详尽（因为写太长的确很累）；但冷清秋一线，实在也非常重要。读了小说的朋友会发现，作者在文中不断提到新旧思想的碰撞交融。金家是名义上的新式家庭，在很多地方却流于旧式；冷清秋大体上是个旧式女子，却在最后有了新式女子独立意识的觉醒。展开来写的话，我想这会是一个非常有趣的主题。但我实在不是一个中文系的学生，对文学批评只有很粗浅的一些想法。因此这里，我谨摘录冷清秋与金燕西的诀别书与诸位分享，以此为此文作结。这篇诀别书非常精彩，将冷清秋独立意识的觉醒展现得淋漓尽致，于全书实在是画龙点睛之妙。</p><p>最后顺嘴说一句，这本书开年读完实在有些遗憾，因为我不知道这一整年我能否再读到一本能与之相比的小说了。</p><blockquote><p>燕西先生文鉴：</p><p>​        西楼一火，劳燕遂分，别来想无恙也。秋此次不辞而别，他人必均骇然，而先生又必独欣然。<strong>秋对于欣然者，固无所用其不怿</strong>，而对于骇然者，亦终感未能木然置之。何也？知者谓我逃世，不知者谓我将琵琶别抱也。再四思维，于是不得不有此信之告矣。<br>​       秋出走之初，原拟携此呱呱之物，直赴西郊，于昆明湖畔，觅一死所。继思此呱呱之物，果何所知？而亦遭此池鱼之殃。况吾家五旬老母，亦唯秋一点骨肉，秋果自尽，彼孑然 一身，又何生为？秋一死不足惜，而更连累此一老一少。天地有好生之德，窃所不忍也。为此一念徘徊郊外，久不能决。凡人之求死，只在最初之五分钟，此五分钟犹豫既过，勇气顿失，愈不能死。于是秋遂薄暮返城，托迹女友之家，一面函告家母，约予会见。<br>​       家母初以秋出走非是，冀覆水之重收。<strong>此秋再三陈以利害，谓合则在君势如仇敌，在秋形同牢囚。人生行乐耳，乃为旧道德之故，保持夫妻名义，行尸走肉，断送一生，有何趣味？若令秋入金门，则是宣告我无期徒刑，入死囚之牢也。</strong><br>​       家母见秋之志已决，无可挽回，于是亦毅然从秋之志，愿秋与君离异，以 另谋新生命。惟是秋转念择人不慎，中道而去，知者以为君实不德，秋扇见捐，不知者以为秋高自攀附，致遭白眼。则读书十年，所学何事？夫赵孟所贵，赶孟能贱之，本不足怪。然齐大非偶，古有明训，秋幼习是言，而长乃昧于是义，是秋之有今日，秋自取之。<br>​       而今而后，尚何颜以冷清秋三字，以与社会相见乎？因是秋遂与母约，扬言秋已步三闾大夫后少，葬身于昆明湖内，从此即隐姓埋名，举家而遁于他方。金冷婚约，不解而解矣。<br>​       秋家今已何往？君可不问。至携一子，为金门之骨肉，本不应与同往。然而君且无伉俪 之情，更何有父子之义？置儿君侧，君纵听之，而君所获之新爱人，宁能不视此为眼中钉，拔去之而后快耶？与其将来受人非种必锄之举，则不如秋保护之，延其一线之生命也。俟其长大，自当告以弃儿之身世，一日君或欲一睹此赘疣，当尚有机缘也。<br>​        行矣！ 燕西。<strong>生生世世，吾侪不必再晤</strong>。此信请为保留，即作为绝交之书，离婚之约。万一君之新夫人以前妻葛藤未断为嫌，则以此信视之可也。<br>​        行矣！燕西。君子绝交，不出恶声，秋虽非君子，既对君钟情于前，亦雅不欲于今日作无味之争论。然而临别赠言，有未能已者，语云：<strong>高明之家，鬼瞰其室，虎尾春冰，宜有以防其渐</strong>。以先翁位高德茂，继祖业而起来兹，本无可议。<strong>若至晚辈，则南朝金粉之香，冠盖京华之盛，未免兼取而并进，是非青年所以自处之道也</strong>。愿有则改之，无则加勉焉。<br>​        慈姑老大人，一年以来，抚秋如己出，实深感戴。寸恩未报，会当衔结于来生。此外妯娌姊妹，对秋亦多加爱护，而四姊八妹，一则古道热肠，肝胆相照，一则耳鬓厮磨，形影相惜。今虽飘泊风尘，而夜雨青灯，每一回忆，宁不感怀？故秋虽去，而寸心耿耿，犹不免神驰左右。顾人生百年，无不散之筵席，均毋以秋为念可也。蓬窗茅户，几榻生尘。伏案作书，恍如隔世。言为心声，泪随笔下。楮尽墨枯，难述所怀。专此奉达，并祝健康！ </p><p>​                                                                                      冷清秋谨启 </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Literature </category>
          
      </categories>
      
      
        <tags>
            
            <tag> book review </tag>
            
            <tag> novels </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>谈谈近况</title>
      <link href="2018/09/03/%E8%B0%88%E8%B0%88%E8%BF%91%E5%86%B5/"/>
      <url>2018/09/03/%E8%B0%88%E8%B0%88%E8%BF%91%E5%86%B5/</url>
      
        <content type="html"><![CDATA[<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>有三个月没有写过博客了……过去的三个月过得像在飞一样。</p><p>一月的时候，我在博客的首页这样理想地概括它的主题：<em>My life of code, math, and literature</em>. 按照这样的脉络，让我来回顾一下过去这三个月我都干了什么。</p><p>代码……五月初的时候我正式开始实验室和学校的奔波，但最初这样的奔波显得并没有什么意义。在五月的前几周我的任务是熟悉TensorFlow，在这之前我的代码完全是由NumPy写的，我甚至连Pandas都不是很熟悉。我找了一本Packt出的TensorFlow cookbook，照着学了几周，但我做的只是对着书上的例子进行演练，并没有实战场景，到八月我真的要用的时候，我发现我实际上并不记得什么东西。这样过了几周很快就到了考试周的跟前，我感觉人生充满了空虚。到临近期末的时候我没有去实验室了，只是一边准备期末，一边看了些<em>Network Embedding</em>方向的论文。直到暑假开始跟师兄搞项目，我才开始好好写代码。简而言之，过去三个月我几乎没有任何代码上的提高，也没有写什么代码。</p><p>数学的话，我过去三个月和数学相关的内容就只有……期末考了一门概率论与随机过程了。从大一开始心心念念要好好重学的线性代数，没有学；立志要打好的机器学习和深度学习的理论基础……也是不存在的。我可能早就不算是一个喜欢数学或者擅长数学的人了。</p><p>再说到文学。这三个月里我读了一两本书（是的，只有一两本），其中零零散散用了可能有一个多月，才把高中读了一半没有读完的《九州缥缈录》从头读了一遍，读书的场所是凌晨的床头，以及期末复习阶段的图书馆（非期末复习阶段的我并没有白天读小说的兴趣，也是奇了）。看完很有中二少年的激昂热血，心想考完期末我一定要好好写一篇书评，但经历长达一个月的复习+考试周之后，这种所谓热血也很及时地消退了，遂作罢。</p><p>这样看来，我过去的三个月似乎完全是被期末考试所支配，在我自己的兴趣所在几乎毫无作为，好像是非常糟糕的三个月？其实也不是。而且这三个月也并非我所要谈的“近况”。</p><h2 id="“近”况：过去这两年"><a href="#“近”况：过去这两年" class="headerlink" title="“近”况：过去这两年"></a>“近”况：过去这两年</h2><p>我所想谈的近况要从2016年说起。</p><p>从一般的认知来看，这无论如何也算不上“近”了。2016年的我是一个在高考里受尽折辱、对即将开始的大学生活充满怨念的新晋大学生，而现在我马上就要大三了。</p><p>但说来也奇怪，2016年在我的印象里仿佛就是“近”和“远”的一个分界：在这之前的生活都充满了距离感，而在这之后的每一天都恍如昨日。</p><p>2015年的我是怎么样的？要我回忆这一年我做了什么，我可能什么也说不上来。但我始终记得这样一个日子：是6月9日，当年高考结束的第一天。它给我的印象过于深刻，以至于现在提到2015年，我脑海里浮现的就是当天傍晚的夕阳。那个黄昏我走在学校孔子像前的台阶上，旁边的高三楼人去楼空，四下静谧。忽然一股电流击中我的大脑，让我在那一个瞬间意识到，只剩一年我的生活就将发生巨大的改变，而我还没有做好心理准备。</p><p>让人有些遗憾的是，尽管我提前一年就意识到了这件事，但除此之外，在那个年份，我并不经常思考自己的人生和未来。我的生活是一个以周为单位的循环，熬过乏味的课堂和让人恶心的考试，等待着体育课的足球和每周的西甲。我知道这样的循环总有一天会抵达边界，但对这个时刻我只有很模糊的感觉——因此当它最终到达的时候我是那么措手不及。</p><p>2016年以后的我经历了人生中最快的两年。从眼下回头看，我所经历的事情和变化都是当时那个站在分界点的我所难以想象的。那个我选择了计算机作为我的专业，但对计算机一无所知（虽然严格地说，现在我也不算懂得了什么）；对高考不满意，但究其根本只是因为一直以来自己的骄傲所在被打破，而非任何与未来规划相关的因素；想要在未来通过研究生来弥补高考的挫折——跟之前说的一样，还是为了所谓的<em>top-student pride</em>。所以这么说来，我在这两年里的进步其实是相当惊人的（虽然可能比起别人这些进步还是不值一哂）。</p><p>不过值得一提的是，2016年作为这样的分界点，只是因为这一年宣告了高中生活的结束；对我来说，严格意义上2017年才是真正的分界点。“高中生活结束”意味着我刚刚所提到的“循环“终于抵达了它的边界，开始执行新的语句。这点是真的，大学之后的人生再也不是循环了，你每天所面临的都是新的问题新的挑战，而非昨日的重复。但遗憾的是，2016年的我面对这些问题和挑战的方式是随波逐流，如前所说，我的想法和目标都来自一种毫无来由的自负，我其实还是没有思考过任何和未来相关的问题，因此这些想法和目标实际上都非常空洞。</p><p>不知幸也不幸，在2017年发生了一些事情，让我被迫开始思考自己的未来，这也是为什么我说2017年才是严格意义上的转折点。不过尽管这些事情对我个人的成长算是有所帮助，我仍然更希望它们从来没有发生过，毕竟它曾给我留下了非常糟糕的回忆。有多糟糕？我这么说吧，它们发生的时候我正迷恋林宥嘉的歌，每天都听个二三十遍的；但它们发生之后的一年里我都没有听过林宥嘉的任何歌曲，因为一听到我就会打一个哆嗦，想起那些难捱的日子。不提也罢。</p><p><img src="https://s1.ax1x.com/2018/09/03/Pz18KO.png" alt="pic"></p><p>这张图上就是我第一次思考未来的地方，沙河校区新食堂后面草地上的一块下水井盖。那是9月底的一天，北京的天气还很燥热，草地上到处都是烦人的蚊虫。但好处是周围都没有人，那个傍晚我在这里足足蹲了有半个小时，身上被咬了好几个包，终于想明白了一些事情。为了想得更深刻些，当天晚上我联系了一位学长，跟他一直聊到了次日凌晨，聊完之后我终于第一次感受到”灵台清明“是一种什么体验。</p><p>这一天对我来说实在是太重要了，以至于在搬离沙河校区的前夕，我还特意跑来这块下水井盖旁边拍照留念。我和朋友吹牛说，等我日后发达了，这块下水井盖上应该立一个我思考人生的雕像云云。（这当然纯粹是玩笑话，我立志发达以后要做一个低调的人的）</p><p>至于我思考了什么……眼下我并不想说。</p><p>这是一件说复杂也复杂，说简单也简单的事，最主要的原因是虽然从这时起一切都在往好的方向发展了，但是到目前为止，我尚未取得任何真正意义上的成果，如果在这时候讲接下来的故事，会显得有些可笑。从我的角度来看，这之后的一年我整个人发生了巨大的变化；但从旁人来看，可能也没什么大不了的。</p><p>打个比方，月薪3500的带明星在直播间里给你传授成功秘籍，你是会虚心学习，还是把他当傻子？我不想做傻子。（至于带明星是不是真的月薪3500，连一顿像样的饭都请不起……就得问他本人了）</p><p>不过我保证，总有一天我会写的，就更新在这篇博客下，deadline是2020年的4月15日。请再给我一年半时间。</p><h2 id="现在：2018年的夏天"><a href="#现在：2018年的夏天" class="headerlink" title="现在：2018年的夏天"></a>现在：2018年的夏天</h2><p>说完了过去两年，我们必须谈谈现在了。任何对过去的追缅，目的都是更好的审视当下。</p><p>我现在过得还蛮好的，虽然有时候也有糟心事。</p><p>在上个月我亲手结束了缠绕我一年之久的梦魇，那天晚上我请几个朋友吃了很贵但是味道很普通的烤肉，吃完回去的那个晚上，我看着自己支持的巴西被比利时残酷地淘汰，一个人坐在宿舍的椅子上发呆到天亮。</p><p>这个月我每天泡在实验室，写很简单但是死都调不出来的代码，它看似很有道理，但跑起来就是慢得离谱，现在我已经重写第三遍了，并且开始重学TensorFlow（参见我的另一篇博客），截止目前，我还没搞定这件事，但我甚至已经自暴自弃开始写博客了。</p><p>不过这是第一次我知道自己眼下做的事情是为了什么。所以我放弃了回家睡大床的机会，放弃了和高中球友们一起踢球的机会，放弃了旅游，放弃了妈妈的家常菜，留在北京，过日复一日孤独的生活（这不是矫情，现在我的宿舍就只剩我和另一个留校实习的朋友了相依为命了，真挺孤独的）。</p><p>当然了，有些夜晚，当我骑车穿过知春路，拐向漆黑的西土城路的时候，我也会怀疑这一切是否真的有意义，我所付出的是否会有回报。我知道自己真的不够聪明，不够会写代码，甚至意志力也不够顽强……也许根本不足以完成我想完成的事情，毕竟它那么难。——直到现在啊，我仍然会有迷惑的时候。</p><p>但谢天谢地，我在最艰难的时候喜欢上了一支名叫五月天的乐队（就在告别林宥嘉的同一时期）。在那段我永远不会忘记的采访里，陈信宏这样娓娓道来：</p><blockquote><p>记得那时候有一次骑到自强隧道，从那头开始，我就想，我就想说，再一直这样迷惑下去也不对，所以我决定，骑出这个自强隧道之前，我要把我的迷惑通通都结束掉。就是，我接下来的迷惑，只能有一个自强隧道那么长。</p></blockquote><p>——因此，我的迷惑也就只有半条西土城路那么长。</p><h2 id="未来：？"><a href="#未来：？" class="headerlink" title="未来：？"></a>未来：？</h2><p>你也许认得出这篇博客的缩略图是什么地方，但这并不代表这是我为自己计划的未来。对我来说，它更像是一个符号，一个图腾，具有某种精神上的属性，而非更实际的东西。当然，如果它真的能成为实际，我也绝对不会拒绝的（这简直是一句废话）。</p><p>我写这篇博客是为了回顾我人生的一个重要阶段，也希望这样的回顾能让我对现在和未来有更加清楚的把握。不过直到真正下笔我才知道这样的回顾有多难写，所以我现在只能把它写成这样不明不白的东西（哪怕这样我还是写到了凌晨两点），我希望在之后的日子里我会经常重读它，增添上我新的感受。</p><p>如果它能有我自己以外的读者，我不奢望我自己一团糟的生活能给别人带来任何启示，我只愿你们从这篇文章里看到的我，是一个积极向上、对自己的人生负责的人，因为这正是我一直以来力图做到的事情。</p><p>to be continued…</p><pre class=" language-shell"><code class="language-shell">- first commit on Jul 14th, 2018</code></pre>]]></content>
      
      
      <categories>
          
          <category> all </category>
          
      </categories>
      
      
        <tags>
            
            <tag> life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>时隔九月，更改博客外观配置</title>
      <link href="2018/09/02/%E6%97%B6%E9%9A%94%E4%B9%9D%E6%9C%88%EF%BC%8C%E6%9B%B4%E6%94%B9%E5%8D%9A%E5%AE%A2%E5%A4%96%E8%A7%82%E9%85%8D%E7%BD%AE/"/>
      <url>2018/09/02/%E6%97%B6%E9%9A%94%E4%B9%9D%E6%9C%88%EF%BC%8C%E6%9B%B4%E6%94%B9%E5%8D%9A%E5%AE%A2%E5%A4%96%E8%A7%82%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>自从今年一月我建立起这个博客，我再没对博客进行任何外观上的更改。但实际上，当时的很多配置我自己是不太满意的。首先，整个主题的色调过于花俏，与我个人对简洁的偏爱不符；另外，我彼时使用的material主题版本过低，很多功能不够完善。</p><p>明天就是开学日，想着开学之后我应该没有闲情来布置这些，因此我决定趁着最后一个放假日来做这样一件“毫无用处”的事情。</p><h2 id="主页"><a href="#主页" class="headerlink" title="主页"></a>主页</h2><p>这是过去九个月里我博客的外观：</p><p><img src="https://s1.ax1x.com/2018/09/03/Pzuzff.png" alt="prev"></p><p>客观地说，它并不难看（要不然我也没法忍受它九个月），但实在非常随意。背景这张毛玻璃效果的图片是主题内置提供的，漂亮归漂亮，但是很难说有多少个人同时在使用它作为背景；标题框和Logo框中图片的选择就更随便了，我本人是巴塞罗那足球俱乐部的忠实拥趸，因此在标题框中就选择了巴塞罗那的一张风景图，而右边的Logo则直接使用了巴塞罗那历史上最伟大的球员——莱昂内尔·梅西的个人Logo，甚至你点击这个Logo网站还会自动跳转到梅西官网（这是多么无聊的设计）；至于颜色的选择我更是分毫未改地沿用了默认值，因为搭建博客时正值期末，我实在没空去干选颜色这么费时费力的事情。</p><p>现在我对它的更改，如上所述，主要是使它看起来更简洁。我觉得只有简洁的东西才不会使人轻易看腻。首先我把背景换成了纯色（<code>#F5F5F5</code>)，并且把主题的色调换成了灰色（主：<code>#3B4247</code> 次：<code>#959FA6</code>）。然后我更换了那两张选择得非常随意的图片，用一种另外的随意方式。右侧这个我的个人Logo，事实上是我在一个免费生成Logo的网站画5分钟做的，虽然免费，但我还挺满意的；至于左侧这张图……可能比之前还要随意吧，这是我Google “Minimalism”搜出来的一张图片，万幸还挺合适。下面是现在的效果图：</p><p><img src="https://s1.ax1x.com/2018/09/04/iSHrH1.png" alt="current"></p><p>你可能还会注意到一些区别：</p><ul><li>在上一张图片里，我的名字是<strong><em>“Waiyin Wong”</em></strong>，而在这张里变成了<strong><em>“Weiran Huang”</em></strong>。需要指出的是，<strong><em>“Waiyin Wong”</em></strong>是我名字的粤语拼音（我先前以为它是威妥玛拼音，但并不是），而后者才是我姓名的标准汉语拼音。粤语拼音很有趣，但我本人并不说粤语，而且无论是我的网站名还是我的邮箱都使用的是汉语拼音，因此这里做一个统一。</li><li>网站标题的 <strong><em>“My trantor”</em></strong> 变成了 <strong><em>“My Trantor”</em></strong>。<strong><em>Trantor</em></strong>是我非常喜欢的科幻小说《基地》系列中银河帝国的首都星球的名字（中文译名川陀），我给我的网站起名<strong><em>“My Trantor”</em></strong>也是希望这个博客能作为我精神世界的一颗”首都星“，记录我的经历和见识。毫无疑问，作为地名，<strong><em>Trantor</em></strong> 当然应该大写，之前没有纯粹是我的失误。</li><li>网站副标题 <em>“My life of…”</em> 改为首字母大写，不必多提。</li><li>我对Sidebar做了部分调整：更换了标题图，增加了Number of Articles一栏。</li><li>在首页的footer位置（如下），我去掉了不常用的SNS——Google+，增加了Instagram和GitHub。在Copyright下增加了一句《圣经》中的引文：<em>“Act justly, love mercy, walk humbly”</em>。</li></ul><p><img src="https://s1.ax1x.com/2018/09/03/PzKehV.png" alt="footer"></p><p>其实大多数改动都非常细微，如果不特别记录一下可能我自己也忘了。这也是我写这篇看起来毫无意义的博客的目的：看看自己以前对博客做过什么，也挺有趣的。</p><h2 id="评论系统"><a href="#评论系统" class="headerlink" title="评论系统"></a>评论系统</h2><p>另一个比较大的改变是我更换了评论系统。显然，我的博客流量是微乎其微的，并不太会有人看，甚至评论。而当我使用Disqus这一在国内被墙了的评论系统时，这样的概率就更低了。作为一个写作者，总是会希望有读者能够和你互动的，哪怕读者不存在，我们也应该给他们的出现创造条件。因此我换用了Livere（来必力）作为我的评论系统，这次不会被墙啦。</p><p>最后弱弱说一句，仅从外观来说，我更喜欢Disqus。</p><p><strong>UPDATE ON OCT 9TH</strong>: 我再次将评论系统更换为了Valine。这个评论系统支持<strong>Markdown</strong>。</p><p><strong>UPDATE ON OCT 14TH</strong>: 经过多次更换，我又把评论系统换回了Disqus……我必须认清一个事实，那就是我写的东西纯是自娱自乐所用，并没有人会和我互动，所以用哪个评论系统其实都无所谓；但其他评论系统实在太糟糕了，Gitment和Gittalk在移动端的体验不好，Valine的邮件通知功能又不完善。换来换去，Disqus还是最好用的一个，除去它被墙了这一个事实，但反正没人评论，那用哪个都一样了。</p><h2 id="许可证"><a href="#许可证" class="headerlink" title="许可证"></a>许可证</h2><p>我为我的每篇博客增加了一份<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank" rel="noopener">CC BY-SA 3.0协议文本</a>许可证声明。这意味着，对我的所有文章：</p><blockquote><h3 id="您可以自由地"><a href="#您可以自由地" class="headerlink" title="您可以自由地:"></a>您可以自由地:</h3><ul><li><strong>共享</strong> — 在任何媒介以任何形式复制、发行本作品</li><li><strong>演绎</strong> — 修改、转换或以本作品为基础进行创作</li></ul><h3 id="惟须遵守下列条件："><a href="#惟须遵守下列条件：" class="headerlink" title="惟须遵守下列条件："></a>惟须遵守下列条件：</h3><ul><li><strong>署名</strong> — 您必须给出<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh#" target="_blank" rel="noopener">适当的署名</a>，提供指向本许可协议的链接，同时<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh#" target="_blank" rel="noopener">标明是否（对原始作品）作了修改</a>。您可以用任何合理的方式来署名，但是不得以任何方式暗示许可人为您或您的使用背书。</li><li><strong>非商业性使用</strong> — 您不得将本作品用于<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh#" target="_blank" rel="noopener">商业目的</a>。</li><li><p><strong>相同方式共享</strong> — 如果您再混合、转换或者基于本作品进行创作，您必须基于<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh#" target="_blank" rel="noopener">与原先许可协议相同的许可协议</a> 分发您贡献的作品。</p></li><li><p><strong>没有附加限制</strong> — 您不得适用法律术语或者 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh#" target="_blank" rel="noopener">技术措施</a> 从而限制其他人做许可协议允许的事情。</p></li></ul></blockquote><p>具体条文请参考链接。</p><h2 id="代码高亮"><a href="#代码高亮" class="headerlink" title="代码高亮"></a>代码高亮</h2><p>之前我使用的代码高亮插件是<code>hexo-prism-plugin</code>。但这款插件的很多主题和material兼容性很差，最后使用效果非常糟糕，我几乎把所有主题都尝试了一遍，才选定<code>ghcolor</code>这一款主题。因此这次我本希望使用Prettify来做代码高亮。事实上我几乎已经做完了这件事，让文章中的代码块从：</p><p><img src="https://s1.ax1x.com/2018/09/03/PzKlnJ.png" alt="cbp"></p><p>变成了：</p><p><img src="https://s1.ax1x.com/2018/09/03/PzKJtx.png" alt="cbc"></p><p>不得不说Prettify的代码高亮还是挺好看的。但使用之后我才发现，相较Prism它有一个很严重的问题，那就是在移动端阅读时，如果一行代码无法显示完全，代码块是无法横向拖动的。这造成了移动端阅读体验不佳的问题，因此我最后还是换回了之前的样子。这是一个遗憾了。</p><h2 id="CDN加速"><a href="#CDN加速" class="headerlink" title="CDN加速"></a>CDN加速</h2><p>material的新版本是提供CDN加速的，你可以直接在配置文件中做到这件事。</p><p>你可以把博客的静态页面放在私人CDN上，也可以使用几个第三方库的CDN，包括：</p><pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># Files Vendors</span><span class="token comment" spellcheck="true"># Set a CDN for the files src you want to customize. The url should with protocol.</span><span class="token comment" spellcheck="true"># Default(empty) will load the files from the origin server.</span><span class="token key atrule">vendors</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true"># MaterialCDN</span><span class="token comment" spellcheck="true">#   You can load theme unique files from your private cdn or oss.</span><span class="token comment" spellcheck="true">#   The new src will have the base domain you configured below.</span><span class="token comment" spellcheck="true">#   For example</span><span class="token comment" spellcheck="true">#       materialcdn: https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source</span>    <span class="token key atrule">materialcdn</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true"># Third party library</span><span class="token comment" spellcheck="true">#   You can load these files from public cdn.</span><span class="token comment" spellcheck="true">#   For example</span><span class="token comment" spellcheck="true">#       jquery: https://cdn.bootcss.com/jquery/2.2.1/jquery.js</span>    <span class="token comment" spellcheck="true"># jQuery 2.2.0</span>    <span class="token key atrule">jquery</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cdn.bootcss.com/jquery/2.2.1/jquery.js    <span class="token comment" spellcheck="true"># nprogress 0.2.0</span>    <span class="token key atrule">nprogress</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># FontAwesome 4.5.0</span>    <span class="token key atrule">fontawesome</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cdn.bootcss.com/font<span class="token punctuation">-</span>awesome/4.5.0/css/font<span class="token punctuation">-</span>awesome.min.css    <span class="token comment" spellcheck="true"># MathJax 2.7.0-2.7.1</span>    <span class="token key atrule">mathjax</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cdn.bootcss.com/mathjax/2.7.1/latest.js    <span class="token comment" spellcheck="true"># Prettify r298 (only prettify.js)</span>    <span class="token key atrule">prettify</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cdn.bootcss.com/prettify/r298/prettify.js    <span class="token comment" spellcheck="true"># Material Icons 3.0.1</span>    <span class="token key atrule">material_icons</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//cdn.bootcss.com/material<span class="token punctuation">-</span>design<span class="token punctuation">-</span>icons/3.0.1/iconfont/material<span class="token punctuation">-</span>icons.min.css</code></pre><p>这里的<code>mathjax</code>是很值得一提的。Hexo的Markdown不支持数学公式，因此之前每次当博客里需要使用MathJax的时候，我都不得不在文章开头放上这么长一串来加载它：</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/x-mathjax-config<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">MathJax<span class="token punctuation">.</span>Hub<span class="token punctuation">.</span><span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>tex2jax<span class="token punctuation">:</span> <span class="token punctuation">{</span>inlineMath<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'$'</span><span class="token punctuation">,</span><span class="token string">'$'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'\\('</span><span class="token punctuation">,</span><span class="token string">'\\)'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">async</span>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.mathjax.org/mathjax/latest/MathJax.js?config<span class="token punctuation">=</span>TeX-MML-AM_CHTML<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>而现在使用了它的CDN，我可以直接在标题框中enable MathJax, 只需增加一行：<code>mathjax: true</code>即可。</p><p>P.S.：但Hexo还有一个地方非常烦人，它会将MathJax中的<code>\</code>和<code>_</code>当作Markdown中的转义字符，导致你的公式显示失败；这时候除了去修改内置转义规则之外，只能通过强制禁止渲染来解决了。</p><h2 id="使用TiddlyWiki"><a href="#使用TiddlyWiki" class="headerlink" title="使用TiddlyWiki"></a>使用TiddlyWiki</h2><blockquote><p>Added on <em>Nov 21st</em>.</p></blockquote><p>TiddlyWiki是一款非常有趣的笔记软件，它仅有一个html页面，但你可以用它做几乎任何事。我目前用它来做一些细碎的记录以及学校课程的笔记，目前你已经可以通过博客Sidebar的wiki打开它。</p><p>想要了解TiddlyWiki，请访问它的<a href="https://tiddlywiki.com/" target="_blank" rel="noopener">官方网站</a>。但我觉得这个官网的教程似乎不太user-friendly（也许是我的问题），在我初次接触的时候，是通过youtube上<a href="https://www.youtube.com/watch?v=ZMGpAW0z_Bo&amp;list=PLzZCajspPU_UjFn0uy-J9URz0LP4zhxRK" target="_blank" rel="noopener">这个</a>系列视频来学习的。当然看完之后你最好还是回到官网继续深入使用，看视频只是为了减缓你的learning curve。</p><p>我现在使用的主题是material风格的，与我当下博客使用的主题很契合。</p><p>另外提一下如何在hexo中加入html页面……因为hexo是会默认渲染source文件夹中的文件的，也就是说它只默认处理md文件。所以你需要在<code>_config.yml</code>中找到<code>skip_render</code>一项来阻止它渲染html文件。这个操作可以参见<a href="http://omimo.me/2017/04/16/customized%20page/" target="_blank" rel="noopener">这里</a>。</p><h2 id="增加在线和可供下载的简历"><a href="#增加在线和可供下载的简历" class="headerlink" title="增加在线和可供下载的简历"></a>增加在线和可供下载的简历</h2><blockquote><p>Added on <em>Nov 21st</em></p></blockquote><p>这两项的查看和下载链接我放在了About页面里（你可以通过Sidebar打开它）。Online-CV早几个月就弄了，不过里面内容一直没去好好整（现在也还没整，有一半是模板内容，主要原因是实在没什么经历和技能可写……）。</p><p>PDF版本是上周申请暑研的时候临时拿一个模板改的。原模板没有Course Projects这一项，我强行加的，虽然知道加了也没什么用，但不写我的简历就真的……很空。希望明年这时候申请可以有更多东西可以写，让我去掉这些傻透了的Course Projects吧 :)。</p><h2 id="全站https"><a href="#全站https" class="headerlink" title="全站https"></a>全站https</h2><p>几个月前GitHub宣布对GitHub Pages的自定义域名提供https服务，这需要修改域名解析的A record，然后在博客的repo里选择enforce https。但是由于我博客之前的图片都是托管在作业部落上，它并没有https。因此我花费了相当长的时间把博客里所有的图片都移动到提供https的图床里了。因此现在我的博客是一个非常安全的地方了。</p><p>大概就是这些了，其他一些修改拼写错误的URL就不细说了。总之，这一波操作又成功夺走了我在实验室的一个悠长下午，但说真的还挺有意思的。这样看来，设计行业的工作（或者前端）好像还蛮有趣味性的？</p>]]></content>
      
      
      <categories>
          
          <category> tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CS 224N: Assignment #1</title>
      <link href="2018/08/30/CS-224N-Assignment-1/"/>
      <url>2018/08/30/CS-224N-Assignment-1/</url>
      
        <content type="html"><![CDATA[<h2 id="Word2vec-Summary"><a href="#Word2vec-Summary" class="headerlink" title="Word2vec Summary"></a>Word2vec Summary</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><ol><li><p>One-hot没有在表达中体现词的相似度，并且空间浪费。</p></li><li><p>SVD-based的方法是先构造cooccurrence矩阵（这个共同出现可能会被限制在某个window范围内），然后对矩阵使用SVD分解，取前k个奇异值得到矩阵 $U$ 就得到每个词的k维表达。但这种做法弊端明显：</p><ul><li><p>新词的出现和语料的改变会造成矩阵尺寸频繁变化。</p></li><li><p>矩阵非常稀疏，并且维度通常很大。</p></li><li><p>SVD分解有平方级的开销，而我们刚刚说矩阵的维度很大，因此这个开销会很恼人。</p></li><li><p>需要对不同词语出现频率悬殊做额外处理。</p></li></ul><p>有一些针对的解决办法，但不够好。</p></li></ol><h3 id="Word2vec：iteration-based"><a href="#Word2vec：iteration-based" class="headerlink" title="Word2vec：iteration based"></a>Word2vec：iteration based</h3><p>word2vec的参数就是词向量矩阵本身，它通过迭代的方式训练。它包括两种算法：连续词袋模型（CBOW）和skip-gram。前者通过上下文预测中心词，后者反之。训练方法也有两种：负采样和层次softmax。</p><h3 id="CBOW"><a href="#CBOW" class="headerlink" title="CBOW"></a>CBOW</h3><p>$U$ 为输出矩阵，在这里即中心词的embedding矩阵；$V$ 为输入矩阵，在这里是上下文词语的embedding矩阵。</p><p>算法流程如下：</p><ol><li>取窗口内（窗口大小为m）的词语的one-hot vector。</li><li>对其在矩阵 $V$ 中做embedding lookup操作（其实就是每个vector乘上这个矩阵），得到2m个词向量。</li><li>直接对这2m个向量取平均。（这也是为什么它被称作连续词袋模型，它仍然不考虑这些词语的顺序，像把词向量的每个维度当成了袋子一样收集每个词提供的信息。）</li><li>把这个向量与 $U$ 相乘，实际上就是和每个中心词做了内积，然后对得到的向量做softmax，就是我们得到的概率值。</li></ol><p>loss function为这个概率和实际结果（其实是一个one-hot vector，可以认为它在正确结果处概率为1）的交叉熵。交叉熵是信息论中的概念，可以用来刻画两个分布的不同。由于真实分布只在一个点处有取值，且是1，<strong>其实这个交叉熵就是输出概率值在正确类对应的index上的熵</strong>。</p><p>故我们的优化目标是：</p>$$\begin{aligned} \text { minimize } J &=-\log P\left(w_{c} | w_{c-m}, \ldots, w_{c-1}, w_{c+1}, \ldots, w_{c+m}\right) \\ &=-\log P\left(u_{c} | \hat{v}\right) \\ &=-\log \frac{\exp \left(u_{c}^{T} \hat{v}\right)}{\sum_{j=1}^{|V|} \exp \left(u_{j}^{T} \hat{v}\right)} \\ &=-u_{c}^{T} \hat{v}+\log \sum_{j=1}^{|V|} \exp \left(u_{j}^{T} \hat{v}\right) \end{aligned}$$<p>接下来的工作交给SGD。</p><h3 id="Skip-gram"><a href="#Skip-gram" class="headerlink" title="Skip-gram"></a>Skip-gram</h3><p>$U,V$ 仍然分别代表输出和输入矩阵，只是他们代表的词语位置和刚才相反。</p><p>算法流程和上面基本类似，这里简单描述：</p><ol><li>用中心词的one-hot vector获取其embedding。</li><li>与output matrix相乘，再做softmax。</li><li>用得到的概率向量和真实输出（就是一个只有窗口范围内是1，其余都是0的向量）做交叉熵，作为loss。</li></ol>$$\begin{aligned} \text { minimize } J &=-\log P\left(w_{c-m}, \ldots, w_{c-1}, w_{c+1}, \ldots, w_{c+m} | w_{c}\right) \\ &=-\log \prod_{j=0, j \neq m}^{2 m} P\left(w_{c-m+j} | w_{c}\right) \\ &=-\log \prod_{j=0, j \neq m}^{2 m} P\left(u_{c-m+j} | v_{c}\right) \\ &=-\log \prod_{j=0, j \neq m}^{2 m} \frac{\exp \left(u_{c-m+j}^{T} v_{c}\right)}{\sum_{k=1}^{|V|} \exp \left(u_{k}^{T} v_{c}\right)} \\ &=-\sum_{j=0, j \neq m}^{2 m} u_{c-m+j}^{T} v_{c}+2 m \log \sum_{k=1}^{|V|} \exp \left(u_{k}^{T} v_{c}\right) \end{aligned}$$<h3 id="Negative-Sampling"><a href="#Negative-Sampling" class="headerlink" title="Negative Sampling"></a>Negative Sampling</h3><p>注意到上面的算法中softmax开销非常大。为了缩小这个开销我们可以考虑不直接求，而是取近似。</p><p>直觉上，我们softmax的目标是让窗口内的上下文词语输出大，而让其他词语输出小。把窗口内的词语当作正样本，其他词语当作负样本，如果我们进行负采样的话，在目标函数中同时令前者产生的概率大，后者产生的概率小，就近似达到目标效果了。</p><p>这里我们把刻画一个样本的概率函数换为sigmoid，采用最大似然的方法设计loss function，能得到如下式子：</p>$$J=-\sum_{(w, c) \in D} \log \frac{1}{1+\exp \left(-u_{w}^{T} v_{c}\right)}-\sum_{(w, c) \in D} \log \left(\frac{1}{1+\exp \left(u_{w}^{T} v_{c}\right)}\right)$$<p>具体地，对于skip-gram，在上下文词语 $c-m+j$ 上的目标函数是：</p>$$-\log \sigma\left(u_{c-m+j}^{T} \cdot v_{c}\right)-\sum_{k=1}^{K} \log \sigma\left(-\tilde{u}_{k}^{T} \cdot v_{c}\right)$$<p>CBOW类似。</p><p>K个负样本是从某种分布中抽取的。经验上来说这个分布使用$\dfrac{3}{4}$次方的unigram模型是最好的。选取$\dfrac{3}{4}$的原因简单来说就是对于接近1的数，它的值基本维持，但对于很小的数，它的值会变大，能使它更容易被采样到。对于像”is”（0.9）这样的词语，在这样的情况下变化就很小，而像“bombastic”（0.01）则能获得3倍于之前的采样概率。</p><h3 id="Hierarchical-Softmax"><a href="#Hierarchical-Softmax" class="headerlink" title="Hierarchical Softmax"></a>Hierarchical Softmax</h3><p>通过构造一棵二叉树的办法来使得每次获得某一个词的概率时不用遍历整个词典。这棵树上叶子节点表示一个词，除了根节点和叶子节点，每一个中间节点都有一个自己的embedding。在给定一个vector的情况下，要求概率需要遍历从根节点到该词所对应的叶子节点的路径，累乘到达每个中间节点的概率。这个概率用sigmoid表示，且每条路径上下一步如果选择左子节点，概率为P(X=1)的情况，右子节点则为P(X=0)的情况，这样实际上也是一种normalization，保证概率之和为1。</p><p>这个方法的速度取决于树是如何构造的。在Mikolov的论文中他们使用的树是哈夫曼树，这种树的特点是会给出现频率高的叶子节点更短的路径。</p><p>接下来是作业的部分。经过对比，我认为2019以前的第一次作业要比2019的这个作业有趣一些，因此我选择了旧版本的第一个编程作业来完成。</p><h2 id="1-Softmax"><a href="#1-Softmax" class="headerlink" title="1. Softmax"></a>1. Softmax</h2><blockquote><p> (a) Prove that softmax is invariant to constant offsets in the input, that is, for any input vector $\bf{x}$ and any constant $c$<br>$$<br>\mathbf{softmax}(\mathbf{x}) = \mathbf{softmax}(\mathbf{x} + c)<br>$$<br>where $ \bf{x} + c$ means adding the constant $c$ to every dimension of $\bf{x}$. Remember that  $$\mathbf{softmax}(\mathbf{x})_i = \dfrac{e^{x_i}}{\sum_j e^{x_j}}$$</p></blockquote><p>这个证明是显然的，我们只需要在softmax的分子分母中同时乘上 $e^c$这一项即可。但这个性质在我们实现softmax的时候非常重要。</p><p>考虑这样的情形，你需要对 $\mathbf{x} = [1001, 1002]$ 做softmax运算，但 $e^{1001}$ 毫无疑问是溢出的。但对于softmax而言，$[1001, 1002]$ 和 $[1,2]$ 又有什么区别呢？因此实际实现的时候，我们通常取 $c = - \mathbf{max}\space x_i$  以保证数值上的稳定。</p><blockquote><p>(b) Given an input matrix of N rows and D columns, compute the softmax prediction for each row using the optimization in part (a). Write your implementation in <code>q1_softmax.py</code>. You may test by executing python <code>q1_softmax.py</code>.</p></blockquote><p>代码如下：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">softmax</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Compute the softmax function for each row of the input x.    You should also make sure that your code works for a single    D-dimensional vector (treat the vector as a single row) and    for N x D matrices. This may be useful for testing later. Also,    make sure that the dimensions of the output match the input.    Arguments:    x -- A D dimensional vector or N x D dimensional numpy matrix.    Return:    x -- You are allowed to modify x in-place    """</span>    orig_shape <span class="token operator">=</span> x<span class="token punctuation">.</span>shape    <span class="token keyword">if</span> len<span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># Matrix</span>        <span class="token comment" spellcheck="true"># scale down</span>        x_max <span class="token operator">=</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        x <span class="token operator">-=</span> x_max        <span class="token comment" spellcheck="true"># softmax process</span>        x <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        exp_sum <span class="token operator">=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>        x <span class="token operator">/=</span> exp_sum    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># Vector</span>        <span class="token comment" spellcheck="true"># scale down</span>        x_max <span class="token operator">=</span> np<span class="token punctuation">.</span>max<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        x <span class="token operator">-=</span> x_max        <span class="token comment" spellcheck="true"># softmax process</span>        x <span class="token operator">=</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        x <span class="token operator">/=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token keyword">assert</span> x<span class="token punctuation">.</span>shape <span class="token operator">==</span> orig_shape    <span class="token keyword">return</span> x</code></pre><h2 id="2-Neural-Network-Basics"><a href="#2-Neural-Network-Basics" class="headerlink" title="2. Neural Network Basics"></a>2. Neural Network Basics</h2><blockquote><p>(a) Derive the gradients of the sigmoid function and show that it can be rewritten as a function of the function value (i.e., in some expression where only $\sigma(x)$, but not $x$, is present). Assume that the input $x$ is a scalar for this question. Recall, the sigmoid function is $\sigma(x) = \dfrac{1} {1 + e^{−x}}$ .</p></blockquote><p>这个推导非常简单：$(\sigma(x))’ = \sigma(x)(1 - \sigma(x))$。</p><blockquote><p>(b) ) Derive the gradient with regard to the inputs of a softmax function when <strong>cross entropy loss</strong> is used for evaluation, i.e., find the gradients with respect to the softmax input vector $\theta$, when the prediction is made by $\hat{y} = \mathbf{softmax}(\theta)$. Remember the cross entropy function is<br>$$<br>\mathbf{CE}(\mathbf{y}, \mathbf{\hat{y}}) = -\sum_i y_i\log \hat{y}_i<br>$$<br> where $\mathbf{y}$ is the one-hot label vector, and $\mathbf{\hat{y}}$ is the predicted probability vector for all classes.</p></blockquote><p>我们知道 $\mathbf{y}$ 是一个one-hot label vector，这就是说它只有一项是 $1$ , 其余项均为  $0$ 。设 $\mathbf{y}$ 的第 $i$ 项为 $1$.</p><p>对第 $i$ 项： $\dfrac{\partial{\mathbf{CE}}}{\partial{\theta_i}} = \dfrac{\partial{\mathbf{CE}}}{\partial{\hat{y_i}}} \dfrac{\partial{\hat{y_i}}}{\partial{\theta_i}} = -\dfrac{1}{\hat{y_i}}\dfrac{\partial \space\mathbf{softmax}(\theta)_i} {\partial \theta_i}$</p><p> 而 $\dfrac{\partial \space\mathbf{softmax}(\theta)_i} {\partial \theta_i}  =  \dfrac{e^{\theta_i}(\sum_j e^{\theta_j}) - e^{\theta_i}e^{\theta_i}}{(\sum_j e^{\theta_j})^2}= \mathbf{softmax}(\theta)_i(1 - \mathbf{softmax}(\theta)_i) = \hat{y_i}(1-\hat{y_i})$</p><p>故 $\dfrac{\partial{\mathbf{CE}}}{\partial{\theta}_i} = \hat{y_i} - 1$</p><p>对第 $j \not = i$ 项： $\dfrac{\partial{\mathbf{CE}}}{\partial{\theta_j}} = \dfrac{\partial{\mathbf{CE}}}{\partial{\hat{y_i}}} \dfrac{\partial{\hat{y_i}}}{\partial{\theta_j}} = -\dfrac{1}{\hat{y_i}}\dfrac{\partial \space\mathbf{softmax}(\theta)_i} {\partial \theta_j}$</p><p>而 $\dfrac{\partial \space\mathbf{softmax}(\theta)_i} {\partial \theta_j} = \dfrac{0(\sum_j e^{x_j}) - e^{x_j}e^{x_i}}{(\sum_j e^{x_j})^2} = -\hat{y_i}\hat{y_j}$</p><p>故 $\dfrac{\partial{\mathbf{CE}}}{\partial{\theta}_j} = \hat{y_j} = \hat{y_j} - 0$</p><p>可以看出两种情况可以综合为 $\hat{y_i} - y_i$ 的形式，则<br>$$<br>\dfrac{\partial{\mathbf{CE}}}{\partial{\theta}} = \hat{y} - y<br>$$</p><blockquote><p>(c) Derive the gradients with respect to the inputs x to an one-hidden-layer neural network (that is, find $\dfrac{\partial{J}}{\partial{x}}$ where $J = \mathbf{CE}(y, \hat{y})$ is the cost function for the neural network). The neural network employs sigmoid activation function for the hidden layer, and softmax for the output layer. Assume the one-hot label vector is y, and cross entropy cost is used. (Feel free to use $\sigma ‘ (x)$ as the shorthand for sigmoid gradient, and feel free to define any variables whenever you see fit.) </p></blockquote>根据题意，我们有这样一个两层神经网络：$$\boldsymbol{h}=\operatorname{sigmoid}\left(\boldsymbol{x} \boldsymbol{W}_{1}+\boldsymbol{b}_{1}\right) \quad \hat{\boldsymbol{y}}=\operatorname{softmax}\left(\boldsymbol{h} \boldsymbol{W}_{2}+\boldsymbol{b}_{2}\right)$$记 $z_{1} = \boldsymbol{xW}_{1} + \boldsymbol{b}_{1}$ ， $z_{2} = \boldsymbol{hW}_{2} + \boldsymbol{b}_{2}$；$$\begin{aligned} \boldsymbol{\delta}_{1} &=\frac{\partial C E}{\partial z_{2}}=\hat{\boldsymbol{y}}-\boldsymbol{y} \\ \boldsymbol{\delta}_{2} &=\frac{\partial C E}{\partial \boldsymbol{h}}=\boldsymbol{\delta}_{1} \frac{\partial \boldsymbol{z}_{2}}{\partial \boldsymbol{h}}=\boldsymbol{\delta}_{1} \boldsymbol{W}_{2}^{\top} \\ \boldsymbol{\delta}_{3} &=\frac{\partial C E}{\boldsymbol{z}_{1}}=\boldsymbol{\delta}_{2} \frac{\partial \boldsymbol{h}}{\partial \boldsymbol{z}_{1}}=\boldsymbol{\delta}_{2} \circ \sigma^{\prime}\left(\boldsymbol{z}_{1}\right) \\ \frac{\partial C E}{\partial \boldsymbol{x}} &=\boldsymbol{\delta}_{3} \frac{\partial \boldsymbol{z}_{1}}{\partial \boldsymbol{x}}=\boldsymbol{\delta}_{3} \boldsymbol{W}_{1}^{\top} \end{aligned}$$<p>这个神经网络有 $ (D_x + 1) \cdot H + (H + 1) \cdot D_y$个参数。</p><p>接下来是完成这个网络的代码。先完成<code>gradient_check</code>的部分：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># First implement a gradient checker by filling in the following functions</span><span class="token keyword">def</span> <span class="token function">gradcheck_naive</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">""" Gradient check for a function f.    Arguments:    f -- a function that takes a single argument and outputs the         cost and its gradients    x -- the point (numpy array) to check the gradient at    """</span>    rndstate <span class="token operator">=</span> random<span class="token punctuation">.</span>getstate<span class="token punctuation">(</span><span class="token punctuation">)</span>    random<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span>rndstate<span class="token punctuation">)</span>    fx<span class="token punctuation">,</span> grad <span class="token operator">=</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Evaluate function value at original point</span>    h <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span>        <span class="token comment" spellcheck="true"># Do not change this!</span>    <span class="token comment" spellcheck="true"># Iterate over all indexes ix in x to check the gradient.</span>    it <span class="token operator">=</span> np<span class="token punctuation">.</span>nditer<span class="token punctuation">(</span>x<span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'multi_index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> op_flags<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'readwrite'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token operator">not</span> it<span class="token punctuation">.</span>finished<span class="token punctuation">:</span>        ix <span class="token operator">=</span> it<span class="token punctuation">.</span>multi_index        x<span class="token punctuation">[</span>ix<span class="token punctuation">]</span> <span class="token operator">+=</span> h        fx_forward<span class="token punctuation">,</span> _ <span class="token operator">=</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        x<span class="token punctuation">[</span>ix<span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">2</span><span class="token operator">*</span>h        fx_backward<span class="token punctuation">,</span> _ <span class="token operator">=</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        x<span class="token punctuation">[</span>ix<span class="token punctuation">]</span> <span class="token operator">+=</span> h        numgrad <span class="token operator">=</span> <span class="token punctuation">(</span>fx_forward <span class="token operator">-</span> fx_backward<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> h<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Compare gradients</span>        reldiff <span class="token operator">=</span> abs<span class="token punctuation">(</span>numgrad <span class="token operator">-</span> grad<span class="token punctuation">[</span>ix<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> max<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> abs<span class="token punctuation">(</span>numgrad<span class="token punctuation">)</span><span class="token punctuation">,</span> abs<span class="token punctuation">(</span>grad<span class="token punctuation">[</span>ix<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> reldiff <span class="token operator">></span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span>            <span class="token keyword">print</span> <span class="token string">"Gradient check failed."</span>            <span class="token keyword">print</span> <span class="token string">"First gradient error found at index %s"</span> <span class="token operator">%</span> str<span class="token punctuation">(</span>ix<span class="token punctuation">)</span>            <span class="token keyword">print</span> <span class="token string">"Your gradient: %f \t Numerical gradient: %f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>                grad<span class="token punctuation">[</span>ix<span class="token punctuation">]</span><span class="token punctuation">,</span> numgrad<span class="token punctuation">)</span>            <span class="token keyword">return</span>        it<span class="token punctuation">.</span>iternext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Step to next dimension</span>    <span class="token keyword">print</span> <span class="token string">"Gradient check passed!"</span></code></pre><p>然后完成这个二层MLP的的函数：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward_backward_prop</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> labels<span class="token punctuation">,</span> params<span class="token punctuation">,</span> dimensions<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Forward and backward propagation for a two-layer sigmoidal network    Compute the forward propagation and for the cross entropy cost,    the backward propagation for the gradients for all parameters.    Notice the gradients computed here are different from the gradients in    the assignment sheet: they are w.r.t. weights, not inputs.    Arguments:    X -- M x Dx matrix, where each row is a training example x.    labels -- M x Dy matrix, where each row is a one-hot vector.    params -- Model parameters, these are unpacked for you.    dimensions -- A tuple of input dimension, number of hidden units                  and output dimension    """</span>    <span class="token comment" spellcheck="true"># Unpack network parameters</span>    ofs <span class="token operator">=</span> <span class="token number">0</span>    Dx<span class="token punctuation">,</span> H<span class="token punctuation">,</span> Dy <span class="token operator">=</span> <span class="token punctuation">(</span>dimensions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    W1 <span class="token operator">=</span> np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>params<span class="token punctuation">[</span>ofs<span class="token punctuation">:</span>ofs<span class="token operator">+</span> Dx <span class="token operator">*</span> H<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Dx<span class="token punctuation">,</span> H<span class="token punctuation">)</span><span class="token punctuation">)</span>    ofs <span class="token operator">+=</span> Dx <span class="token operator">*</span> H    b1 <span class="token operator">=</span> np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>params<span class="token punctuation">[</span>ofs<span class="token punctuation">:</span>ofs <span class="token operator">+</span> H<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> H<span class="token punctuation">)</span><span class="token punctuation">)</span>    ofs <span class="token operator">+=</span> H    W2 <span class="token operator">=</span> np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>params<span class="token punctuation">[</span>ofs<span class="token punctuation">:</span>ofs <span class="token operator">+</span> H <span class="token operator">*</span> Dy<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>H<span class="token punctuation">,</span> Dy<span class="token punctuation">)</span><span class="token punctuation">)</span>    ofs <span class="token operator">+=</span> H <span class="token operator">*</span> Dy    b2 <span class="token operator">=</span> np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>params<span class="token punctuation">[</span>ofs<span class="token punctuation">:</span>ofs <span class="token operator">+</span> Dy<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Dy<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># Note: compute cost based on `sum` not `mean`.</span>    <span class="token comment" spellcheck="true"># forward propagation</span>    h <span class="token operator">=</span> sigmoid<span class="token punctuation">(</span>X<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>W1<span class="token punctuation">)</span> <span class="token operator">+</span> b1<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># N x H</span>    yhat <span class="token operator">=</span> softmax<span class="token punctuation">(</span>h<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>W2<span class="token punctuation">)</span> <span class="token operator">+</span> b2<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># N x Dy</span>    cost <span class="token operator">=</span> <span class="token operator">-</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>yhat<span class="token punctuation">[</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># backward propagation</span>    gradz2 <span class="token operator">=</span> <span class="token punctuation">(</span>yhat <span class="token operator">-</span> labels<span class="token punctuation">)</span>    gradW2 <span class="token operator">=</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>gradz2<span class="token punctuation">)</span>    gradb2 <span class="token operator">=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>gradz2<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    gradh <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>gradz2<span class="token punctuation">,</span> W2<span class="token punctuation">.</span>T<span class="token punctuation">)</span>    gradz1 <span class="token operator">=</span> sigmoid_grad<span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token operator">*</span> gradh    gradW1 <span class="token operator">=</span> <span class="token punctuation">(</span>X<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>gradz1<span class="token punctuation">)</span>    gradb1 <span class="token operator">=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>gradz1<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># Stack gradients</span>    grad <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>gradW1<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gradb1<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        gradW2<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gradb2<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> cost<span class="token punctuation">,</span> grad</code></pre><h2 id="3-word2vec"><a href="#3-word2vec" class="headerlink" title="3. word2vec"></a>3. word2vec</h2><blockquote><p>(a) Assume you are given a predicted word vector $v_c$  corresponding to the center word $c$ for<br>and word prediction is made with the softmax function found in word2vec models<br>$$<br>\hat{\boldsymbol{y}}_{o}=p(\boldsymbol{o} | \boldsymbol{c})=\frac{\exp \left(\boldsymbol{u}_{o}^{\top} \boldsymbol{v}_{c}\right)}{\sum_{w=1}^{W} \exp \left(\boldsymbol{u}_{w}^{\top} \boldsymbol{v}_{c}\right)} <br>$$<br>where w denotes the $w$-th word and $u_w$ ($w = 1, \ldots, W $) are the “output” word vectors for all words in<br>the vocabulary. Assume cross entropy cost is applied to this prediction and word o is the expected word<br>(the $o$-th element of the one-hot label vector is one), derive the gradients with respect to $v_c$.</p></blockquote><p>令 $y$ 为 $Uv_c$ softmax输出的向量，$\hat{y}$ 为标签向量，形式为one-hot vector。则:</p>$$\frac{\partial J}{\partial \boldsymbol{v}_{c}}=U(\hat{\boldsymbol{y}}-\boldsymbol{y})$$或者其经过分配律后的式子：$$\frac{\partial J}{\partial \boldsymbol{v}_{c}}=-\boldsymbol{u}_{i}+\sum_{w=1}^{W} \hat{y}_{w} \boldsymbol{u}_{w}$$<blockquote><p>(b) As in the previous part, derive gradients for the “output” word vectors $u_w$’s (including $u_o$).</p></blockquote><p>与(a)基本完全一致：</p>$$\frac{\partial J}{\partial \boldsymbol{U}}=\boldsymbol{v}_{c}(\hat{\boldsymbol{y}}-\boldsymbol{y})^{\top}$$<blockquote><p>(c) Repeat part (a) and (b) assuming we are using the negative sampling loss for the predicted vector $v_c$, and the expected output word is $o$. Assume that K negative samples (words) are drawn, and<br>they are $1,\ldots, K$, respectively for simplicity of notation ($o \notin\{1, \ldots, K\}$ ). Again, for a given word, $o$,<br>denote its output vector as $u_o$. The negative sampling loss function in this case is<br>$$<br> J_{n e g-s a m p l e}\left(\boldsymbol{o}, \boldsymbol{v}_{c}, \boldsymbol{U}\right)=-\log \left(\sigma\left(\boldsymbol{u}_{o}^{\top} \boldsymbol{v}_{c}\right)\right)-\sum_{k=1}^{K} \log \left(\sigma\left(-\boldsymbol{u}_{k}^{\top} \boldsymbol{v}_{c}\right)\right) <br>$$</p></blockquote>$$\begin{aligned} \frac{\partial J}{\partial \boldsymbol{v}_{c}} &=\left(\sigma\left(\boldsymbol{u}_{o}^{\top} v_{c}\right)-1\right) \boldsymbol{u}_{o}-\sum_{k=1}^{K}\left(\sigma\left(-\boldsymbol{u}_{k}^{\top} \boldsymbol{v}_{c}\right)-1\right) \boldsymbol{u}_{k} \\ \frac{\partial J}{\partial \boldsymbol{u}_{o}} &=\left(\sigma\left(\boldsymbol{u}_{o}^{\top} \boldsymbol{v}_{c}\right)-1\right) \boldsymbol{v}_{c} \\ \frac{\partial J}{\partial \boldsymbol{u}_{k}} &=-\left(\sigma\left(-\boldsymbol{u}_{k}^{\top} \boldsymbol{v}_{c}\right)-1\right) \boldsymbol{v}_{c}, \quad \text { for all } k=1,2, \ldots, K \end{aligned}$$<blockquote><p>(d) Derive gradients for all of the word vectors for skip-gram and CBOW given the previous parts and given a set of context words  $[word_{c-m}, \ldots, word_{c-1}; word_c; word_{c+1}, \ldots word_{c+m}] $, where m is the context size. Denote the “input” and “output” word vectors for $word_k$ as $v_k$ and $u_k$ respectively.</p></blockquote><p>这里不妨使用$F(o, v_c)$ 代表  $J_{softmax-CE}(o, v_c, \ldots)$ 或 $J_{neg-sample}(o,v_c, \ldots)$ 。</p>对Skip-gram：$$\begin{array}{l}{\dfrac{\partial J_{\text {skip-gram }}\left(\text { word }_{c-m \ldots c+m}\right)}{\partial U}=\sum_{-m \leq j \leq m, j \neq 0} \dfrac{\partial F\left(\boldsymbol{w}_{c+j}, \boldsymbol{v}_{c}\right)}{\partial \boldsymbol{U}}} \\ {\dfrac{\partial J_{\text {skip-gram }}\left(\text { word }_{c-m \ldots c+m}\right)}{\partial \boldsymbol{v}_{c}}=\sum_{-m \leq j \leq m, j \neq 0} \dfrac{\partial F\left(\boldsymbol{w}_{c+j}, \boldsymbol{v}_{c}\right)}{\partial \boldsymbol{v}_{c}}} \\ {\dfrac{\partial J_{\text {skip-gram }}\left(\text { word }_{c-m \ldots c+m}\right)}{\partial \boldsymbol{v}_{j}}=0, \text { for all } j \neq c}\end{array}$$对CBOW：$$\begin{array}{l}{\dfrac{\partial J_{\mathrm{CBOW}}\left(\text { word }_{c-m \ldots c+m}\right)}{\partial U}=\dfrac{\partial F\left(\boldsymbol{w}_{c}, \hat{\boldsymbol{v}}\right)}{\partial \boldsymbol{U}}=\dfrac{\partial F\left(\boldsymbol{w}_{c}, \hat{\boldsymbol{v}}\right)}{\partial \boldsymbol{U}}, \quad \text { (using the definition of } \hat{\boldsymbol{v}} \text { in the problem) }} \\ {\dfrac{\partial J_{\mathrm{CBOW}}\left(\text { word }_{c-m, \ldots c+m}\right)}{\partial \boldsymbol{v}_{j}}=\dfrac{\partial F\left(\boldsymbol{w}_{c}, \hat{\boldsymbol{v}}\right)}{\partial \hat{\boldsymbol{v}}}, \quad \text { for all } j \in\{c-m, \ldots, c-1, c+1, \ldots, c+m\}} \\ {\dfrac{\partial J_{\mathrm{CBOW}}\left(\text { word }_{c-m, \ldots c+m}\right)}{\partial \boldsymbol{v}_{j}}=\mathbf{0}, \quad \text { for all } j \notin\{c-m, \ldots, c-1, c+1, \ldots, c+m\}}\end{array}$$]]></content>
      
      
      <categories>
          
          <category> NLP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NLP </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>翻译：如何在Jupyter notebook中安装Python包？</title>
      <link href="2018/05/14/%E7%BF%BB%E8%AF%91%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8Jupyter-notebook%E4%B8%AD%E5%AE%89%E8%A3%85Python%E5%8C%85%EF%BC%9F/"/>
      <url>2018/05/14/%E7%BF%BB%E8%AF%91%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8Jupyter-notebook%E4%B8%AD%E5%AE%89%E8%A3%85Python%E5%8C%85%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="Installing-Python-Packages-from-a-Jupyter-Notebook"><a href="#Installing-Python-Packages-from-a-Jupyter-Notebook" class="headerlink" title="Installing Python Packages from a Jupyter Notebook"></a>Installing Python Packages from a Jupyter Notebook</h1><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p><em>This notebook originally appeared as a <a href="http://jakevdp.github.io/blog/2017/12/05/installing-python-packages-from-jupyter/" target="_blank" rel="noopener">post</a> on the blog <a href="http://jakevdp.github.io" target="_blank" rel="noopener">Pythonic Perambulations</a>.</em></p><p>本文由我完成翻译，以帮助更多中国朋友解决这个问题。但由于知识和能力的限制，译文很可能存在错误和纰漏，造成对部分朋友的误导。因此如果你有什么意见或建议，欢迎联系我以完善译文。如果我的译文使你产生了困惑，请参考上述原文。</p><p>一些额外的说明：</p><ol><li>考虑到它们在计算机领域的常见性，文中除了首次出现的地方，kernel和shell一律使用英文；</li><li>考虑到Jupyter notebook的名称，文中的notebook一律不翻译；</li><li>文中的小标题都没有翻译。</li></ol><h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2><!-- PELICAN_BEGIN_SUMMARY --><p>在软件开发领域，有句话叫做<a href="https://www.joelonsoftware.com/2002/11/11/the-law-of-leaky-abstractions/" target="_blank" rel="noopener">一切抽象都是有漏洞的</a>（译者注：这是指在软件开发过程中，本应隐藏实现细节的抽象化不可避免地暴露出底层细节与局限性。抽象泄露是棘手的问题，因为抽象化本来目的就是向用户隐藏不必要公开的细节），如同其他软件一样，这句话对Jupyter notebook也同样适用。</p><p>下面这种情况的频繁出现证明了这一点：</p><blockquote><p>我安装了<em>XX包</em> 但是我不能在notebook中导入它，谁能帮帮我？</p></blockquote><p>这个问题多年来在StackOverflow上盛久不衰 (比如 <a href="https://stackoverflow.com/questions/39007571/running-jupyter-with-multiple-python-and-ipython-paths/" target="_blank" rel="noopener">这一个</a>, <a href="https://stackoverflow.com/questions/42500142/importerror-no-module-named-jwt-in-jupyter" target="_blank" rel="noopener">这一个</a>, 还有<a href="https://stackoverflow.com/questions/32777807/importerror-no-module-named-cv2-using-jupyter" target="_blank" rel="noopener">这个</a>, 和<a href="https://stackoverflow.com/questions/42500649/failed-to-import-numpy-as-np-when-i-worked-with-jupyter-notebook" target="_blank" rel="noopener">这个</a>, <a href="https://stackoverflow.com/questions/46634660/jupyter-notebook-wrong-sys-path-and-sys-executable" target="_blank" rel="noopener">这个</a>, <a href="https://stackoverflow.com/questions/44222513/cannot-import-datashader-installed-using-miniconda" target="_blank" rel="noopener">这个</a>, 以及<a href="https://stackoverflow.com/questions/42178070/jupyter-notebook-importerror-no-module-named-sklearn" target="_blank" rel="noopener">这一个</a>, 和<a href="https://stackoverflow.com/questions/42034508/fail-pandas-in-python3-jupyter-notebook" target="_blank" rel="noopener">这个</a>… etc.)。</p><p>从本质上来说，这个问题通常源于这么一个事实：<strong>Jupyter的内核（kernel）和Jupyter的壳（shell）是不相连的</strong>；换句话说，安装程序指向的是另一个Python的版本，而非你在notebook中使用的那一个。<br>在最简单的情况下这种问题并不会出现，但一旦它出现了，解决这个问题就需要你具有关于操作系统、Python包的安装、以及Jupyter本身的相关知识。<br>换言之，Jupyter notebook，与其他所有的抽象化的软件一样，也存在漏洞。</p><p>在与同事们针对这个问题进行了一些讨论后——有的是线上(这是我们两次线上讨论的链接：<a href="https://twitter.com/amuellerml/status/932637063748444160" target="_blank" rel="noopener">讨论 A</a>, <a href="https://twitter.com/jakevdp/status/922846245848150016" target="_blank" rel="noopener">讨论 B</a>)， 有的是线下——我决定在这里对这个问题进行一些深入的讲解。</p><p>这篇博文旨在阐述清楚以下内容：</p><ul><li><p><strong>首先</strong>， 我会针对这个问题提供过一个快速、简单的解决办法，<em>我要怎样通过pip或者conda在我的jupyter notebook上安装一个python包呢？</em></p></li><li><p><strong>其次</strong>，我会深入这些问题的具体背景：Jupyter notebook的抽象化究竟在<em>做什么</em>， 它是如何与复杂的操作系统进行交互的，以及你要怎样看待这所谓的泄漏，从而对问题出现的前因后果有一个完整的了解。</p></li><li><p><strong>第三</strong>，我会谈一些我的想法，也许开源社区可以考虑一下这些点子以消除这个问题，这包括了Jupyter，Pip，和Conda的开发者需要做的一些改进，来减轻使用者对其产品的认知负担。</p></li></ul><p>这篇文章会专注于安装Python包的两个途径： <a href="https://pip.pypa.io/en/stable/" target="_blank" rel="noopener">pip</a> 和 <a href="https://conda.io/docs/" target="_blank" rel="noopener">conda</a>.<br>其他管理包的方式当然也存在 (包括特定平台的工具，比如 <a href="http://yum.baseurl.org/" target="_blank" rel="noopener">yum</a>, <a href="https://help.ubuntu.com/community/AptGet/Howto#Package_management_with_APT" target="_blank" rel="noopener">apt</a>, <a href="https://brew.sh/" target="_blank" rel="noopener">homebrew</a>, etc., 以及跨平台的工具 <a href="http://enstaller.readthedocs.io/en/latest/" target="_blank" rel="noopener">enstaller</a>)，但我对它们并不那么熟悉，因此不会再对他们进行深入的讨论。</p><!-- PELICAN_END_SUMMARY --><h2 id="Quick-Fix-How-To-Install-Packages-from-the-Jupyter-Notebook"><a href="#Quick-Fix-How-To-Install-Packages-from-the-Jupyter-Notebook" class="headerlink" title="Quick Fix: How To Install Packages from the Jupyter Notebook"></a>Quick Fix: How To Install Packages from the Jupyter Notebook</h2><p>如果你只是想快速解决这个问题，即<em>如何在notebook里安装一个包</em>，那么只看这里就够了。</p><h3 id="pip-vs-conda"><a href="#pip-vs-conda" class="headerlink" title="pip vs. conda"></a>pip vs. conda</h3><p>首先，我简单提一下<code>pip</code> 还是 <code>conda</code>的问题。</p><p>对很多使用者来说，选择pip还是conda是非常令人困惑的问题。</p><p>去年，针对这个问题我写了<a href="https://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/" target="_blank" rel="noopener">一篇详尽得可能超过你想象的博文</a> , 但这二者的本质区别可以这样概括:</p><ul><li><em>pip</em> 可以在<strong>所有环境下</strong>安装<strong>python</strong>包。</li><li><em>conda</em>可以在<strong>conda环境下</strong>安装<strong>所有</strong>包。</li></ul><p>如果你已经安装了python，那么这个选择对你来说是非常容易的：</p><ul><li><p>如果你是用Anaconda或者Miniconda安装的python，那么请使用<code>conda</code>命令来安装python包。如果conda告诉你你要下载的这个包不存在，那么使用pip<br>(或者试试 <a href="https://conda-forge.org/" target="_blank" rel="noopener">conda-forge</a>, 它比conda默认的包的数量要更多)。</p></li><li><p>如果你是使用其他方式安装的python，那么使用<code>pip</code>来安装python包。</p></li></ul><p>最后，因为这样的问题常常发生，我必须提醒你<strong>永远不要</strong>使用<code>sudo pip install</code>。</p><p><em>永远不要。</em></p><p>即便这么做在短期内看起来好像解决了问题，但它总是会在更长的时间范围下带来问题。<br>比如，如果<code>pip install</code>给了你一个许可错误（permission error），这很可能意味着你在试图安装/升级系统python中的包，比如<code>usr/bin/python</code>。这么做会带来糟糕的后果，因为通常操作系统本身就依赖着某种特定版本的包。<br>对于日常的python使用，你应该把你的包和系统python的隔离开来，使用 <a href="https://virtualenv.pypa.io/en/stable/" target="_blank" rel="noopener">虚拟环境</a> or <a href="https://conda.io/docs/user-guide/install/download.html" target="_blank" rel="noopener">Anaconda/Miniconda</a> — 这种场合下我比较喜欢用conda，但我也知道我的很多同事会偏爱virtualenv。</p><h3 id="How-to-use-Conda-from-the-Jupyter-Notebook"><a href="#How-to-use-Conda-from-the-Jupyter-Notebook" class="headerlink" title="How to use Conda from the Jupyter Notebook"></a>How to use Conda from the Jupyter Notebook</h3><p>如果你在使用jupyter notebook并且你希望通过conda来安装某个包，你也许会想要使用<code>!</code>来直接在notebook里以shell的方式运行conda：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># DON'T DO THIS!</span>!conda install <span class="token operator">-</span><span class="token operator">-</span>yes numpy</code></pre><pre><code>Fetching package metadata ...........Solving package specifications: .# All requested packages already installed.# packages in environment at /Users/jakevdp/anaconda/envs/python3.6:#numpy                     1.13.3           py36h2cdce51_0  </code></pre><p>(注意：当conda请求用户确认时，我们使用 <code>--yes</code> 来自动回答 <code>y</code> )</p><p>出于多种原因（这些原因我将在下面详细介绍），总之，如果你在当前的notebook中使用这样安装的包，这种操作<strong>通常来说不会起作用</strong>，尽管在很简单的情况下它会起作用。</p><p>而以下才是通用的安装方式：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Install a conda package in the current Jupyter kernel</span><span class="token keyword">import</span> sys!conda install <span class="token operator">-</span><span class="token operator">-</span>yes <span class="token operator">-</span><span class="token operator">-</span>prefix <span class="token punctuation">{</span>sys<span class="token punctuation">.</span>prefix<span class="token punctuation">}</span> numpy</code></pre><pre><code>Fetching package metadata ...........Solving package specifications: .# All requested packages already installed.# packages in environment at /Users/jakevdp/anaconda:#numpy                     1.13.3           py36h2cdce51_0  </code></pre><p>这些增加的内容确保了conda能在当前运行的Jupyter核内安装这个包。 (感谢 <a href="https://twitter.com/minrk/status/842067777150169088" target="_blank" rel="noopener">Min Ragan-Kelley</a> 提出了这个办法).</p><p>稍后我将讨论为什么这么做是必须的。</p><h3 id="How-to-use-Pip-from-the-Jupyter-Notebook"><a href="#How-to-use-Pip-from-the-Jupyter-Notebook" class="headerlink" title="How to use Pip from the Jupyter Notebook"></a>How to use Pip from the Jupyter Notebook</h3><p>如果你在使用Jupyter notebook并且希望通过<code>pip</code>来安装一个包，与上面类似，你也许同样会想用如下方式在shell里直接运行pip：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># DON'T DO THIS</span>!pip install numpy</code></pre><pre><code>Requirement already satisfied: numpy in /Users/jakevdp/anaconda/envs/python3.6/lib/python3.6/site-packages</code></pre><p>出于多种原因（这些原因我将在下面详细介绍），总之，如果你在当前的notebook中使用这样安装的包，这种操作<strong>通常来说不会起作用</strong>，尽管在很简单的情况下它会起作用。</p><p>而以下才是通用的安装方式：</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Install a pip package in the current Jupyter kernel</span><span class="token keyword">import</span> sys!<span class="token punctuation">{</span>sys<span class="token punctuation">.</span>executable<span class="token punctuation">}</span> <span class="token operator">-</span>m pip install numpy</code></pre><pre><code>Requirement already satisfied: numpy in /Users/jakevdp/anaconda/lib/python3.6/site-packages</code></pre><p>增加的内容确保了你在使用与当前Python核相关的<code>pip</code>版本，因此你所安装的包能在当前notebook中使用。<br>这实际上源于如下这样一个事实，即时不考虑Jupyter notebook，使用</p><pre><code>$ python -m pip install &lt;package&gt;</code></pre><p>来安装一个包也要比</p><pre><code>$ pip install &lt;package&gt;</code></pre><p>更好。</p><p>因为前者更清晰地指明了这个包将安装的位置（这一点之后也会详细阐述）。</p><h2 id="The-Details-Why-is-Installation-from-Jupyter-so-Messy"><a href="#The-Details-Why-is-Installation-from-Jupyter-so-Messy" class="headerlink" title="The Details: Why is Installation from Jupyter so Messy?"></a>The Details: Why is Installation from Jupyter so Messy?</h2><p>上面这些解决办法应该能够应对所有情况……但是为什么我们非得这么做？<br>简单来说，这是因为在Jupyter里，<strong>shell环境和python可执行文件是分离的</strong>。<br>想要理解为什么这一点造成了我们现在面对的情况需要你对如下几个不同概念有一个基本的了解：</p><ol><li>你的操作系统是如何定位可执行程序的，</li><li>Python是如何安装并定位包的，</li><li>Jupyter是如何确定使用哪一个Python可执行文件的。</li></ol><p>为求完整性，我将对上述每个问题做一些简单的探究（这里的讨论部分源于<br>我去年写的 <a href="https://stackoverflow.com/questions/39007571/running-jupyter-with-multiple-python-and-ipython-paths/39022003#39022003" target="_blank" rel="noopener">这个StackOverflow上的回答</a> ).</p><p><em>注意：以下讨论基于Linux，Unix，MacOSX和其他类似的操作系统。Windows有一个略微不同的体系结构，因此在一些细节上会存在差异。</em></p><h3 id="How-your-operating-system-locates-executables"><a href="#How-your-operating-system-locates-executables" class="headerlink" title="How your operating system locates executables"></a>How your operating system locates executables</h3><p>当你在终端输入诸如 <code>python</code>, <code>jupyter</code>, <code>ipython</code>, <code>pip</code>, <code>conda</code> 这样的命令时，你的操作系统会根据它所具有的一套定义明确的机制来找到这些命令所对应的可执行文件。</p><p>在Linux &amp; Mac操作系统中，系统会首先寻找是否有一个<a href="http://tldp.org/LDP/abs/html/aliases.html" target="_blank" rel="noopener">别名（alias）</a>与这个命令匹配；如果它没能在<code>$PATH$</code>环境变量中找到：</p><pre class=" language-python"><code class="language-python">!echo $PATH</code></pre><pre><code>/Users/jakevdp/anaconda/envs/python3.6/bin:/Users/jakevdp/anaconda/envs/python3.6/bin:/Users/jakevdp/anaconda/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</code></pre><p><code>$PATH</code>中罗列了用来查找可执行文件的目录：举例来说，如果我在我的系统上用上面的<code>$PATH</code>输入<code>python</code>，它首先会寻找<code>/Users/jakevdp/anaconda/envs/python3.6/bin/python</code>，如果这个不存在，那么它会寻找<code>/Users/jakevdp/anaconda/bin/python</code>等等。</p><p>（顺带说明：为什么<code>$PATH</code>的第一个条目重复了两次？这是因为每次你打开<code>jupyter notebook</code>的时候，Jupyter会把<code>jupyter</code>可执行文件的地址放到<code>$PATH</code>的开头。在我们的例子中，这个地址已经在路径的开头了，于是结果就是这个条目将会重复。重复的条目可能会造成一些混乱，但也没什么坏处）。</p><p>如果你想知道当你输入<code>python</code>的时候，究竟是哪个文件被执行，你可以使用<code>type</code>shell命令：</p><pre class=" language-python"><code class="language-python">!type python</code></pre><pre><code>python is /Users/jakevdp/anaconda/envs/python3.6/bin/python</code></pre><p>注意，这对你在终端中使用的<em>任何</em>命令都适用：</p><pre class=" language-python"><code class="language-python">!type ls</code></pre><pre><code>ls is /bin/ls</code></pre><p>即使是内置的命令，比如<code>type</code>本身：</p><pre class=" language-python"><code class="language-python">!type type</code></pre><pre><code>type is a shell builtin</code></pre><p>你可以选择增加一个<code>-a</code>标签，来查看指令的<em>所有</em>可执行的版本；比如：</p><pre class=" language-python"><code class="language-python">!type <span class="token operator">-</span>a python</code></pre><pre><code>python is /Users/jakevdp/anaconda/envs/python3.6/bin/pythonpython is /Users/jakevdp/anaconda/envs/python3.6/bin/pythonpython is /Users/jakevdp/anaconda/bin/pythonpython is /usr/bin/python</code></pre><pre class=" language-python"><code class="language-python">!type <span class="token operator">-</span>a conda</code></pre><pre class=" language-shell"><code class="language-shell">conda is /Users/jakevdp/anaconda/envs/python3.6/bin/condaconda is /Users/jakevdp/anaconda/envs/python3.6/bin/condaconda is /Users/jakevdp/anaconda/bin/conda</code></pre><pre class=" language-python"><code class="language-python">!type <span class="token operator">-</span>a pip</code></pre><pre><code>pip is /Users/jakevdp/anaconda/envs/python3.6/bin/pippip is /Users/jakevdp/anaconda/envs/python3.6/bin/pippip is /Users/jakevdp/anaconda/bin/pip</code></pre><p>当你有一个命令的多个不同版本时，了解<code>$PATH</code>在选择“究竟哪一个将被使用”上的重要角色将尤为重要。</p><h3 id="How-Python-locates-packages"><a href="#How-Python-locates-packages" class="headerlink" title="How Python locates packages"></a>How Python locates packages</h3><p>Python使用一个类似的机制来定位导入的包。<br>Python搜索的路径列表可在<code>sys.path</code>中找到：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> syssys<span class="token punctuation">.</span>path</code></pre><pre><code>[&#39;&#39;, &#39;/Users/jakevdp/anaconda/lib/python36.zip&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/lib-dynload&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/site-packages&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/site-packages/schemapi-0.3.0.dev0+791c7f6-py3.6.egg&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/site-packages/setuptools-27.2.0-py3.6.egg&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/site-packages/IPython/extensions&#39;, &#39;/Users/jakevdp/.ipython&#39;]</code></pre><p>默认情况下，Python搜索模块的第一个位置是一个空路径，代表当前工作目录。</p><p>如果在这个位置该模块没有被找到，那么它会沿列表向下直到找到为止。</p><p>你可以通过导入的模块的<code>__path__</code>属性来获知究竟是哪个地址正在被使用：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpynumpy<span class="token punctuation">.</span>__path__</code></pre><pre><code>[&#39;/Users/jakevdp/anaconda/lib/python3.6/site-packages/numpy&#39;]</code></pre><p>在大多数情况下，你使用<code>pip</code>或者<code>conda</code>安装的Python包会存放在一个名为<code>site-packages</code>的目录下。重要的一点是，每个Python可执行文件都有<strong>它自己的<code>site-packages</code></strong>：这就意味着，当你安装一个包时，它会与某一个特定的Python可执行文件相关联，并且在默认情况下只能在这个Python版本下使用！</p><p>我们可以通过对我的每一个可用的<code>python</code>来打印其<code>sys.path</code>来验证这一点，这得益于Jupyter的一个令人振奋的能力，那就是能够在一个代码块中把Python和bash命令结合：</p><pre class=" language-python"><code class="language-python">paths <span class="token operator">=</span> !type <span class="token operator">-</span>a python<span class="token keyword">for</span> path <span class="token keyword">in</span> set<span class="token punctuation">(</span>paths<span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>    !<span class="token punctuation">{</span>path<span class="token punctuation">}</span> <span class="token operator">-</span>c <span class="token string">"import sys; print(sys.path)"</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><pre><code>/Users/jakevdp/anaconda/envs/python3.6/bin/python[&#39;&#39;, &#39;/Users/jakevdp/anaconda/envs/python3.6/lib/python36.zip&#39;, &#39;/Users/jakevdp/anaconda/envs/python3.6/lib/python3.6&#39;, &#39;/Users/jakevdp/anaconda/envs/python3.6/lib/python3.6/lib-dynload&#39;, &#39;/Users/jakevdp/anaconda/envs/python3.6/lib/python3.6/site-packages&#39;]/usr/bin/python[&#39;&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python27.zip&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/plat-darwin&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/plat-mac&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/plat-mac/lib-scriptpackages&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-tk&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-old&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/lib-dynload&#39;, &#39;/Library/Python/2.7/site-packages&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python&#39;, &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/PyObjC&#39;]/Users/jakevdp/anaconda/bin/python[&#39;&#39;, &#39;/Users/jakevdp/anaconda/lib/python36.zip&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/lib-dynload&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/site-packages&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/site-packages/schemapi-0.3.0.dev0+791c7f6-py3.6.egg&#39;, &#39;/Users/jakevdp/anaconda/lib/python3.6/site-packages/setuptools-27.2.0-py3.6.egg&#39;]</code></pre><p>​    </p><p>这里的具体细节并不十分重要，但你必须知道<em>每一个Python可执行文件都有其独有的路径</em>，并且除非你修改了<code>sys.path</code>（如果要这么做你必须格外小心）你是不可能在另一个Python环境中导入包的。</p><p>当你使用<code>pip install</code>或者<code>conda install</code>的时候，这些命令与具体的Python版本紧密相关：</p><ul><li><code>pip</code>为同一路径下的Python安装包</li><li><code>conda</code>为当前是激活状态的conda环境安装包</li></ul><p>因此，我们可以看到，下面这个<code>pip install</code>会为这个名为<code>python3.6</code>的conda环境执行安装操作：</p><pre class=" language-python"><code class="language-python">!type pip</code></pre><pre><code>pip is /Users/jakevdp/anaconda/envs/python3.6/bin/pip</code></pre><p>与此同时，<code>conda install</code>也能做同样的事情，因为<code>python3.6</code>正是当前激活状态下的环境（注意<code>*</code>代表被激活的环境）：</p><pre class=" language-python"><code class="language-python">!conda env list</code></pre><pre><code># conda environments:#python2.7                /Users/jakevdp/anaconda/envs/python2.7python3.5                /Users/jakevdp/anaconda/envs/python3.5python3.6             *  /Users/jakevdp/anaconda/envs/python3.6rstats                   /Users/jakevdp/anaconda/envs/rstatsroot                     /Users/jakevdp/anaconda</code></pre><p>这里<code>pip</code>和<code>conda</code>都能默认为conda的<code>python3.6</code>环境安装包的原因是这个环境就是我运行notebook的环境。</p><p>我要重述一遍这句话以示强调：<strong>Jupyter notebook的shell环境与用于<em>运行</em>这个notebook的环境是匹配的。</strong></p><h3 id="How-Jupyter-executes-code-Jupyter-Kernels"><a href="#How-Jupyter-executes-code-Jupyter-Kernels" class="headerlink" title="How Jupyter executes code: Jupyter Kernels"></a>How Jupyter executes code: Jupyter Kernels</h3><p>下一个相关的问题就是，Jupyter怎样执行Python代码。这个问题把我们引向了<em>Jupyter kernel</em>的概念。</p><p>一个Jupyter kernel是这样一组文件：它们能引导Jupyter找到在notebook中执行代码的方法。<br>对于Python kernel，他们会指向一个特定的Python版本，但Jupyter的能力比这要更强大：Jupyter具有针对多种语言的<a href="https://github.com/jupyter/jupyter/wiki/Jupyter-kernels" target="_blank" rel="noopener">许多可用的kernel</a> ，这些语言包括Python2， Python3，Julia， R，Ruby，Haskell，甚至C++和Fortran！</p><pre class=" language-python"><code class="language-python">!jupyter kernelspec list</code></pre><pre><code>Available kernels:  python3       /Users/jakevdp/anaconda/envs/python3.6/lib/python3.6/site-packages/ipykernel/resources  conda-root    /Users/jakevdp/Library/Jupyter/kernels/conda-root  python2.7     /Users/jakevdp/Library/Jupyter/kernels/python2.7  python3.5     /Users/jakevdp/Library/Jupyter/kernels/python3.5  python3.6     /Users/jakevdp/Library/Jupyter/kernels/python3.6</code></pre><p>上面罗列的每一个kernel都是一个目录，在这些目录下包含了一个叫做<code>kernel.json</code>的文件，文件中制指定了这个kernel应该使用哪种语言和可执行文件。<br>比如：</p><pre class=" language-python"><code class="language-python">!cat <span class="token operator">/</span>Users<span class="token operator">/</span>jakevdp<span class="token operator">/</span>Library<span class="token operator">/</span>Jupyter<span class="token operator">/</span>kernels<span class="token operator">/</span>conda<span class="token operator">-</span>root<span class="token operator">/</span>kernel<span class="token punctuation">.</span>json</code></pre><pre><code>{ &quot;argv&quot;: [  &quot;/Users/jakevdp/anaconda/bin/python&quot;,  &quot;-m&quot;,  &quot;ipykernel_launcher&quot;,  &quot;-f&quot;,  &quot;{connection_file}&quot; ], &quot;display_name&quot;: &quot;python (conda-root)&quot;, &quot;language&quot;: &quot;python&quot;}</code></pre><p>如果你想要创建一个新的kernel，你可以使用<a href="http://ipython.readthedocs.io/en/stable/install/kernel_install.html#kernels-for-different-environments" target="_blank" rel="noopener">jupyter ipykernel命令</a>；<br>举个例子，我使用如下命令为模板为我主要的conda环境创建上述kernel:</p><pre><code>$ source activate myenv$ python -m ipykernel install --user --name myenv --display-name &quot;Python (myenv)&quot;</code></pre><h2 id="The-Root-of-the-Issue"><a href="#The-Root-of-the-Issue" class="headerlink" title="The Root of the Issue"></a>The Root of the Issue</h2><p>现在我们已经有了足够的背景知识来回答这个问题：*为什么使用<code>!pip install</code>或者<code>!conda install</code>通常都对notebook不奏效？</p><p>问题的根源是：当Jupyter notebook开始运行，shell环境就已经被确定了，然而Python的可执行文件却要由kernel来决定，而这二者并不一定互相匹配。<br>换言之，你并不能保证你<code>$PATH</code>中的<code>python</code>，<code>pip</code>和<code>conda</code>会和notebook中的<code>python</code>相适配。</p><p>回忆一下，你路径下的<code>python</code>可以通过如下命令来确定：</p><pre class=" language-python"><code class="language-python">!type python</code></pre><pre><code>python is /Users/jakevdp/anaconda/envs/python3.6/bin/python</code></pre><p>notebook中的Python可执行文件则可以通过如下命令来确定：</p><pre class=" language-python"><code class="language-python">sys<span class="token punctuation">.</span>executable</code></pre><pre><code>&#39;/Users/jakevdp/anaconda/bin/python&#39;</code></pre><p>在我当前的notebook环境中，这两个Python并不相同。<br>这就是为什么简单的<code>!pip install</code>或者<code>!conda install</code>会不奏效：这两个命令会把包安在错误的Python的<code>site-packages</code>下。</p><p>如我们上面所说，我们可以通过明确确定安装位置来克服这个问题。<br>在<strong>conda</strong>中，你可以手动在shell命令中这样增加前缀：</p><pre><code>$ conda install --yes --prefix /Users/jakevdp/anaconda numpy</code></pre><p>或者，为了能够自动使用正确的前缀（使用notebook中可用的语法）：</p><pre><code>!conda install --yes --prefix {sys.prefix} numpy</code></pre><p>对于<strong>pip</strong>，你可以明确指出你需要的Python版本:</p><pre><code>$ /Users/jakevdp/anaconda/bin/python -m pip install numpy</code></pre><p>或者，为了能够自动使用正确版本（又一次使用notebook的shell语法）：</p><pre><code>!{sys.executable} -m pip install numpy</code></pre><p>记住这一点：如果你想安装能在当前notebook中使用的包，你需要你的<em>安装命令</em>与<em>当前Python的kernel</em>相匹配。</p><h2 id="Some-Modest-Proposals"><a href="#Some-Modest-Proposals" class="headerlink" title="Some Modest Proposals"></a>Some Modest Proposals</h2><p>因此，总括地说，在Jupyter notebook中安装包之所以困难重重，是因为<strong>Jupyter的shell和Python的kernel不匹配</strong>，这就意味着比起直接<code>pip install</code>或者<code>conda install</code>，你还得做点别的什么。<br>之前我们提到的特殊情况下的例外，就是指你刚好在kernel所指的同一个Python环境下运行<code>jupyter notebook</code>；在这种情况下，简单的安装命令就会奏效。</p><p>尽管我们解决了这个问题，但这个问题仍然把我们置于一个不太好的环境下，因为对于一个新手而言，他会认为这样的事情应该简单如此：安装一个包，然后使用，仅此而已。而这个情况增大了他们的学习曲线，使得Jupyter显得不那么易用。<br>那么如果我们是开发社区的成员，我们要怎么做才能消除这个问题呢？</p><p>我有一些点子，我想其中的一些会有用的：</p><h3 id="Potential-Changes-to-Jupyter"><a href="#Potential-Changes-to-Jupyter" class="headerlink" title="Potential Changes to Jupyter"></a>Potential Changes to Jupyter</h3><p>如我所说，问题根源在于Jupyter的shell环境和kernel的不匹配。<br>那么，我们能否为kernel规范发送信号以强制使二者匹配？<br>So, could we massage kernel specifications such that they force the two to match?</p><p>也许可以：比如，<a href="https://github.com/jupyterhub/jupyterhub/issues/847" target="_blank" rel="noopener">这个github issue</a> 向我们展示了一种修改shell变量，使它成为kernel启动的一部分的方法。</p><p>简单来说，在你的kernel目录中，你可以增加一个脚本<code>kernel-startup.sh</code>，它的内容大致如下（注意修改权限以使之可执行）：</p><pre><code>#!/usr/bin/env bash# activate anaconda envsource activate myenv# this is the critical part, and should be at the end of your script:exec python -m ipykernel $@</code></pre><p>之后在你的<code>kernel.json</code>文件中，修改<code>argv</code>的内容如下：</p><pre><code>&quot;argv&quot;: [   &quot;/path/to/kernel-startup.sh&quot;,   &quot;-f&quot;,   &quot;{connection_file}&quot; ]</code></pre><p>一旦你做了这些，转入<code>myenv</code>的kernel会自动激活<code>myenv</code>的conda环境，这会改变你的 <code>$CONDA_PREFIX</code>，<code>$PATH</code> 以及其他的系统变量，这会使<code>!conda install XXX</code> 和 <code>!pip install XXX</code> 能够正确工作。在virtualenvs或者其他Python环境中也可以使用类似的方法。</p><p>这里有一个麻烦的问题：如果你的<code>myenv</code>环境下没有<code>ipykernel</code>包，也许还得有与之匹配的用于打开notebook的jupyter版本，这个方法将不会有用。因此这不是一个完美的解决办法，不过如果Python kernels能够被设定为可以默认执行这样的shell初始化工作，对用户而言这就不会那么让人困惑了：<code>!pip install</code>和<code>!conda install</code>就够了。</p><h3 id="Potential-Changes-to-pip"><a href="#Potential-Changes-to-pip" class="headerlink" title="Potential Changes to pip"></a>Potential Changes to pip</h3><p>即便在Jupyter之外，关于安装的困惑也并不鲜见。它的一个来源就是，由于系统别名和环境变量的特性，<code>pip</code>和<code>python</code>可能会指向不同的路径。<br>在这样的情况下，<code>pip install</code>会在一个<code>python</code>无法连接的地址安装包。<br>因此，使用<code>python -m pip install</code>会是一个更加安全的做法。它明确指定了需要安装包的Python版本(毕竟<a href="https://www.python.org/dev/peps/pep-0020/" target="_blank" rel="noopener">明确总比模糊要好</a>）。</p><p>这就是<a href="https://docs.python.org/3/installing/index.html#basic-usage" target="_blank" rel="noopener">Python文档</a>里不再有<code>pip install</code>，像David Beazley这样经验丰富的Python教学者<a href="https://twitter.com/dabeaz/status/922859605247643649" target="_blank" rel="noopener">从来不教的“裸露的pip”（bare pip)</a>的一个原因。<br>Cpython开发者Nick Colghlan甚至<a href="https://twitter.com/ncoghlan_dev/status/922979220711661568" target="_blank" rel="noopener">指出</a>总有一天<code>pip</code>会被<code>python -m pip</code>取代。<br>尽管这样做命令好像更冗长了，但我还是认为强制用户使用更明确的命令会是一个很有用的改变，尤其是在当下virtualenvs和conda正在日渐普遍的情况下。</p><h3 id="Changes-to-Conda"><a href="#Changes-to-Conda" class="headerlink" title="Changes to Conda"></a>Changes to Conda</h3><p>我认为对conda的API做一些修改会对用户来说很有帮助。</p><h4 id="Explicit-invocation"><a href="#Explicit-invocation" class="headerlink" title="Explicit invocation"></a>Explicit invocation</h4><p>与<code>pip</code>相对应，我认为使用<code>python -m conda install</code>会与上面<code>pip</code>的情况一样。<br>你可以在root环境下这样使用<code>conda</code>命令，但是conda的python包（与conda可执行文件相对）目前不能在root环境以外的地方安装：</p><pre><code>(myenv) jakevdp$ conda install condaFetching package metadata ...........InstallError: Error: &#39;conda&#39; can only be installed into the root environment</code></pre><p>我猜测在所有conda环境下允许<code>python -m conda install</code>会需要对conda的安装模型做很大的重构工作，因此也许仅仅为了与pip的API对应而做的改动并不划算。<br>即便如此，这样的对应对用户而言也会是很大的帮助。</p><h4 id="A-pip-channel-for-conda"><a href="#A-pip-channel-for-conda" class="headerlink" title="A pip channel for conda?"></a>A pip channel for conda?</h4><p>另一个conda可以做的改动可能是增加一个<a href="https://pypi.python.org/pypi" target="_blank" rel="noopener">Python包目录</a>的镜像通道，这样一来，当你使用<code>conda isntall some-package</code>的时候，计算机会自动像<code>pip</code>一样提取软件包。</p><p>我对conda架构的了解还不够深入，因此我不知道增加这样的特性的难度会有多大。但我<em>毫无疑问</em>具有帮助新手接触Python和/或conda的丰富经验：我有把握说增加这样的特性能够使他们的学习曲线更加平稳。</p><h3 id="New-Jupyter-Magic-Functions"><a href="#New-Jupyter-Magic-Functions" class="headerlink" title="New Jupyter Magic Functions"></a>New Jupyter Magic Functions</h3><p>即使上述这些改动都不可能实现的，我们还是可以通过在Jupyter notebook中引入<code>%pip</code>和<code>%conda</code>魔法命令来简化用户体验。这样的魔法命令会检测当前的kernel并使得软件包能被安装在正确的位置。</p><h4 id="pip-magic"><a href="#pip-magic" class="headerlink" title="pip magic"></a>pip magic</h4><p>举个例子，你可以像下面这样定义一个<code>%pip</code>魔法命令，它将能够在当前kernel中使用：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> IPython<span class="token punctuation">.</span>core<span class="token punctuation">.</span>magic <span class="token keyword">import</span> register_line_magic@register_line_magic<span class="token keyword">def</span> <span class="token function">pip</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Use pip from the current kernel"""</span>    <span class="token keyword">from</span> pip <span class="token keyword">import</span> main    main<span class="token punctuation">(</span>args<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>按如下方式运行会在预期的位置安装软件包：</p><pre class=" language-python"><code class="language-python"><span class="token operator">%</span>pip install numpy</code></pre><pre><code>Requirement already satisfied: numpy in /Users/jakevdp/anaconda/lib/python3.6/site-packages</code></pre><p>​    </p><p>值得一提的是，Jupyter开发者Matthias Bussonnier已经在他的<a href="https://github.com/Carreau/pip_magic" target="_blank" rel="noopener">pip_magic</a>代码仓库中发表了这样的内容，因此你可以通过</p><pre><code>$ python -m pip install pip_magic</code></pre><p>安装，并且现在就使用它（当然，前提是你能够把<code>pip_magic</code>安装在正确的位置！）</p><h4 id="conda-magic"><a href="#conda-magic" class="headerlink" title="conda magic"></a>conda magic</h4><p>类似地，我们可以定义一个这样一个conda魔法命令：如果你输入<code>%conda install XXX</code>，它也能帮你在正确的位置完成安装。<br>这会比<code>pip</code>魔法命令更复杂一点，因为它必须保证当前的环境是兼容conda的，并且（与之前所说的<code>python -m conda install</code>无法使用的问题相关）必须唤起一个子进程来执行正确的shell命令：</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> IPython<span class="token punctuation">.</span>core<span class="token punctuation">.</span>magic <span class="token keyword">import</span> register_line_magic<span class="token keyword">import</span> sys<span class="token keyword">import</span> os<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> Popen<span class="token punctuation">,</span> PIPE<span class="token keyword">def</span> <span class="token function">is_conda_environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Return True if the current Python executable is in a conda env"""</span>    <span class="token comment" spellcheck="true"># TODO: make this work with Conda.exe in Windows</span>    conda_exec <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>executable<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'conda'</span><span class="token punctuation">)</span>    conda_history <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>prefix<span class="token punctuation">,</span> <span class="token string">'conda-meta'</span><span class="token punctuation">,</span> <span class="token string">'history'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>conda_exec<span class="token punctuation">)</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>conda_history<span class="token punctuation">)</span>@register_line_magic<span class="token keyword">def</span> <span class="token function">conda</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Use conda from the current kernel"""</span>    <span class="token comment" spellcheck="true"># TODO: make this work with Conda.exe in Windows</span>    <span class="token comment" spellcheck="true"># TODO: fix string encoding to work with Python 2</span>    <span class="token keyword">if</span> <span class="token operator">not</span> is_conda_environment<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"The python kernel does not appear to be a conda environment.  "</span>                         <span class="token string">"Please use ``%pip install`` instead."</span><span class="token punctuation">)</span>    conda_executable <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>executable<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'conda'</span><span class="token punctuation">)</span>    args <span class="token operator">=</span> <span class="token punctuation">[</span>conda_executable<span class="token punctuation">]</span> <span class="token operator">+</span> args<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># Add --prefix to point conda installation to the current environment</span>    <span class="token keyword">if</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token string">'upgrade'</span><span class="token punctuation">,</span> <span class="token string">'remove'</span><span class="token punctuation">,</span> <span class="token string">'uninstall'</span><span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'-p'</span> <span class="token operator">not</span> <span class="token keyword">in</span> args <span class="token operator">and</span> <span class="token string">'--prefix'</span> <span class="token operator">not</span> <span class="token keyword">in</span> args<span class="token punctuation">:</span>            args<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'--prefix'</span><span class="token punctuation">)</span>            args<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>prefix<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># Because the notebook does not allow us to respond "yes" during the</span>    <span class="token comment" spellcheck="true"># installation, we need to insert --yes in the argument list for some commands</span>    <span class="token keyword">if</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token string">'upgrade'</span><span class="token punctuation">,</span> <span class="token string">'remove'</span><span class="token punctuation">,</span> <span class="token string">'uninstall'</span><span class="token punctuation">,</span> <span class="token string">'create'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'-y'</span> <span class="token operator">not</span> <span class="token keyword">in</span> args <span class="token operator">and</span> <span class="token string">'--yes'</span> <span class="token operator">not</span> <span class="token keyword">in</span> args<span class="token punctuation">:</span>            args<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'--yes'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># Call conda from command line with subprocess &amp; send results to stdout &amp; stderr</span>    <span class="token keyword">with</span> Popen<span class="token punctuation">(</span>args<span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">)</span> <span class="token keyword">as</span> process<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># Read stdout character by character, as it includes real-time progress updates</span>        <span class="token keyword">for</span> c <span class="token keyword">in</span> iter<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>c<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Read stderr line by line, because real-time does not matter</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> iter<span class="token punctuation">(</span>process<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>readline<span class="token punctuation">,</span> b<span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>You can now use <code>%conda install</code> and it will install packages to the correct environment:</p><p>现在你就可以使用<code>%conda install</code>在正确环境下安装软件包了：</p><pre class=" language-python"><code class="language-python"><span class="token operator">%</span>conda install numpy</code></pre><pre><code>Fetching package metadata ...........Solving package specifications: .# All requested packages already installed.# packages in environment at /Users/jakevdp/anaconda:#numpy                     1.13.3           py36h2cdce51_0  </code></pre><p>这个conda魔法命令还需要一些工作才能用作一个通用的解决办法（参考代码中的TODO注释），但我认为这是一个很有意义的开始。</p><p>如果这样的pip和conda魔法命令能够加入Jupyter默认的魔法命令集，我认为它将在解决在Jupyter notebook中安装Python包的道路上迈出一大步。<br>然而这样的方法也不是完全安全的：这几个魔法命令只不过是另一层抽象而已，像一切抽象一样，它们也不可避免地存在泄漏的问题。<br>但如果能很谨慎地实现它们，我认为将大大改善用户体验。</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>在这篇博文中，我试图一次性解答这个多年来盛久不衰的问题，<em>我要怎么在Jupyter notebook里安装Python包？</em></p><p>在提出了一些可以实现的简单解决办法后，我深入探究了<em>为什么</em>我们需要这么做：这归根结底来源于Jupyter的kernel是与shell不相连的。</p><p>kernel环境在执行期间可能会改变，但shell环境在Jupyter开始运行时就已经被确定了。<br>一个完整的解释需要花费如此巨大的篇幅，并且需要引入这么多概念，在我看来已经揭示了Jupyter生态的一个真实存在的缺陷，因此我为社区开发者们提出了一些可行的办法，来优化用户体验。</p><p>最后必须补充一点：我对Jupyter，conda，pip和其他一些构成了Python数据科学生态的工具的开发者们具有崇高的尊重和敬意。<br>我非常确定，这些开发者们此前就考虑过这些问题，并且权衡过这些可能的修复办法——如果你读到了这篇文章，请不要有所顾忌，我非常欢迎来自您的评论，也许您能指出一些我忽略了的东西。<br>最后，感谢你们为开源社区所做的贡献。</p><p><em>Thanks to Andy Mueller, Craig Citro, and Matthias Bussonnier for helpful comments on an early draft of this post</em>.</p><p><em>This post was written within a Jupyter notebook; you can view a static version <a href="http://nbviewer.jupyter.org/url/jakevdp.github.com/downloads/notebooks/JupyterInstallation.ipynb" target="_blank" rel="noopener">here</a> or download the full notebook <a href="http://jakevdp.github.com/downloads/notebooks/JupyterInstallation.ipynb" target="_blank" rel="noopener">here</a>.</em></p><p>感谢原作者提供翻译许可。</p>]]></content>
      
      
      <categories>
          
          <category> tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tutorial </tag>
            
            <tag> translation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>教程：如何配置深度学习服务器</title>
      <link href="2018/05/09/%E6%95%99%E7%A8%8B%EF%BC%9A%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>2018/05/09/%E6%95%99%E7%A8%8B%EF%BC%9A%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>当你拿到一个崭新的服务器账号的时候，你会希望通过这篇文章来快速配置好你所需要的开发环境。</p><p><a id="more"></a> 不过这篇文章完全是站在<strong>一个拥有服务器账号的非root权限、需要服务器用于深度学习研究开发的普通用户角度</strong>。</p><p><strong>最近一次更新</strong>：2019-08-13</p><h2 id="连接服务器"><a href="#连接服务器" class="headerlink" title="连接服务器"></a>连接服务器</h2><p>初拿到账号，在Windows下首先通过Xshell或者PUTTY连接服务器，我个人倾向于Xshell，PUTTY太老了。<strong>而在2019年8月的当下，我最喜欢的方式是MobaXterm和VS Code的remote工具箱，尤其是后者。</strong><br>老实说，还蛮好奇实验室里的服务器是怎样的配置，于是我们在terminal中输入：</p><pre class=" language-shell"><code class="language-shell">nvidia-smi</code></pre><p>就可以看到相关信息。</p><p>我们知道Linux是自带Python2和Python3的，在命令行中输入</p><pre class=" language-powershell"><code class="language-powershell">python <span class="token operator">-</span>V</code></pre><p>和</p><pre class=" language-shell"><code class="language-shell">python3 -V</code></pre><p>可以分别查看他们的版本。<br>我是习惯使用python3的，我注意到这里它的版本是3.4。<br>我常用的库包括numpy，matplotlib和pandas等，这里经过试验，发现这台机器上python2这几个库都有，而python3似乎只有numpy。另外貌似机器上已经安了Tensorflow，但不知道为什么使用时一直报错，哪怕我试图激活它的虚拟环境。<br>这样的情况下，我决定安装一个python3的Anaconda以图方便，至于Tensorflow之后在Anaconda里的虚拟环境再安一次吧。</p><h2 id="安装Anaconda"><a href="#安装Anaconda" class="headerlink" title="安装Anaconda"></a>安装Anaconda</h2><blockquote><p><strong>PS</strong>: 下述版本已不是当前最新，请自行修改url换成最新版本。</p></blockquote><p>事实上我的安装是参考<a href="https://www.digitalocean.com/community/tutorials/how-to-install-the-anaconda-python-distribution-on-ubuntu-16-04" target="_blank" rel="noopener">这篇文章</a>的，这篇文章介绍得非常清楚。但有一点必须注意，文章中下载的URL是这样的：</p><pre class=" language-powershell"><code class="language-powershell">curl <span class="token operator">-</span>O https:<span class="token operator">/</span><span class="token operator">/</span>repo<span class="token punctuation">.</span>continuum<span class="token punctuation">.</span>io<span class="token operator">/</span>archive<span class="token operator">/</span>Anaconda3<span class="token operator">-</span>5<span class="token punctuation">.</span>1<span class="token punctuation">.</span>0<span class="token operator">-</span>Linux<span class="token operator">-</span>x86_64<span class="token punctuation">.</span>sh</code></pre><p>但在国内这个下载速度会非常慢，因此我建议你使用清华开源镜像站：</p><pre class=" language-powershell"><code class="language-powershell">curl <span class="token operator">-</span>O https:<span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>anaconda<span class="token operator">/</span>archive<span class="token operator">/</span>Anaconda3<span class="token operator">-</span>5<span class="token punctuation">.</span>1<span class="token punctuation">.</span>0<span class="token operator">-</span>Linux<span class="token operator">-</span>x86_64<span class="token punctuation">.</span>sh</code></pre><p>在两个都尝试过后，我们可以发现后者的速度远胜前者。</p><h2 id="配置Jupyter-notebook"><a href="#配置Jupyter-notebook" class="headerlink" title="配置Jupyter notebook"></a>配置Jupyter notebook</h2><p>接下来进行远程Jupyter notebook的配置，这里主要参考<a href="https://blog.csdn.net/a819825294/article/details/55657496" target="_blank" rel="noopener">这篇博客</a>。文章中描述得很详细，这里不做赘述。只有一点补充，如果是以root用户登陆，在<code>jupyter notebook</code>命令后加上<code>--allow-root</code>即可。 </p><p>完成这个配置之后，你在Linux的命令行里输入<code>jupyter notebook</code>的命令之后，就能在其他终端上通过浏览器（<code>http://(你的服务器地址):(端口名)</code>）访问服务器的Jupyter notebook了。</p><h2 id="通过Anaconda安装Tensorflow"><a href="#通过Anaconda安装Tensorflow" class="headerlink" title="通过Anaconda安装Tensorflow"></a>通过Anaconda安装Tensorflow</h2><p>这次我们可以看<a href="https://www.tensorflow.org/install/install_linux#installing_with_anaconda" target="_blank" rel="noopener">官方的教程</a>中关于使用Anaconda安装的部分，照做的话一般不会出现什么问题。不过这里我同样推荐你使用<a href="https://mirror.tuna.tsinghua.edu.cn/help/tensorflow/" target="_blank" rel="noopener">清华镜像站</a>，不然你可能也会经历慢到怀疑人生的痛苦。</p><p>安装完之后发现仍然不能执行import tensorflow。参考这个<a href="https://stackoverflow.com/questions/36159194/tensorflow-libcudart-so-7-5-cannot-open-shared-object-file-no-such-file-or-di" target="_blank" rel="noopener">StackOverflow</a>的回答，需要在命令行中输入：</p><pre class=" language-shell"><code class="language-shell">source ~/.profile</code></pre><p>其他常见的报错在官网上（即上面的链接）都给出了相应的StackOverflow链接。</p><p>但这么做之后候我依然得到了报错，信息如下：</p><pre class=" language-shell"><code class="language-shell">ImportError: libcudnn.so.6: cannot open shared object file: No such file or directory</code></pre><p>这个原因是我的cuDNN版本不够的原因，因此我决定使用更低版本的Tensorflow。经过询问学长，cuDNN 5.0应该使用1.2版本的tensorflow，因此我们在命令行输入：</p><pre><code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ --upgrade tensorflow-gpu==1.2.1</code></pre><p>注意以上的安装我们使用了清华镜像。这样一来就终于可以使用Tensorflow了。当然每次使用前，要记得激活你的tensorflow环境。</p><h2 id="TensorBoard远程使用"><a href="#TensorBoard远程使用" class="headerlink" title="TensorBoard远程使用"></a>TensorBoard远程使用</h2><p>TensorBoard是TensorFlow中用于分析和调试神经网络模型的可视化框架，它将所谓的<strong>汇总（summary）</strong>和<strong>操作</strong>联系起来。</p><p>我们以一个单输入神经元为例：</p><pre class=" language-python"><code class="language-python">input_value <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'input_value'</span><span class="token punctuation">)</span>weight <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'weight'</span><span class="token punctuation">)</span>expected_output <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'expected_output'</span><span class="token punctuation">)</span>model <span class="token operator">=</span> tf<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>input_value<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> <span class="token string">"model"</span><span class="token punctuation">)</span>loss_function <span class="token operator">=</span> tf<span class="token punctuation">.</span>pow<span class="token punctuation">(</span>expected_output <span class="token operator">-</span> model<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"loss_function"</span><span class="token punctuation">)</span>optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span>learning_rate <span class="token operator">=</span> <span class="token number">0.025</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss_function<span class="token punctuation">)</span><span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token punctuation">[</span>input_value<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> expected_output<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_function<span class="token punctuation">]</span><span class="token punctuation">:</span>    tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span>value<span class="token punctuation">.</span>op<span class="token punctuation">.</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>summaries <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>merge_all<span class="token punctuation">(</span><span class="token punctuation">)</span>sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>summary_writer <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'log_simple_stats'</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    summary_writer<span class="token punctuation">.</span>add_summary<span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>summaries<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span></code></pre><p>这里我们生成了一个日志文件，<code>log_simple_stats</code>。运行TensorBoard只需要在终端中输入以下命令：</p><pre class=" language-shell"><code class="language-shell">tensorboard --logdir=log_simple_stats</code></pre><p>终端将输出：</p><pre class=" language-shell"><code class="language-shell">staring tensorboard on port 6006</code></pre><p>如果是在本机上，你只需要在chrome浏览器中输入地址<code>localhost:6006</code>即可使用；但如果你是在自己的机器上访问服务器的TensorBoard，可以参考<a href="https://stackoverflow.com/questions/38464559/how-to-locally-view-tensorboard-of-remote-server" target="_blank" rel="noopener">这个StackOverflow回答</a>。</p><h2 id="安装PyTorch"><a href="#安装PyTorch" class="headerlink" title="安装PyTorch"></a>安装PyTorch</h2><p><strong>Updated on Nov.20th</strong></p><p>上周敲定了明年暑假去NUS的暑研，马学长建议我提前做些准备，包括到时候工作的一些前期调研，以及熟悉他们的工具。他们习惯使用的是Pytorch，因此我打算利用平时的时间学习一下。（<strong>2019年夏天更新：NUS暑研吹了，我跑来美国了……</strong>）</p><p>Pytorch官网的下载地址在<a href="https://pytorch.org/get-started/locally/" target="_blank" rel="noopener">这里</a>。但很可惜在国内用Anaconda下载速度非常堪忧，我试图添加清华源但是实际下载的时候显示pytorch并不是使用的清华源。</p><p>这个问题我没能解决，因此我直接换用<code>pip</code>了。</p><p><code>pip</code>也需要将清华源设为默认：</p><pre class=" language-shell"><code class="language-shell">pip install pip -Upip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</code></pre><p>这样之后只需要简单的<code>pip install torch torchvision</code>就可以了，速度非常让人满意。（这条命令在我使用的当下默认的是python3.6和cuda9.0，其他版本需要指定，具体参考上面的pytorch官网）</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>整个配置过程实在有些曲折，日后有什么与此相关的配置经验我也会更新在这篇博客中。</p>]]></content>
      
      
      <categories>
          
          <category> tech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tutorial </tag>
            
            <tag> deep learning </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>About me</title>
      <link href="about/index.html"/>
      <url>about/index.html</url>
      
        <content type="html"><![CDATA[<p>Socrates once said:</p><blockquote><p>There is only one good, knowledge, and one evil, ignorance.  </p></blockquote><p>Over the centuries, humans have built our modern society with knowledge. Archimedes, Newton, Euler, Einstein… These great names are remembered because of the contributions of their owners to human knowledge.</p><p>knowledge is my lifelong pursuit, and this is why this blog exists. I want to preserve, share and discuss my knowledge and thoughts. So, it is delightful to meet you here.</p><p>Now talk about me. I am Weiran Huang. Currently I am an fourth-year undergraduate studying Computer Science at Beijing University of Posts and Telecommunications. I worked as an intern in Institute of Automation, Chinese Academy of Sciences from May, 2018 to May, 2019, doing research on network embedding and graph neural networks. I worked on the same topic in the summer of 2019 in Penn State University when I was a summer intern under the supervision of Professor Suhang Wang. After coming back from the US, I began my internship in the Deep Learning Lab, MOMO Inc, working on researching and developing of 3D reconstruction algorithms. Next month, I will join Microsoft Research Asia as an R&amp;D intern to work on Spatial-Temporal Prediction problems for traffic scheduling and resource optimization.</p><p>My interests range from machine learning to football. My favorite machine learning algorithm is Word2Vec, and the sci-fi writer I love most is Issac Asimov. My football home team is FC Barcelona, and my favorite players are Lionel Messi and Neymar Jr. I also play football myself, I am a left-footed winger who like to play on the right. </p><p>To know more about me, please check my <a href="https://huangweiran.club/online-cv/">Online CV</a>. For a downloadable PDF version, please click <a href="https://hwr-files.oss-cn-beijing.aliyuncs.com/weiran_CV_2020.pdf" target="_blank" rel="noopener">here</a>. </p>]]></content>
      
    </entry>
    
    
  
</search>
